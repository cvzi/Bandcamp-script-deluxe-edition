{"version":3,"file":"bundle.user.js","sources":["../src/violentmonkey.js","../node_modules/@babel/runtime/helpers/esm/extends.js","../node_modules/@babel/runtime/helpers/esm/setPrototypeOf.js","../node_modules/@babel/runtime/helpers/esm/inheritsLoose.js","../node_modules/@babel/runtime/helpers/esm/assertThisInitialized.js","../node_modules/memoize-one/dist/memoize-one.esm.js","../node_modules/react-window/dist/index.esm.js","../src/explorer.jsx","../src/index.js"],"sourcesContent":["/*\nCompatibility adaptions for Violentmonkey https://github.com/violentmonkey/violentmonkey\n*/\n\nif (typeof GM.registerMenuCommand !== 'function') {\n  if (typeof GM_registerMenuCommand === 'function') {\n    GM.registerMenuCommand = GM_registerMenuCommand\n  } else {\n    console.warn('Neither GM.registerMenuCommand nor GM_registerMenuCommand are available')\n  }\n}\n","export default function _extends() {\n  _extends = Object.assign || function (target) {\n    for (var i = 1; i < arguments.length; i++) {\n      var source = arguments[i];\n\n      for (var key in source) {\n        if (Object.prototype.hasOwnProperty.call(source, key)) {\n          target[key] = source[key];\n        }\n      }\n    }\n\n    return target;\n  };\n\n  return _extends.apply(this, arguments);\n}","export default function _setPrototypeOf(o, p) {\n  _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) {\n    o.__proto__ = p;\n    return o;\n  };\n\n  return _setPrototypeOf(o, p);\n}","import setPrototypeOf from \"./setPrototypeOf.js\";\nexport default function _inheritsLoose(subClass, superClass) {\n  subClass.prototype = Object.create(superClass.prototype);\n  subClass.prototype.constructor = subClass;\n  setPrototypeOf(subClass, superClass);\n}","export default function _assertThisInitialized(self) {\n  if (self === void 0) {\n    throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n  }\n\n  return self;\n}","var safeIsNaN = Number.isNaN ||\n    function ponyfill(value) {\n        return typeof value === 'number' && value !== value;\n    };\nfunction isEqual(first, second) {\n    if (first === second) {\n        return true;\n    }\n    if (safeIsNaN(first) && safeIsNaN(second)) {\n        return true;\n    }\n    return false;\n}\nfunction areInputsEqual(newInputs, lastInputs) {\n    if (newInputs.length !== lastInputs.length) {\n        return false;\n    }\n    for (var i = 0; i < newInputs.length; i++) {\n        if (!isEqual(newInputs[i], lastInputs[i])) {\n            return false;\n        }\n    }\n    return true;\n}\n\nfunction memoizeOne(resultFn, isEqual) {\n    if (isEqual === void 0) { isEqual = areInputsEqual; }\n    var lastThis;\n    var lastArgs = [];\n    var lastResult;\n    var calledOnce = false;\n    function memoized() {\n        var newArgs = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            newArgs[_i] = arguments[_i];\n        }\n        if (calledOnce && lastThis === this && isEqual(newArgs, lastArgs)) {\n            return lastResult;\n        }\n        lastResult = resultFn.apply(this, newArgs);\n        calledOnce = true;\n        lastThis = this;\n        lastArgs = newArgs;\n        return lastResult;\n    }\n    return memoized;\n}\n\nexport default memoizeOne;\n","import _extends from '@babel/runtime/helpers/esm/extends';\nimport _inheritsLoose from '@babel/runtime/helpers/esm/inheritsLoose';\nimport _assertThisInitialized from '@babel/runtime/helpers/esm/assertThisInitialized';\nimport memoizeOne from 'memoize-one';\nimport { createElement, PureComponent } from 'react';\nimport _objectWithoutPropertiesLoose from '@babel/runtime/helpers/esm/objectWithoutPropertiesLoose';\n\n// Animation frame based implementation of setTimeout.\n// Inspired by Joe Lambert, https://gist.github.com/joelambert/1002116#file-requesttimeout-js\nvar hasNativePerformanceNow = typeof performance === 'object' && typeof performance.now === 'function';\nvar now = hasNativePerformanceNow ? function () {\n  return performance.now();\n} : function () {\n  return Date.now();\n};\nfunction cancelTimeout(timeoutID) {\n  cancelAnimationFrame(timeoutID.id);\n}\nfunction requestTimeout(callback, delay) {\n  var start = now();\n\n  function tick() {\n    if (now() - start >= delay) {\n      callback.call(null);\n    } else {\n      timeoutID.id = requestAnimationFrame(tick);\n    }\n  }\n\n  var timeoutID = {\n    id: requestAnimationFrame(tick)\n  };\n  return timeoutID;\n}\n\nvar size = -1; // This utility copied from \"dom-helpers\" package.\n\nfunction getScrollbarSize(recalculate) {\n  if (recalculate === void 0) {\n    recalculate = false;\n  }\n\n  if (size === -1 || recalculate) {\n    var div = document.createElement('div');\n    var style = div.style;\n    style.width = '50px';\n    style.height = '50px';\n    style.overflow = 'scroll';\n    document.body.appendChild(div);\n    size = div.offsetWidth - div.clientWidth;\n    document.body.removeChild(div);\n  }\n\n  return size;\n}\nvar cachedRTLResult = null; // TRICKY According to the spec, scrollLeft should be negative for RTL aligned elements.\n// Chrome does not seem to adhere; its scrollLeft values are positive (measured relative to the left).\n// Safari's elastic bounce makes detecting this even more complicated wrt potential false positives.\n// The safest way to check this is to intentionally set a negative offset,\n// and then verify that the subsequent \"scroll\" event matches the negative offset.\n// If it does not match, then we can assume a non-standard RTL scroll implementation.\n\nfunction getRTLOffsetType(recalculate) {\n  if (recalculate === void 0) {\n    recalculate = false;\n  }\n\n  if (cachedRTLResult === null || recalculate) {\n    var outerDiv = document.createElement('div');\n    var outerStyle = outerDiv.style;\n    outerStyle.width = '50px';\n    outerStyle.height = '50px';\n    outerStyle.overflow = 'scroll';\n    outerStyle.direction = 'rtl';\n    var innerDiv = document.createElement('div');\n    var innerStyle = innerDiv.style;\n    innerStyle.width = '100px';\n    innerStyle.height = '100px';\n    outerDiv.appendChild(innerDiv);\n    document.body.appendChild(outerDiv);\n\n    if (outerDiv.scrollLeft > 0) {\n      cachedRTLResult = 'positive-descending';\n    } else {\n      outerDiv.scrollLeft = 1;\n\n      if (outerDiv.scrollLeft === 0) {\n        cachedRTLResult = 'negative';\n      } else {\n        cachedRTLResult = 'positive-ascending';\n      }\n    }\n\n    document.body.removeChild(outerDiv);\n    return cachedRTLResult;\n  }\n\n  return cachedRTLResult;\n}\n\nvar IS_SCROLLING_DEBOUNCE_INTERVAL = 150;\n\nvar defaultItemKey = function defaultItemKey(_ref) {\n  var columnIndex = _ref.columnIndex,\n      data = _ref.data,\n      rowIndex = _ref.rowIndex;\n  return rowIndex + \":\" + columnIndex;\n}; // In DEV mode, this Set helps us only log a warning once per component instance.\n// This avoids spamming the console every time a render happens.\n\n\nvar devWarningsOverscanCount = null;\nvar devWarningsOverscanRowsColumnsCount = null;\nvar devWarningsTagName = null;\n\nif (process.env.NODE_ENV !== 'production') {\n  if (typeof window !== 'undefined' && typeof window.WeakSet !== 'undefined') {\n    devWarningsOverscanCount =\n    /*#__PURE__*/\n    new WeakSet();\n    devWarningsOverscanRowsColumnsCount =\n    /*#__PURE__*/\n    new WeakSet();\n    devWarningsTagName =\n    /*#__PURE__*/\n    new WeakSet();\n  }\n}\n\nfunction createGridComponent(_ref2) {\n  var _class, _temp;\n\n  var getColumnOffset = _ref2.getColumnOffset,\n      getColumnStartIndexForOffset = _ref2.getColumnStartIndexForOffset,\n      getColumnStopIndexForStartIndex = _ref2.getColumnStopIndexForStartIndex,\n      getColumnWidth = _ref2.getColumnWidth,\n      getEstimatedTotalHeight = _ref2.getEstimatedTotalHeight,\n      getEstimatedTotalWidth = _ref2.getEstimatedTotalWidth,\n      getOffsetForColumnAndAlignment = _ref2.getOffsetForColumnAndAlignment,\n      getOffsetForRowAndAlignment = _ref2.getOffsetForRowAndAlignment,\n      getRowHeight = _ref2.getRowHeight,\n      getRowOffset = _ref2.getRowOffset,\n      getRowStartIndexForOffset = _ref2.getRowStartIndexForOffset,\n      getRowStopIndexForStartIndex = _ref2.getRowStopIndexForStartIndex,\n      initInstanceProps = _ref2.initInstanceProps,\n      shouldResetStyleCacheOnItemSizeChange = _ref2.shouldResetStyleCacheOnItemSizeChange,\n      validateProps = _ref2.validateProps;\n  return _temp = _class =\n  /*#__PURE__*/\n  function (_PureComponent) {\n    _inheritsLoose(Grid, _PureComponent);\n\n    // Always use explicit constructor for React components.\n    // It produces less code after transpilation. (#26)\n    // eslint-disable-next-line no-useless-constructor\n    function Grid(props) {\n      var _this;\n\n      _this = _PureComponent.call(this, props) || this;\n      _this._instanceProps = initInstanceProps(_this.props, _assertThisInitialized(_assertThisInitialized(_this)));\n      _this._resetIsScrollingTimeoutId = null;\n      _this._outerRef = void 0;\n      _this.state = {\n        instance: _assertThisInitialized(_assertThisInitialized(_this)),\n        isScrolling: false,\n        horizontalScrollDirection: 'forward',\n        scrollLeft: typeof _this.props.initialScrollLeft === 'number' ? _this.props.initialScrollLeft : 0,\n        scrollTop: typeof _this.props.initialScrollTop === 'number' ? _this.props.initialScrollTop : 0,\n        scrollUpdateWasRequested: false,\n        verticalScrollDirection: 'forward'\n      };\n      _this._callOnItemsRendered = void 0;\n      _this._callOnItemsRendered = memoizeOne(function (overscanColumnStartIndex, overscanColumnStopIndex, overscanRowStartIndex, overscanRowStopIndex, visibleColumnStartIndex, visibleColumnStopIndex, visibleRowStartIndex, visibleRowStopIndex) {\n        return _this.props.onItemsRendered({\n          overscanColumnStartIndex: overscanColumnStartIndex,\n          overscanColumnStopIndex: overscanColumnStopIndex,\n          overscanRowStartIndex: overscanRowStartIndex,\n          overscanRowStopIndex: overscanRowStopIndex,\n          visibleColumnStartIndex: visibleColumnStartIndex,\n          visibleColumnStopIndex: visibleColumnStopIndex,\n          visibleRowStartIndex: visibleRowStartIndex,\n          visibleRowStopIndex: visibleRowStopIndex\n        });\n      });\n      _this._callOnScroll = void 0;\n      _this._callOnScroll = memoizeOne(function (scrollLeft, scrollTop, horizontalScrollDirection, verticalScrollDirection, scrollUpdateWasRequested) {\n        return _this.props.onScroll({\n          horizontalScrollDirection: horizontalScrollDirection,\n          scrollLeft: scrollLeft,\n          scrollTop: scrollTop,\n          verticalScrollDirection: verticalScrollDirection,\n          scrollUpdateWasRequested: scrollUpdateWasRequested\n        });\n      });\n      _this._getItemStyle = void 0;\n\n      _this._getItemStyle = function (rowIndex, columnIndex) {\n        var _this$props = _this.props,\n            columnWidth = _this$props.columnWidth,\n            direction = _this$props.direction,\n            rowHeight = _this$props.rowHeight;\n\n        var itemStyleCache = _this._getItemStyleCache(shouldResetStyleCacheOnItemSizeChange && columnWidth, shouldResetStyleCacheOnItemSizeChange && direction, shouldResetStyleCacheOnItemSizeChange && rowHeight);\n\n        var key = rowIndex + \":\" + columnIndex;\n        var style;\n\n        if (itemStyleCache.hasOwnProperty(key)) {\n          style = itemStyleCache[key];\n        } else {\n          var _offset = getColumnOffset(_this.props, columnIndex, _this._instanceProps);\n\n          var isRtl = direction === 'rtl';\n          itemStyleCache[key] = style = {\n            position: 'absolute',\n            left: isRtl ? undefined : _offset,\n            right: isRtl ? _offset : undefined,\n            top: getRowOffset(_this.props, rowIndex, _this._instanceProps),\n            height: getRowHeight(_this.props, rowIndex, _this._instanceProps),\n            width: getColumnWidth(_this.props, columnIndex, _this._instanceProps)\n          };\n        }\n\n        return style;\n      };\n\n      _this._getItemStyleCache = void 0;\n      _this._getItemStyleCache = memoizeOne(function (_, __, ___) {\n        return {};\n      });\n\n      _this._onScroll = function (event) {\n        var _event$currentTarget = event.currentTarget,\n            clientHeight = _event$currentTarget.clientHeight,\n            clientWidth = _event$currentTarget.clientWidth,\n            scrollLeft = _event$currentTarget.scrollLeft,\n            scrollTop = _event$currentTarget.scrollTop,\n            scrollHeight = _event$currentTarget.scrollHeight,\n            scrollWidth = _event$currentTarget.scrollWidth;\n\n        _this.setState(function (prevState) {\n          if (prevState.scrollLeft === scrollLeft && prevState.scrollTop === scrollTop) {\n            // Scroll position may have been updated by cDM/cDU,\n            // In which case we don't need to trigger another render,\n            // And we don't want to update state.isScrolling.\n            return null;\n          }\n\n          var direction = _this.props.direction; // TRICKY According to the spec, scrollLeft should be negative for RTL aligned elements.\n          // This is not the case for all browsers though (e.g. Chrome reports values as positive, measured relative to the left).\n          // It's also easier for this component if we convert offsets to the same format as they would be in for ltr.\n          // So the simplest solution is to determine which browser behavior we're dealing with, and convert based on it.\n\n          var calculatedScrollLeft = scrollLeft;\n\n          if (direction === 'rtl') {\n            switch (getRTLOffsetType()) {\n              case 'negative':\n                calculatedScrollLeft = -scrollLeft;\n                break;\n\n              case 'positive-descending':\n                calculatedScrollLeft = scrollWidth - clientWidth - scrollLeft;\n                break;\n            }\n          } // Prevent Safari's elastic scrolling from causing visual shaking when scrolling past bounds.\n\n\n          calculatedScrollLeft = Math.max(0, Math.min(calculatedScrollLeft, scrollWidth - clientWidth));\n          var calculatedScrollTop = Math.max(0, Math.min(scrollTop, scrollHeight - clientHeight));\n          return {\n            isScrolling: true,\n            horizontalScrollDirection: prevState.scrollLeft < scrollLeft ? 'forward' : 'backward',\n            scrollLeft: calculatedScrollLeft,\n            scrollTop: calculatedScrollTop,\n            verticalScrollDirection: prevState.scrollTop < scrollTop ? 'forward' : 'backward',\n            scrollUpdateWasRequested: false\n          };\n        }, _this._resetIsScrollingDebounced);\n      };\n\n      _this._outerRefSetter = function (ref) {\n        var outerRef = _this.props.outerRef;\n        _this._outerRef = ref;\n\n        if (typeof outerRef === 'function') {\n          outerRef(ref);\n        } else if (outerRef != null && typeof outerRef === 'object' && outerRef.hasOwnProperty('current')) {\n          outerRef.current = ref;\n        }\n      };\n\n      _this._resetIsScrollingDebounced = function () {\n        if (_this._resetIsScrollingTimeoutId !== null) {\n          cancelTimeout(_this._resetIsScrollingTimeoutId);\n        }\n\n        _this._resetIsScrollingTimeoutId = requestTimeout(_this._resetIsScrolling, IS_SCROLLING_DEBOUNCE_INTERVAL);\n      };\n\n      _this._resetIsScrolling = function () {\n        _this._resetIsScrollingTimeoutId = null;\n\n        _this.setState({\n          isScrolling: false\n        }, function () {\n          // Clear style cache after state update has been committed.\n          // This way we don't break pure sCU for items that don't use isScrolling param.\n          _this._getItemStyleCache(-1);\n        });\n      };\n\n      return _this;\n    }\n\n    Grid.getDerivedStateFromProps = function getDerivedStateFromProps(nextProps, prevState) {\n      validateSharedProps(nextProps, prevState);\n      validateProps(nextProps);\n      return null;\n    };\n\n    var _proto = Grid.prototype;\n\n    _proto.scrollTo = function scrollTo(_ref3) {\n      var scrollLeft = _ref3.scrollLeft,\n          scrollTop = _ref3.scrollTop;\n\n      if (scrollLeft !== undefined) {\n        scrollLeft = Math.max(0, scrollLeft);\n      }\n\n      if (scrollTop !== undefined) {\n        scrollTop = Math.max(0, scrollTop);\n      }\n\n      this.setState(function (prevState) {\n        if (scrollLeft === undefined) {\n          scrollLeft = prevState.scrollLeft;\n        }\n\n        if (scrollTop === undefined) {\n          scrollTop = prevState.scrollTop;\n        }\n\n        if (prevState.scrollLeft === scrollLeft && prevState.scrollTop === scrollTop) {\n          return null;\n        }\n\n        return {\n          horizontalScrollDirection: prevState.scrollLeft < scrollLeft ? 'forward' : 'backward',\n          scrollLeft: scrollLeft,\n          scrollTop: scrollTop,\n          scrollUpdateWasRequested: true,\n          verticalScrollDirection: prevState.scrollTop < scrollTop ? 'forward' : 'backward'\n        };\n      }, this._resetIsScrollingDebounced);\n    };\n\n    _proto.scrollToItem = function scrollToItem(_ref4) {\n      var _ref4$align = _ref4.align,\n          align = _ref4$align === void 0 ? 'auto' : _ref4$align,\n          columnIndex = _ref4.columnIndex,\n          rowIndex = _ref4.rowIndex;\n      var _this$props2 = this.props,\n          columnCount = _this$props2.columnCount,\n          height = _this$props2.height,\n          rowCount = _this$props2.rowCount,\n          width = _this$props2.width;\n      var _this$state = this.state,\n          scrollLeft = _this$state.scrollLeft,\n          scrollTop = _this$state.scrollTop;\n      var scrollbarSize = getScrollbarSize();\n\n      if (columnIndex !== undefined) {\n        columnIndex = Math.max(0, Math.min(columnIndex, columnCount - 1));\n      }\n\n      if (rowIndex !== undefined) {\n        rowIndex = Math.max(0, Math.min(rowIndex, rowCount - 1));\n      }\n\n      var estimatedTotalHeight = getEstimatedTotalHeight(this.props, this._instanceProps);\n      var estimatedTotalWidth = getEstimatedTotalWidth(this.props, this._instanceProps); // The scrollbar size should be considered when scrolling an item into view,\n      // to ensure it's fully visible.\n      // But we only need to account for its size when it's actually visible.\n\n      var horizontalScrollbarSize = estimatedTotalWidth > width ? scrollbarSize : 0;\n      var verticalScrollbarSize = estimatedTotalHeight > height ? scrollbarSize : 0;\n      this.scrollTo({\n        scrollLeft: columnIndex !== undefined ? getOffsetForColumnAndAlignment(this.props, columnIndex, align, scrollLeft, this._instanceProps, verticalScrollbarSize) : scrollLeft,\n        scrollTop: rowIndex !== undefined ? getOffsetForRowAndAlignment(this.props, rowIndex, align, scrollTop, this._instanceProps, horizontalScrollbarSize) : scrollTop\n      });\n    };\n\n    _proto.componentDidMount = function componentDidMount() {\n      var _this$props3 = this.props,\n          initialScrollLeft = _this$props3.initialScrollLeft,\n          initialScrollTop = _this$props3.initialScrollTop;\n\n      if (this._outerRef != null) {\n        var outerRef = this._outerRef;\n\n        if (typeof initialScrollLeft === 'number') {\n          outerRef.scrollLeft = initialScrollLeft;\n        }\n\n        if (typeof initialScrollTop === 'number') {\n          outerRef.scrollTop = initialScrollTop;\n        }\n      }\n\n      this._callPropsCallbacks();\n    };\n\n    _proto.componentDidUpdate = function componentDidUpdate() {\n      var direction = this.props.direction;\n      var _this$state2 = this.state,\n          scrollLeft = _this$state2.scrollLeft,\n          scrollTop = _this$state2.scrollTop,\n          scrollUpdateWasRequested = _this$state2.scrollUpdateWasRequested;\n\n      if (scrollUpdateWasRequested && this._outerRef != null) {\n        // TRICKY According to the spec, scrollLeft should be negative for RTL aligned elements.\n        // This is not the case for all browsers though (e.g. Chrome reports values as positive, measured relative to the left).\n        // So we need to determine which browser behavior we're dealing with, and mimic it.\n        var outerRef = this._outerRef;\n\n        if (direction === 'rtl') {\n          switch (getRTLOffsetType()) {\n            case 'negative':\n              outerRef.scrollLeft = -scrollLeft;\n              break;\n\n            case 'positive-ascending':\n              outerRef.scrollLeft = scrollLeft;\n              break;\n\n            default:\n              var clientWidth = outerRef.clientWidth,\n                  scrollWidth = outerRef.scrollWidth;\n              outerRef.scrollLeft = scrollWidth - clientWidth - scrollLeft;\n              break;\n          }\n        } else {\n          outerRef.scrollLeft = Math.max(0, scrollLeft);\n        }\n\n        outerRef.scrollTop = Math.max(0, scrollTop);\n      }\n\n      this._callPropsCallbacks();\n    };\n\n    _proto.componentWillUnmount = function componentWillUnmount() {\n      if (this._resetIsScrollingTimeoutId !== null) {\n        cancelTimeout(this._resetIsScrollingTimeoutId);\n      }\n    };\n\n    _proto.render = function render() {\n      var _this$props4 = this.props,\n          children = _this$props4.children,\n          className = _this$props4.className,\n          columnCount = _this$props4.columnCount,\n          direction = _this$props4.direction,\n          height = _this$props4.height,\n          innerRef = _this$props4.innerRef,\n          innerElementType = _this$props4.innerElementType,\n          innerTagName = _this$props4.innerTagName,\n          itemData = _this$props4.itemData,\n          _this$props4$itemKey = _this$props4.itemKey,\n          itemKey = _this$props4$itemKey === void 0 ? defaultItemKey : _this$props4$itemKey,\n          outerElementType = _this$props4.outerElementType,\n          outerTagName = _this$props4.outerTagName,\n          rowCount = _this$props4.rowCount,\n          style = _this$props4.style,\n          useIsScrolling = _this$props4.useIsScrolling,\n          width = _this$props4.width;\n      var isScrolling = this.state.isScrolling;\n\n      var _this$_getHorizontalR = this._getHorizontalRangeToRender(),\n          columnStartIndex = _this$_getHorizontalR[0],\n          columnStopIndex = _this$_getHorizontalR[1];\n\n      var _this$_getVerticalRan = this._getVerticalRangeToRender(),\n          rowStartIndex = _this$_getVerticalRan[0],\n          rowStopIndex = _this$_getVerticalRan[1];\n\n      var items = [];\n\n      if (columnCount > 0 && rowCount) {\n        for (var _rowIndex = rowStartIndex; _rowIndex <= rowStopIndex; _rowIndex++) {\n          for (var _columnIndex = columnStartIndex; _columnIndex <= columnStopIndex; _columnIndex++) {\n            items.push(createElement(children, {\n              columnIndex: _columnIndex,\n              data: itemData,\n              isScrolling: useIsScrolling ? isScrolling : undefined,\n              key: itemKey({\n                columnIndex: _columnIndex,\n                data: itemData,\n                rowIndex: _rowIndex\n              }),\n              rowIndex: _rowIndex,\n              style: this._getItemStyle(_rowIndex, _columnIndex)\n            }));\n          }\n        }\n      } // Read this value AFTER items have been created,\n      // So their actual sizes (if variable) are taken into consideration.\n\n\n      var estimatedTotalHeight = getEstimatedTotalHeight(this.props, this._instanceProps);\n      var estimatedTotalWidth = getEstimatedTotalWidth(this.props, this._instanceProps);\n      return createElement(outerElementType || outerTagName || 'div', {\n        className: className,\n        onScroll: this._onScroll,\n        ref: this._outerRefSetter,\n        style: _extends({\n          position: 'relative',\n          height: height,\n          width: width,\n          overflow: 'auto',\n          WebkitOverflowScrolling: 'touch',\n          willChange: 'transform',\n          direction: direction\n        }, style)\n      }, createElement(innerElementType || innerTagName || 'div', {\n        children: items,\n        ref: innerRef,\n        style: {\n          height: estimatedTotalHeight,\n          pointerEvents: isScrolling ? 'none' : undefined,\n          width: estimatedTotalWidth\n        }\n      }));\n    };\n\n    _proto._callPropsCallbacks = function _callPropsCallbacks() {\n      var _this$props5 = this.props,\n          columnCount = _this$props5.columnCount,\n          onItemsRendered = _this$props5.onItemsRendered,\n          onScroll = _this$props5.onScroll,\n          rowCount = _this$props5.rowCount;\n\n      if (typeof onItemsRendered === 'function') {\n        if (columnCount > 0 && rowCount > 0) {\n          var _this$_getHorizontalR2 = this._getHorizontalRangeToRender(),\n              _overscanColumnStartIndex = _this$_getHorizontalR2[0],\n              _overscanColumnStopIndex = _this$_getHorizontalR2[1],\n              _visibleColumnStartIndex = _this$_getHorizontalR2[2],\n              _visibleColumnStopIndex = _this$_getHorizontalR2[3];\n\n          var _this$_getVerticalRan2 = this._getVerticalRangeToRender(),\n              _overscanRowStartIndex = _this$_getVerticalRan2[0],\n              _overscanRowStopIndex = _this$_getVerticalRan2[1],\n              _visibleRowStartIndex = _this$_getVerticalRan2[2],\n              _visibleRowStopIndex = _this$_getVerticalRan2[3];\n\n          this._callOnItemsRendered(_overscanColumnStartIndex, _overscanColumnStopIndex, _overscanRowStartIndex, _overscanRowStopIndex, _visibleColumnStartIndex, _visibleColumnStopIndex, _visibleRowStartIndex, _visibleRowStopIndex);\n        }\n      }\n\n      if (typeof onScroll === 'function') {\n        var _this$state3 = this.state,\n            _horizontalScrollDirection = _this$state3.horizontalScrollDirection,\n            _scrollLeft = _this$state3.scrollLeft,\n            _scrollTop = _this$state3.scrollTop,\n            _scrollUpdateWasRequested = _this$state3.scrollUpdateWasRequested,\n            _verticalScrollDirection = _this$state3.verticalScrollDirection;\n\n        this._callOnScroll(_scrollLeft, _scrollTop, _horizontalScrollDirection, _verticalScrollDirection, _scrollUpdateWasRequested);\n      }\n    }; // Lazily create and cache item styles while scrolling,\n    // So that pure component sCU will prevent re-renders.\n    // We maintain this cache, and pass a style prop rather than index,\n    // So that List can clear cached styles and force item re-render if necessary.\n\n\n    _proto._getHorizontalRangeToRender = function _getHorizontalRangeToRender() {\n      var _this$props6 = this.props,\n          columnCount = _this$props6.columnCount,\n          overscanColumnCount = _this$props6.overscanColumnCount,\n          overscanColumnsCount = _this$props6.overscanColumnsCount,\n          overscanCount = _this$props6.overscanCount,\n          rowCount = _this$props6.rowCount;\n      var _this$state4 = this.state,\n          horizontalScrollDirection = _this$state4.horizontalScrollDirection,\n          isScrolling = _this$state4.isScrolling,\n          scrollLeft = _this$state4.scrollLeft;\n      var overscanCountResolved = overscanColumnCount || overscanColumnsCount || overscanCount || 1;\n\n      if (columnCount === 0 || rowCount === 0) {\n        return [0, 0, 0, 0];\n      }\n\n      var startIndex = getColumnStartIndexForOffset(this.props, scrollLeft, this._instanceProps);\n      var stopIndex = getColumnStopIndexForStartIndex(this.props, startIndex, scrollLeft, this._instanceProps); // Overscan by one item in each direction so that tab/focus works.\n      // If there isn't at least one extra item, tab loops back around.\n\n      var overscanBackward = !isScrolling || horizontalScrollDirection === 'backward' ? Math.max(1, overscanCountResolved) : 1;\n      var overscanForward = !isScrolling || horizontalScrollDirection === 'forward' ? Math.max(1, overscanCountResolved) : 1;\n      return [Math.max(0, startIndex - overscanBackward), Math.max(0, Math.min(columnCount - 1, stopIndex + overscanForward)), startIndex, stopIndex];\n    };\n\n    _proto._getVerticalRangeToRender = function _getVerticalRangeToRender() {\n      var _this$props7 = this.props,\n          columnCount = _this$props7.columnCount,\n          overscanCount = _this$props7.overscanCount,\n          overscanRowCount = _this$props7.overscanRowCount,\n          overscanRowsCount = _this$props7.overscanRowsCount,\n          rowCount = _this$props7.rowCount;\n      var _this$state5 = this.state,\n          isScrolling = _this$state5.isScrolling,\n          verticalScrollDirection = _this$state5.verticalScrollDirection,\n          scrollTop = _this$state5.scrollTop;\n      var overscanCountResolved = overscanRowCount || overscanRowsCount || overscanCount || 1;\n\n      if (columnCount === 0 || rowCount === 0) {\n        return [0, 0, 0, 0];\n      }\n\n      var startIndex = getRowStartIndexForOffset(this.props, scrollTop, this._instanceProps);\n      var stopIndex = getRowStopIndexForStartIndex(this.props, startIndex, scrollTop, this._instanceProps); // Overscan by one item in each direction so that tab/focus works.\n      // If there isn't at least one extra item, tab loops back around.\n\n      var overscanBackward = !isScrolling || verticalScrollDirection === 'backward' ? Math.max(1, overscanCountResolved) : 1;\n      var overscanForward = !isScrolling || verticalScrollDirection === 'forward' ? Math.max(1, overscanCountResolved) : 1;\n      return [Math.max(0, startIndex - overscanBackward), Math.max(0, Math.min(rowCount - 1, stopIndex + overscanForward)), startIndex, stopIndex];\n    };\n\n    return Grid;\n  }(PureComponent), _class.defaultProps = {\n    direction: 'ltr',\n    itemData: undefined,\n    useIsScrolling: false\n  }, _temp;\n}\n\nvar validateSharedProps = function validateSharedProps(_ref5, _ref6) {\n  var children = _ref5.children,\n      direction = _ref5.direction,\n      height = _ref5.height,\n      innerTagName = _ref5.innerTagName,\n      outerTagName = _ref5.outerTagName,\n      overscanColumnsCount = _ref5.overscanColumnsCount,\n      overscanCount = _ref5.overscanCount,\n      overscanRowsCount = _ref5.overscanRowsCount,\n      width = _ref5.width;\n  var instance = _ref6.instance;\n\n  if (process.env.NODE_ENV !== 'production') {\n    if (typeof overscanCount === 'number') {\n      if (devWarningsOverscanCount && !devWarningsOverscanCount.has(instance)) {\n        devWarningsOverscanCount.add(instance);\n        console.warn('The overscanCount prop has been deprecated. ' + 'Please use the overscanColumnCount and overscanRowCount props instead.');\n      }\n    }\n\n    if (typeof overscanColumnsCount === 'number' || typeof overscanRowsCount === 'number') {\n      if (devWarningsOverscanRowsColumnsCount && !devWarningsOverscanRowsColumnsCount.has(instance)) {\n        devWarningsOverscanRowsColumnsCount.add(instance);\n        console.warn('The overscanColumnsCount and overscanRowsCount props have been deprecated. ' + 'Please use the overscanColumnCount and overscanRowCount props instead.');\n      }\n    }\n\n    if (innerTagName != null || outerTagName != null) {\n      if (devWarningsTagName && !devWarningsTagName.has(instance)) {\n        devWarningsTagName.add(instance);\n        console.warn('The innerTagName and outerTagName props have been deprecated. ' + 'Please use the innerElementType and outerElementType props instead.');\n      }\n    }\n\n    if (children == null) {\n      throw Error('An invalid \"children\" prop has been specified. ' + 'Value should be a React component. ' + (\"\\\"\" + (children === null ? 'null' : typeof children) + \"\\\" was specified.\"));\n    }\n\n    switch (direction) {\n      case 'ltr':\n      case 'rtl':\n        // Valid values\n        break;\n\n      default:\n        throw Error('An invalid \"direction\" prop has been specified. ' + 'Value should be either \"ltr\" or \"rtl\". ' + (\"\\\"\" + direction + \"\\\" was specified.\"));\n    }\n\n    if (typeof width !== 'number') {\n      throw Error('An invalid \"width\" prop has been specified. ' + 'Grids must specify a number for width. ' + (\"\\\"\" + (width === null ? 'null' : typeof width) + \"\\\" was specified.\"));\n    }\n\n    if (typeof height !== 'number') {\n      throw Error('An invalid \"height\" prop has been specified. ' + 'Grids must specify a number for height. ' + (\"\\\"\" + (height === null ? 'null' : typeof height) + \"\\\" was specified.\"));\n    }\n  }\n};\n\nvar DEFAULT_ESTIMATED_ITEM_SIZE = 50;\n\nvar getEstimatedTotalHeight = function getEstimatedTotalHeight(_ref, _ref2) {\n  var rowCount = _ref.rowCount;\n  var rowMetadataMap = _ref2.rowMetadataMap,\n      estimatedRowHeight = _ref2.estimatedRowHeight,\n      lastMeasuredRowIndex = _ref2.lastMeasuredRowIndex;\n  var totalSizeOfMeasuredRows = 0; // Edge case check for when the number of items decreases while a scroll is in progress.\n  // https://github.com/bvaughn/react-window/pull/138\n\n  if (lastMeasuredRowIndex >= rowCount) {\n    lastMeasuredRowIndex = rowCount - 1;\n  }\n\n  if (lastMeasuredRowIndex >= 0) {\n    var itemMetadata = rowMetadataMap[lastMeasuredRowIndex];\n    totalSizeOfMeasuredRows = itemMetadata.offset + itemMetadata.size;\n  }\n\n  var numUnmeasuredItems = rowCount - lastMeasuredRowIndex - 1;\n  var totalSizeOfUnmeasuredItems = numUnmeasuredItems * estimatedRowHeight;\n  return totalSizeOfMeasuredRows + totalSizeOfUnmeasuredItems;\n};\n\nvar getEstimatedTotalWidth = function getEstimatedTotalWidth(_ref3, _ref4) {\n  var columnCount = _ref3.columnCount;\n  var columnMetadataMap = _ref4.columnMetadataMap,\n      estimatedColumnWidth = _ref4.estimatedColumnWidth,\n      lastMeasuredColumnIndex = _ref4.lastMeasuredColumnIndex;\n  var totalSizeOfMeasuredRows = 0; // Edge case check for when the number of items decreases while a scroll is in progress.\n  // https://github.com/bvaughn/react-window/pull/138\n\n  if (lastMeasuredColumnIndex >= columnCount) {\n    lastMeasuredColumnIndex = columnCount - 1;\n  }\n\n  if (lastMeasuredColumnIndex >= 0) {\n    var itemMetadata = columnMetadataMap[lastMeasuredColumnIndex];\n    totalSizeOfMeasuredRows = itemMetadata.offset + itemMetadata.size;\n  }\n\n  var numUnmeasuredItems = columnCount - lastMeasuredColumnIndex - 1;\n  var totalSizeOfUnmeasuredItems = numUnmeasuredItems * estimatedColumnWidth;\n  return totalSizeOfMeasuredRows + totalSizeOfUnmeasuredItems;\n};\n\nvar getItemMetadata = function getItemMetadata(itemType, props, index, instanceProps) {\n  var itemMetadataMap, itemSize, lastMeasuredIndex;\n\n  if (itemType === 'column') {\n    itemMetadataMap = instanceProps.columnMetadataMap;\n    itemSize = props.columnWidth;\n    lastMeasuredIndex = instanceProps.lastMeasuredColumnIndex;\n  } else {\n    itemMetadataMap = instanceProps.rowMetadataMap;\n    itemSize = props.rowHeight;\n    lastMeasuredIndex = instanceProps.lastMeasuredRowIndex;\n  }\n\n  if (index > lastMeasuredIndex) {\n    var offset = 0;\n\n    if (lastMeasuredIndex >= 0) {\n      var itemMetadata = itemMetadataMap[lastMeasuredIndex];\n      offset = itemMetadata.offset + itemMetadata.size;\n    }\n\n    for (var i = lastMeasuredIndex + 1; i <= index; i++) {\n      var size = itemSize(i);\n      itemMetadataMap[i] = {\n        offset: offset,\n        size: size\n      };\n      offset += size;\n    }\n\n    if (itemType === 'column') {\n      instanceProps.lastMeasuredColumnIndex = index;\n    } else {\n      instanceProps.lastMeasuredRowIndex = index;\n    }\n  }\n\n  return itemMetadataMap[index];\n};\n\nvar findNearestItem = function findNearestItem(itemType, props, instanceProps, offset) {\n  var itemMetadataMap, lastMeasuredIndex;\n\n  if (itemType === 'column') {\n    itemMetadataMap = instanceProps.columnMetadataMap;\n    lastMeasuredIndex = instanceProps.lastMeasuredColumnIndex;\n  } else {\n    itemMetadataMap = instanceProps.rowMetadataMap;\n    lastMeasuredIndex = instanceProps.lastMeasuredRowIndex;\n  }\n\n  var lastMeasuredItemOffset = lastMeasuredIndex > 0 ? itemMetadataMap[lastMeasuredIndex].offset : 0;\n\n  if (lastMeasuredItemOffset >= offset) {\n    // If we've already measured items within this range just use a binary search as it's faster.\n    return findNearestItemBinarySearch(itemType, props, instanceProps, lastMeasuredIndex, 0, offset);\n  } else {\n    // If we haven't yet measured this high, fallback to an exponential search with an inner binary search.\n    // The exponential search avoids pre-computing sizes for the full set of items as a binary search would.\n    // The overall complexity for this approach is O(log n).\n    return findNearestItemExponentialSearch(itemType, props, instanceProps, Math.max(0, lastMeasuredIndex), offset);\n  }\n};\n\nvar findNearestItemBinarySearch = function findNearestItemBinarySearch(itemType, props, instanceProps, high, low, offset) {\n  while (low <= high) {\n    var middle = low + Math.floor((high - low) / 2);\n    var currentOffset = getItemMetadata(itemType, props, middle, instanceProps).offset;\n\n    if (currentOffset === offset) {\n      return middle;\n    } else if (currentOffset < offset) {\n      low = middle + 1;\n    } else if (currentOffset > offset) {\n      high = middle - 1;\n    }\n  }\n\n  if (low > 0) {\n    return low - 1;\n  } else {\n    return 0;\n  }\n};\n\nvar findNearestItemExponentialSearch = function findNearestItemExponentialSearch(itemType, props, instanceProps, index, offset) {\n  var itemCount = itemType === 'column' ? props.columnCount : props.rowCount;\n  var interval = 1;\n\n  while (index < itemCount && getItemMetadata(itemType, props, index, instanceProps).offset < offset) {\n    index += interval;\n    interval *= 2;\n  }\n\n  return findNearestItemBinarySearch(itemType, props, instanceProps, Math.min(index, itemCount - 1), Math.floor(index / 2), offset);\n};\n\nvar getOffsetForIndexAndAlignment = function getOffsetForIndexAndAlignment(itemType, props, index, align, scrollOffset, instanceProps, scrollbarSize) {\n  var size = itemType === 'column' ? props.width : props.height;\n  var itemMetadata = getItemMetadata(itemType, props, index, instanceProps); // Get estimated total size after ItemMetadata is computed,\n  // To ensure it reflects actual measurements instead of just estimates.\n\n  var estimatedTotalSize = itemType === 'column' ? getEstimatedTotalWidth(props, instanceProps) : getEstimatedTotalHeight(props, instanceProps);\n  var maxOffset = Math.max(0, Math.min(estimatedTotalSize - size, itemMetadata.offset));\n  var minOffset = Math.max(0, itemMetadata.offset - size + scrollbarSize + itemMetadata.size);\n\n  if (align === 'smart') {\n    if (scrollOffset >= minOffset - size && scrollOffset <= maxOffset + size) {\n      align = 'auto';\n    } else {\n      align = 'center';\n    }\n  }\n\n  switch (align) {\n    case 'start':\n      return maxOffset;\n\n    case 'end':\n      return minOffset;\n\n    case 'center':\n      return Math.round(minOffset + (maxOffset - minOffset) / 2);\n\n    case 'auto':\n    default:\n      if (scrollOffset >= minOffset && scrollOffset <= maxOffset) {\n        return scrollOffset;\n      } else if (minOffset > maxOffset) {\n        // Because we only take into account the scrollbar size when calculating minOffset\n        // this value can be larger than maxOffset when at the end of the list\n        return minOffset;\n      } else if (scrollOffset < minOffset) {\n        return minOffset;\n      } else {\n        return maxOffset;\n      }\n\n  }\n};\n\nvar VariableSizeGrid =\n/*#__PURE__*/\ncreateGridComponent({\n  getColumnOffset: function getColumnOffset(props, index, instanceProps) {\n    return getItemMetadata('column', props, index, instanceProps).offset;\n  },\n  getColumnStartIndexForOffset: function getColumnStartIndexForOffset(props, scrollLeft, instanceProps) {\n    return findNearestItem('column', props, instanceProps, scrollLeft);\n  },\n  getColumnStopIndexForStartIndex: function getColumnStopIndexForStartIndex(props, startIndex, scrollLeft, instanceProps) {\n    var columnCount = props.columnCount,\n        width = props.width;\n    var itemMetadata = getItemMetadata('column', props, startIndex, instanceProps);\n    var maxOffset = scrollLeft + width;\n    var offset = itemMetadata.offset + itemMetadata.size;\n    var stopIndex = startIndex;\n\n    while (stopIndex < columnCount - 1 && offset < maxOffset) {\n      stopIndex++;\n      offset += getItemMetadata('column', props, stopIndex, instanceProps).size;\n    }\n\n    return stopIndex;\n  },\n  getColumnWidth: function getColumnWidth(props, index, instanceProps) {\n    return instanceProps.columnMetadataMap[index].size;\n  },\n  getEstimatedTotalHeight: getEstimatedTotalHeight,\n  getEstimatedTotalWidth: getEstimatedTotalWidth,\n  getOffsetForColumnAndAlignment: function getOffsetForColumnAndAlignment(props, index, align, scrollOffset, instanceProps, scrollbarSize) {\n    return getOffsetForIndexAndAlignment('column', props, index, align, scrollOffset, instanceProps, scrollbarSize);\n  },\n  getOffsetForRowAndAlignment: function getOffsetForRowAndAlignment(props, index, align, scrollOffset, instanceProps, scrollbarSize) {\n    return getOffsetForIndexAndAlignment('row', props, index, align, scrollOffset, instanceProps, scrollbarSize);\n  },\n  getRowOffset: function getRowOffset(props, index, instanceProps) {\n    return getItemMetadata('row', props, index, instanceProps).offset;\n  },\n  getRowHeight: function getRowHeight(props, index, instanceProps) {\n    return instanceProps.rowMetadataMap[index].size;\n  },\n  getRowStartIndexForOffset: function getRowStartIndexForOffset(props, scrollTop, instanceProps) {\n    return findNearestItem('row', props, instanceProps, scrollTop);\n  },\n  getRowStopIndexForStartIndex: function getRowStopIndexForStartIndex(props, startIndex, scrollTop, instanceProps) {\n    var rowCount = props.rowCount,\n        height = props.height;\n    var itemMetadata = getItemMetadata('row', props, startIndex, instanceProps);\n    var maxOffset = scrollTop + height;\n    var offset = itemMetadata.offset + itemMetadata.size;\n    var stopIndex = startIndex;\n\n    while (stopIndex < rowCount - 1 && offset < maxOffset) {\n      stopIndex++;\n      offset += getItemMetadata('row', props, stopIndex, instanceProps).size;\n    }\n\n    return stopIndex;\n  },\n  initInstanceProps: function initInstanceProps(props, instance) {\n    var _ref5 = props,\n        estimatedColumnWidth = _ref5.estimatedColumnWidth,\n        estimatedRowHeight = _ref5.estimatedRowHeight;\n    var instanceProps = {\n      columnMetadataMap: {},\n      estimatedColumnWidth: estimatedColumnWidth || DEFAULT_ESTIMATED_ITEM_SIZE,\n      estimatedRowHeight: estimatedRowHeight || DEFAULT_ESTIMATED_ITEM_SIZE,\n      lastMeasuredColumnIndex: -1,\n      lastMeasuredRowIndex: -1,\n      rowMetadataMap: {}\n    };\n\n    instance.resetAfterColumnIndex = function (columnIndex, shouldForceUpdate) {\n      if (shouldForceUpdate === void 0) {\n        shouldForceUpdate = true;\n      }\n\n      instance.resetAfterIndices({\n        columnIndex: columnIndex,\n        shouldForceUpdate: shouldForceUpdate\n      });\n    };\n\n    instance.resetAfterRowIndex = function (rowIndex, shouldForceUpdate) {\n      if (shouldForceUpdate === void 0) {\n        shouldForceUpdate = true;\n      }\n\n      instance.resetAfterIndices({\n        rowIndex: rowIndex,\n        shouldForceUpdate: shouldForceUpdate\n      });\n    };\n\n    instance.resetAfterIndices = function (_ref6) {\n      var columnIndex = _ref6.columnIndex,\n          rowIndex = _ref6.rowIndex,\n          _ref6$shouldForceUpda = _ref6.shouldForceUpdate,\n          shouldForceUpdate = _ref6$shouldForceUpda === void 0 ? true : _ref6$shouldForceUpda;\n\n      if (typeof columnIndex === 'number') {\n        instanceProps.lastMeasuredColumnIndex = Math.min(instanceProps.lastMeasuredColumnIndex, columnIndex - 1);\n      }\n\n      if (typeof rowIndex === 'number') {\n        instanceProps.lastMeasuredRowIndex = Math.min(instanceProps.lastMeasuredRowIndex, rowIndex - 1);\n      } // We could potentially optimize further by only evicting styles after this index,\n      // But since styles are only cached while scrolling is in progress-\n      // It seems an unnecessary optimization.\n      // It's unlikely that resetAfterIndex() will be called while a user is scrolling.\n\n\n      instance._getItemStyleCache(-1);\n\n      if (shouldForceUpdate) {\n        instance.forceUpdate();\n      }\n    };\n\n    return instanceProps;\n  },\n  shouldResetStyleCacheOnItemSizeChange: false,\n  validateProps: function validateProps(_ref7) {\n    var columnWidth = _ref7.columnWidth,\n        rowHeight = _ref7.rowHeight;\n\n    if (process.env.NODE_ENV !== 'production') {\n      if (typeof columnWidth !== 'function') {\n        throw Error('An invalid \"columnWidth\" prop has been specified. ' + 'Value should be a function. ' + (\"\\\"\" + (columnWidth === null ? 'null' : typeof columnWidth) + \"\\\" was specified.\"));\n      } else if (typeof rowHeight !== 'function') {\n        throw Error('An invalid \"rowHeight\" prop has been specified. ' + 'Value should be a function. ' + (\"\\\"\" + (rowHeight === null ? 'null' : typeof rowHeight) + \"\\\" was specified.\"));\n      }\n    }\n  }\n});\n\nvar IS_SCROLLING_DEBOUNCE_INTERVAL$1 = 150;\n\nvar defaultItemKey$1 = function defaultItemKey(index, data) {\n  return index;\n}; // In DEV mode, this Set helps us only log a warning once per component instance.\n// This avoids spamming the console every time a render happens.\n\n\nvar devWarningsDirection = null;\nvar devWarningsTagName$1 = null;\n\nif (process.env.NODE_ENV !== 'production') {\n  if (typeof window !== 'undefined' && typeof window.WeakSet !== 'undefined') {\n    devWarningsDirection =\n    /*#__PURE__*/\n    new WeakSet();\n    devWarningsTagName$1 =\n    /*#__PURE__*/\n    new WeakSet();\n  }\n}\n\nfunction createListComponent(_ref) {\n  var _class, _temp;\n\n  var getItemOffset = _ref.getItemOffset,\n      getEstimatedTotalSize = _ref.getEstimatedTotalSize,\n      getItemSize = _ref.getItemSize,\n      getOffsetForIndexAndAlignment = _ref.getOffsetForIndexAndAlignment,\n      getStartIndexForOffset = _ref.getStartIndexForOffset,\n      getStopIndexForStartIndex = _ref.getStopIndexForStartIndex,\n      initInstanceProps = _ref.initInstanceProps,\n      shouldResetStyleCacheOnItemSizeChange = _ref.shouldResetStyleCacheOnItemSizeChange,\n      validateProps = _ref.validateProps;\n  return _temp = _class =\n  /*#__PURE__*/\n  function (_PureComponent) {\n    _inheritsLoose(List, _PureComponent);\n\n    // Always use explicit constructor for React components.\n    // It produces less code after transpilation. (#26)\n    // eslint-disable-next-line no-useless-constructor\n    function List(props) {\n      var _this;\n\n      _this = _PureComponent.call(this, props) || this;\n      _this._instanceProps = initInstanceProps(_this.props, _assertThisInitialized(_assertThisInitialized(_this)));\n      _this._outerRef = void 0;\n      _this._resetIsScrollingTimeoutId = null;\n      _this.state = {\n        instance: _assertThisInitialized(_assertThisInitialized(_this)),\n        isScrolling: false,\n        scrollDirection: 'forward',\n        scrollOffset: typeof _this.props.initialScrollOffset === 'number' ? _this.props.initialScrollOffset : 0,\n        scrollUpdateWasRequested: false\n      };\n      _this._callOnItemsRendered = void 0;\n      _this._callOnItemsRendered = memoizeOne(function (overscanStartIndex, overscanStopIndex, visibleStartIndex, visibleStopIndex) {\n        return _this.props.onItemsRendered({\n          overscanStartIndex: overscanStartIndex,\n          overscanStopIndex: overscanStopIndex,\n          visibleStartIndex: visibleStartIndex,\n          visibleStopIndex: visibleStopIndex\n        });\n      });\n      _this._callOnScroll = void 0;\n      _this._callOnScroll = memoizeOne(function (scrollDirection, scrollOffset, scrollUpdateWasRequested) {\n        return _this.props.onScroll({\n          scrollDirection: scrollDirection,\n          scrollOffset: scrollOffset,\n          scrollUpdateWasRequested: scrollUpdateWasRequested\n        });\n      });\n      _this._getItemStyle = void 0;\n\n      _this._getItemStyle = function (index) {\n        var _this$props = _this.props,\n            direction = _this$props.direction,\n            itemSize = _this$props.itemSize,\n            layout = _this$props.layout;\n\n        var itemStyleCache = _this._getItemStyleCache(shouldResetStyleCacheOnItemSizeChange && itemSize, shouldResetStyleCacheOnItemSizeChange && layout, shouldResetStyleCacheOnItemSizeChange && direction);\n\n        var style;\n\n        if (itemStyleCache.hasOwnProperty(index)) {\n          style = itemStyleCache[index];\n        } else {\n          var _offset = getItemOffset(_this.props, index, _this._instanceProps);\n\n          var size = getItemSize(_this.props, index, _this._instanceProps); // TODO Deprecate direction \"horizontal\"\n\n          var isHorizontal = direction === 'horizontal' || layout === 'horizontal';\n          var isRtl = direction === 'rtl';\n          var offsetHorizontal = isHorizontal ? _offset : 0;\n          itemStyleCache[index] = style = {\n            position: 'absolute',\n            left: isRtl ? undefined : offsetHorizontal,\n            right: isRtl ? offsetHorizontal : undefined,\n            top: !isHorizontal ? _offset : 0,\n            height: !isHorizontal ? size : '100%',\n            width: isHorizontal ? size : '100%'\n          };\n        }\n\n        return style;\n      };\n\n      _this._getItemStyleCache = void 0;\n      _this._getItemStyleCache = memoizeOne(function (_, __, ___) {\n        return {};\n      });\n\n      _this._onScrollHorizontal = function (event) {\n        var _event$currentTarget = event.currentTarget,\n            clientWidth = _event$currentTarget.clientWidth,\n            scrollLeft = _event$currentTarget.scrollLeft,\n            scrollWidth = _event$currentTarget.scrollWidth;\n\n        _this.setState(function (prevState) {\n          if (prevState.scrollOffset === scrollLeft) {\n            // Scroll position may have been updated by cDM/cDU,\n            // In which case we don't need to trigger another render,\n            // And we don't want to update state.isScrolling.\n            return null;\n          }\n\n          var direction = _this.props.direction;\n          var scrollOffset = scrollLeft;\n\n          if (direction === 'rtl') {\n            // TRICKY According to the spec, scrollLeft should be negative for RTL aligned elements.\n            // This is not the case for all browsers though (e.g. Chrome reports values as positive, measured relative to the left).\n            // It's also easier for this component if we convert offsets to the same format as they would be in for ltr.\n            // So the simplest solution is to determine which browser behavior we're dealing with, and convert based on it.\n            switch (getRTLOffsetType()) {\n              case 'negative':\n                scrollOffset = -scrollLeft;\n                break;\n\n              case 'positive-descending':\n                scrollOffset = scrollWidth - clientWidth - scrollLeft;\n                break;\n            }\n          } // Prevent Safari's elastic scrolling from causing visual shaking when scrolling past bounds.\n\n\n          scrollOffset = Math.max(0, Math.min(scrollOffset, scrollWidth - clientWidth));\n          return {\n            isScrolling: true,\n            scrollDirection: prevState.scrollOffset < scrollLeft ? 'forward' : 'backward',\n            scrollOffset: scrollOffset,\n            scrollUpdateWasRequested: false\n          };\n        }, _this._resetIsScrollingDebounced);\n      };\n\n      _this._onScrollVertical = function (event) {\n        var _event$currentTarget2 = event.currentTarget,\n            clientHeight = _event$currentTarget2.clientHeight,\n            scrollHeight = _event$currentTarget2.scrollHeight,\n            scrollTop = _event$currentTarget2.scrollTop;\n\n        _this.setState(function (prevState) {\n          if (prevState.scrollOffset === scrollTop) {\n            // Scroll position may have been updated by cDM/cDU,\n            // In which case we don't need to trigger another render,\n            // And we don't want to update state.isScrolling.\n            return null;\n          } // Prevent Safari's elastic scrolling from causing visual shaking when scrolling past bounds.\n\n\n          var scrollOffset = Math.max(0, Math.min(scrollTop, scrollHeight - clientHeight));\n          return {\n            isScrolling: true,\n            scrollDirection: prevState.scrollOffset < scrollOffset ? 'forward' : 'backward',\n            scrollOffset: scrollOffset,\n            scrollUpdateWasRequested: false\n          };\n        }, _this._resetIsScrollingDebounced);\n      };\n\n      _this._outerRefSetter = function (ref) {\n        var outerRef = _this.props.outerRef;\n        _this._outerRef = ref;\n\n        if (typeof outerRef === 'function') {\n          outerRef(ref);\n        } else if (outerRef != null && typeof outerRef === 'object' && outerRef.hasOwnProperty('current')) {\n          outerRef.current = ref;\n        }\n      };\n\n      _this._resetIsScrollingDebounced = function () {\n        if (_this._resetIsScrollingTimeoutId !== null) {\n          cancelTimeout(_this._resetIsScrollingTimeoutId);\n        }\n\n        _this._resetIsScrollingTimeoutId = requestTimeout(_this._resetIsScrolling, IS_SCROLLING_DEBOUNCE_INTERVAL$1);\n      };\n\n      _this._resetIsScrolling = function () {\n        _this._resetIsScrollingTimeoutId = null;\n\n        _this.setState({\n          isScrolling: false\n        }, function () {\n          // Clear style cache after state update has been committed.\n          // This way we don't break pure sCU for items that don't use isScrolling param.\n          _this._getItemStyleCache(-1, null);\n        });\n      };\n\n      return _this;\n    }\n\n    List.getDerivedStateFromProps = function getDerivedStateFromProps(nextProps, prevState) {\n      validateSharedProps$1(nextProps, prevState);\n      validateProps(nextProps);\n      return null;\n    };\n\n    var _proto = List.prototype;\n\n    _proto.scrollTo = function scrollTo(scrollOffset) {\n      scrollOffset = Math.max(0, scrollOffset);\n      this.setState(function (prevState) {\n        if (prevState.scrollOffset === scrollOffset) {\n          return null;\n        }\n\n        return {\n          scrollDirection: prevState.scrollOffset < scrollOffset ? 'forward' : 'backward',\n          scrollOffset: scrollOffset,\n          scrollUpdateWasRequested: true\n        };\n      }, this._resetIsScrollingDebounced);\n    };\n\n    _proto.scrollToItem = function scrollToItem(index, align) {\n      if (align === void 0) {\n        align = 'auto';\n      }\n\n      var itemCount = this.props.itemCount;\n      var scrollOffset = this.state.scrollOffset;\n      index = Math.max(0, Math.min(index, itemCount - 1));\n      this.scrollTo(getOffsetForIndexAndAlignment(this.props, index, align, scrollOffset, this._instanceProps));\n    };\n\n    _proto.componentDidMount = function componentDidMount() {\n      var _this$props2 = this.props,\n          direction = _this$props2.direction,\n          initialScrollOffset = _this$props2.initialScrollOffset,\n          layout = _this$props2.layout;\n\n      if (typeof initialScrollOffset === 'number' && this._outerRef != null) {\n        var outerRef = this._outerRef; // TODO Deprecate direction \"horizontal\"\n\n        if (direction === 'horizontal' || layout === 'horizontal') {\n          outerRef.scrollLeft = initialScrollOffset;\n        } else {\n          outerRef.scrollTop = initialScrollOffset;\n        }\n      }\n\n      this._callPropsCallbacks();\n    };\n\n    _proto.componentDidUpdate = function componentDidUpdate() {\n      var _this$props3 = this.props,\n          direction = _this$props3.direction,\n          layout = _this$props3.layout;\n      var _this$state = this.state,\n          scrollOffset = _this$state.scrollOffset,\n          scrollUpdateWasRequested = _this$state.scrollUpdateWasRequested;\n\n      if (scrollUpdateWasRequested && this._outerRef != null) {\n        var outerRef = this._outerRef; // TODO Deprecate direction \"horizontal\"\n\n        if (direction === 'horizontal' || layout === 'horizontal') {\n          if (direction === 'rtl') {\n            // TRICKY According to the spec, scrollLeft should be negative for RTL aligned elements.\n            // This is not the case for all browsers though (e.g. Chrome reports values as positive, measured relative to the left).\n            // So we need to determine which browser behavior we're dealing with, and mimic it.\n            switch (getRTLOffsetType()) {\n              case 'negative':\n                outerRef.scrollLeft = -scrollOffset;\n                break;\n\n              case 'positive-ascending':\n                outerRef.scrollLeft = scrollOffset;\n                break;\n\n              default:\n                var clientWidth = outerRef.clientWidth,\n                    scrollWidth = outerRef.scrollWidth;\n                outerRef.scrollLeft = scrollWidth - clientWidth - scrollOffset;\n                break;\n            }\n          } else {\n            outerRef.scrollLeft = scrollOffset;\n          }\n        } else {\n          outerRef.scrollTop = scrollOffset;\n        }\n      }\n\n      this._callPropsCallbacks();\n    };\n\n    _proto.componentWillUnmount = function componentWillUnmount() {\n      if (this._resetIsScrollingTimeoutId !== null) {\n        cancelTimeout(this._resetIsScrollingTimeoutId);\n      }\n    };\n\n    _proto.render = function render() {\n      var _this$props4 = this.props,\n          children = _this$props4.children,\n          className = _this$props4.className,\n          direction = _this$props4.direction,\n          height = _this$props4.height,\n          innerRef = _this$props4.innerRef,\n          innerElementType = _this$props4.innerElementType,\n          innerTagName = _this$props4.innerTagName,\n          itemCount = _this$props4.itemCount,\n          itemData = _this$props4.itemData,\n          _this$props4$itemKey = _this$props4.itemKey,\n          itemKey = _this$props4$itemKey === void 0 ? defaultItemKey$1 : _this$props4$itemKey,\n          layout = _this$props4.layout,\n          outerElementType = _this$props4.outerElementType,\n          outerTagName = _this$props4.outerTagName,\n          style = _this$props4.style,\n          useIsScrolling = _this$props4.useIsScrolling,\n          width = _this$props4.width;\n      var isScrolling = this.state.isScrolling; // TODO Deprecate direction \"horizontal\"\n\n      var isHorizontal = direction === 'horizontal' || layout === 'horizontal';\n      var onScroll = isHorizontal ? this._onScrollHorizontal : this._onScrollVertical;\n\n      var _this$_getRangeToRend = this._getRangeToRender(),\n          startIndex = _this$_getRangeToRend[0],\n          stopIndex = _this$_getRangeToRend[1];\n\n      var items = [];\n\n      if (itemCount > 0) {\n        for (var _index = startIndex; _index <= stopIndex; _index++) {\n          items.push(createElement(children, {\n            data: itemData,\n            key: itemKey(_index, itemData),\n            index: _index,\n            isScrolling: useIsScrolling ? isScrolling : undefined,\n            style: this._getItemStyle(_index)\n          }));\n        }\n      } // Read this value AFTER items have been created,\n      // So their actual sizes (if variable) are taken into consideration.\n\n\n      var estimatedTotalSize = getEstimatedTotalSize(this.props, this._instanceProps);\n      return createElement(outerElementType || outerTagName || 'div', {\n        className: className,\n        onScroll: onScroll,\n        ref: this._outerRefSetter,\n        style: _extends({\n          position: 'relative',\n          height: height,\n          width: width,\n          overflow: 'auto',\n          WebkitOverflowScrolling: 'touch',\n          willChange: 'transform',\n          direction: direction\n        }, style)\n      }, createElement(innerElementType || innerTagName || 'div', {\n        children: items,\n        ref: innerRef,\n        style: {\n          height: isHorizontal ? '100%' : estimatedTotalSize,\n          pointerEvents: isScrolling ? 'none' : undefined,\n          width: isHorizontal ? estimatedTotalSize : '100%'\n        }\n      }));\n    };\n\n    _proto._callPropsCallbacks = function _callPropsCallbacks() {\n      if (typeof this.props.onItemsRendered === 'function') {\n        var itemCount = this.props.itemCount;\n\n        if (itemCount > 0) {\n          var _this$_getRangeToRend2 = this._getRangeToRender(),\n              _overscanStartIndex = _this$_getRangeToRend2[0],\n              _overscanStopIndex = _this$_getRangeToRend2[1],\n              _visibleStartIndex = _this$_getRangeToRend2[2],\n              _visibleStopIndex = _this$_getRangeToRend2[3];\n\n          this._callOnItemsRendered(_overscanStartIndex, _overscanStopIndex, _visibleStartIndex, _visibleStopIndex);\n        }\n      }\n\n      if (typeof this.props.onScroll === 'function') {\n        var _this$state2 = this.state,\n            _scrollDirection = _this$state2.scrollDirection,\n            _scrollOffset = _this$state2.scrollOffset,\n            _scrollUpdateWasRequested = _this$state2.scrollUpdateWasRequested;\n\n        this._callOnScroll(_scrollDirection, _scrollOffset, _scrollUpdateWasRequested);\n      }\n    }; // Lazily create and cache item styles while scrolling,\n    // So that pure component sCU will prevent re-renders.\n    // We maintain this cache, and pass a style prop rather than index,\n    // So that List can clear cached styles and force item re-render if necessary.\n\n\n    _proto._getRangeToRender = function _getRangeToRender() {\n      var _this$props5 = this.props,\n          itemCount = _this$props5.itemCount,\n          overscanCount = _this$props5.overscanCount;\n      var _this$state3 = this.state,\n          isScrolling = _this$state3.isScrolling,\n          scrollDirection = _this$state3.scrollDirection,\n          scrollOffset = _this$state3.scrollOffset;\n\n      if (itemCount === 0) {\n        return [0, 0, 0, 0];\n      }\n\n      var startIndex = getStartIndexForOffset(this.props, scrollOffset, this._instanceProps);\n      var stopIndex = getStopIndexForStartIndex(this.props, startIndex, scrollOffset, this._instanceProps); // Overscan by one item in each direction so that tab/focus works.\n      // If there isn't at least one extra item, tab loops back around.\n\n      var overscanBackward = !isScrolling || scrollDirection === 'backward' ? Math.max(1, overscanCount) : 1;\n      var overscanForward = !isScrolling || scrollDirection === 'forward' ? Math.max(1, overscanCount) : 1;\n      return [Math.max(0, startIndex - overscanBackward), Math.max(0, Math.min(itemCount - 1, stopIndex + overscanForward)), startIndex, stopIndex];\n    };\n\n    return List;\n  }(PureComponent), _class.defaultProps = {\n    direction: 'ltr',\n    itemData: undefined,\n    layout: 'vertical',\n    overscanCount: 2,\n    useIsScrolling: false\n  }, _temp;\n} // NOTE: I considered further wrapping individual items with a pure ListItem component.\n// This would avoid ever calling the render function for the same index more than once,\n// But it would also add the overhead of a lot of components/fibers.\n// I assume people already do this (render function returning a class component),\n// So my doing it would just unnecessarily double the wrappers.\n\nvar validateSharedProps$1 = function validateSharedProps(_ref2, _ref3) {\n  var children = _ref2.children,\n      direction = _ref2.direction,\n      height = _ref2.height,\n      layout = _ref2.layout,\n      innerTagName = _ref2.innerTagName,\n      outerTagName = _ref2.outerTagName,\n      width = _ref2.width;\n  var instance = _ref3.instance;\n\n  if (process.env.NODE_ENV !== 'production') {\n    if (innerTagName != null || outerTagName != null) {\n      if (devWarningsTagName$1 && !devWarningsTagName$1.has(instance)) {\n        devWarningsTagName$1.add(instance);\n        console.warn('The innerTagName and outerTagName props have been deprecated. ' + 'Please use the innerElementType and outerElementType props instead.');\n      }\n    } // TODO Deprecate direction \"horizontal\"\n\n\n    var isHorizontal = direction === 'horizontal' || layout === 'horizontal';\n\n    switch (direction) {\n      case 'horizontal':\n      case 'vertical':\n        if (devWarningsDirection && !devWarningsDirection.has(instance)) {\n          devWarningsDirection.add(instance);\n          console.warn('The direction prop should be either \"ltr\" (default) or \"rtl\". ' + 'Please use the layout prop to specify \"vertical\" (default) or \"horizontal\" orientation.');\n        }\n\n        break;\n\n      case 'ltr':\n      case 'rtl':\n        // Valid values\n        break;\n\n      default:\n        throw Error('An invalid \"direction\" prop has been specified. ' + 'Value should be either \"ltr\" or \"rtl\". ' + (\"\\\"\" + direction + \"\\\" was specified.\"));\n    }\n\n    switch (layout) {\n      case 'horizontal':\n      case 'vertical':\n        // Valid values\n        break;\n\n      default:\n        throw Error('An invalid \"layout\" prop has been specified. ' + 'Value should be either \"horizontal\" or \"vertical\". ' + (\"\\\"\" + layout + \"\\\" was specified.\"));\n    }\n\n    if (children == null) {\n      throw Error('An invalid \"children\" prop has been specified. ' + 'Value should be a React component. ' + (\"\\\"\" + (children === null ? 'null' : typeof children) + \"\\\" was specified.\"));\n    }\n\n    if (isHorizontal && typeof width !== 'number') {\n      throw Error('An invalid \"width\" prop has been specified. ' + 'Horizontal lists must specify a number for width. ' + (\"\\\"\" + (width === null ? 'null' : typeof width) + \"\\\" was specified.\"));\n    } else if (!isHorizontal && typeof height !== 'number') {\n      throw Error('An invalid \"height\" prop has been specified. ' + 'Vertical lists must specify a number for height. ' + (\"\\\"\" + (height === null ? 'null' : typeof height) + \"\\\" was specified.\"));\n    }\n  }\n};\n\nvar DEFAULT_ESTIMATED_ITEM_SIZE$1 = 50;\n\nvar getItemMetadata$1 = function getItemMetadata(props, index, instanceProps) {\n  var _ref = props,\n      itemSize = _ref.itemSize;\n  var itemMetadataMap = instanceProps.itemMetadataMap,\n      lastMeasuredIndex = instanceProps.lastMeasuredIndex;\n\n  if (index > lastMeasuredIndex) {\n    var offset = 0;\n\n    if (lastMeasuredIndex >= 0) {\n      var itemMetadata = itemMetadataMap[lastMeasuredIndex];\n      offset = itemMetadata.offset + itemMetadata.size;\n    }\n\n    for (var i = lastMeasuredIndex + 1; i <= index; i++) {\n      var size = itemSize(i);\n      itemMetadataMap[i] = {\n        offset: offset,\n        size: size\n      };\n      offset += size;\n    }\n\n    instanceProps.lastMeasuredIndex = index;\n  }\n\n  return itemMetadataMap[index];\n};\n\nvar findNearestItem$1 = function findNearestItem(props, instanceProps, offset) {\n  var itemMetadataMap = instanceProps.itemMetadataMap,\n      lastMeasuredIndex = instanceProps.lastMeasuredIndex;\n  var lastMeasuredItemOffset = lastMeasuredIndex > 0 ? itemMetadataMap[lastMeasuredIndex].offset : 0;\n\n  if (lastMeasuredItemOffset >= offset) {\n    // If we've already measured items within this range just use a binary search as it's faster.\n    return findNearestItemBinarySearch$1(props, instanceProps, lastMeasuredIndex, 0, offset);\n  } else {\n    // If we haven't yet measured this high, fallback to an exponential search with an inner binary search.\n    // The exponential search avoids pre-computing sizes for the full set of items as a binary search would.\n    // The overall complexity for this approach is O(log n).\n    return findNearestItemExponentialSearch$1(props, instanceProps, Math.max(0, lastMeasuredIndex), offset);\n  }\n};\n\nvar findNearestItemBinarySearch$1 = function findNearestItemBinarySearch(props, instanceProps, high, low, offset) {\n  while (low <= high) {\n    var middle = low + Math.floor((high - low) / 2);\n    var currentOffset = getItemMetadata$1(props, middle, instanceProps).offset;\n\n    if (currentOffset === offset) {\n      return middle;\n    } else if (currentOffset < offset) {\n      low = middle + 1;\n    } else if (currentOffset > offset) {\n      high = middle - 1;\n    }\n  }\n\n  if (low > 0) {\n    return low - 1;\n  } else {\n    return 0;\n  }\n};\n\nvar findNearestItemExponentialSearch$1 = function findNearestItemExponentialSearch(props, instanceProps, index, offset) {\n  var itemCount = props.itemCount;\n  var interval = 1;\n\n  while (index < itemCount && getItemMetadata$1(props, index, instanceProps).offset < offset) {\n    index += interval;\n    interval *= 2;\n  }\n\n  return findNearestItemBinarySearch$1(props, instanceProps, Math.min(index, itemCount - 1), Math.floor(index / 2), offset);\n};\n\nvar getEstimatedTotalSize = function getEstimatedTotalSize(_ref2, _ref3) {\n  var itemCount = _ref2.itemCount;\n  var itemMetadataMap = _ref3.itemMetadataMap,\n      estimatedItemSize = _ref3.estimatedItemSize,\n      lastMeasuredIndex = _ref3.lastMeasuredIndex;\n  var totalSizeOfMeasuredItems = 0; // Edge case check for when the number of items decreases while a scroll is in progress.\n  // https://github.com/bvaughn/react-window/pull/138\n\n  if (lastMeasuredIndex >= itemCount) {\n    lastMeasuredIndex = itemCount - 1;\n  }\n\n  if (lastMeasuredIndex >= 0) {\n    var itemMetadata = itemMetadataMap[lastMeasuredIndex];\n    totalSizeOfMeasuredItems = itemMetadata.offset + itemMetadata.size;\n  }\n\n  var numUnmeasuredItems = itemCount - lastMeasuredIndex - 1;\n  var totalSizeOfUnmeasuredItems = numUnmeasuredItems * estimatedItemSize;\n  return totalSizeOfMeasuredItems + totalSizeOfUnmeasuredItems;\n};\n\nvar VariableSizeList =\n/*#__PURE__*/\ncreateListComponent({\n  getItemOffset: function getItemOffset(props, index, instanceProps) {\n    return getItemMetadata$1(props, index, instanceProps).offset;\n  },\n  getItemSize: function getItemSize(props, index, instanceProps) {\n    return instanceProps.itemMetadataMap[index].size;\n  },\n  getEstimatedTotalSize: getEstimatedTotalSize,\n  getOffsetForIndexAndAlignment: function getOffsetForIndexAndAlignment(props, index, align, scrollOffset, instanceProps) {\n    var direction = props.direction,\n        height = props.height,\n        layout = props.layout,\n        width = props.width; // TODO Deprecate direction \"horizontal\"\n\n    var isHorizontal = direction === 'horizontal' || layout === 'horizontal';\n    var size = isHorizontal ? width : height;\n    var itemMetadata = getItemMetadata$1(props, index, instanceProps); // Get estimated total size after ItemMetadata is computed,\n    // To ensure it reflects actual measurements instead of just estimates.\n\n    var estimatedTotalSize = getEstimatedTotalSize(props, instanceProps);\n    var maxOffset = Math.max(0, Math.min(estimatedTotalSize - size, itemMetadata.offset));\n    var minOffset = Math.max(0, itemMetadata.offset - size + itemMetadata.size);\n\n    if (align === 'smart') {\n      if (scrollOffset >= minOffset - size && scrollOffset <= maxOffset + size) {\n        align = 'auto';\n      } else {\n        align = 'center';\n      }\n    }\n\n    switch (align) {\n      case 'start':\n        return maxOffset;\n\n      case 'end':\n        return minOffset;\n\n      case 'center':\n        return Math.round(minOffset + (maxOffset - minOffset) / 2);\n\n      case 'auto':\n      default:\n        if (scrollOffset >= minOffset && scrollOffset <= maxOffset) {\n          return scrollOffset;\n        } else if (scrollOffset < minOffset) {\n          return minOffset;\n        } else {\n          return maxOffset;\n        }\n\n    }\n  },\n  getStartIndexForOffset: function getStartIndexForOffset(props, offset, instanceProps) {\n    return findNearestItem$1(props, instanceProps, offset);\n  },\n  getStopIndexForStartIndex: function getStopIndexForStartIndex(props, startIndex, scrollOffset, instanceProps) {\n    var direction = props.direction,\n        height = props.height,\n        itemCount = props.itemCount,\n        layout = props.layout,\n        width = props.width; // TODO Deprecate direction \"horizontal\"\n\n    var isHorizontal = direction === 'horizontal' || layout === 'horizontal';\n    var size = isHorizontal ? width : height;\n    var itemMetadata = getItemMetadata$1(props, startIndex, instanceProps);\n    var maxOffset = scrollOffset + size;\n    var offset = itemMetadata.offset + itemMetadata.size;\n    var stopIndex = startIndex;\n\n    while (stopIndex < itemCount - 1 && offset < maxOffset) {\n      stopIndex++;\n      offset += getItemMetadata$1(props, stopIndex, instanceProps).size;\n    }\n\n    return stopIndex;\n  },\n  initInstanceProps: function initInstanceProps(props, instance) {\n    var _ref4 = props,\n        estimatedItemSize = _ref4.estimatedItemSize;\n    var instanceProps = {\n      itemMetadataMap: {},\n      estimatedItemSize: estimatedItemSize || DEFAULT_ESTIMATED_ITEM_SIZE$1,\n      lastMeasuredIndex: -1\n    };\n\n    instance.resetAfterIndex = function (index, shouldForceUpdate) {\n      if (shouldForceUpdate === void 0) {\n        shouldForceUpdate = true;\n      }\n\n      instanceProps.lastMeasuredIndex = Math.min(instanceProps.lastMeasuredIndex, index - 1); // We could potentially optimize further by only evicting styles after this index,\n      // But since styles are only cached while scrolling is in progress-\n      // It seems an unnecessary optimization.\n      // It's unlikely that resetAfterIndex() will be called while a user is scrolling.\n\n      instance._getItemStyleCache(-1);\n\n      if (shouldForceUpdate) {\n        instance.forceUpdate();\n      }\n    };\n\n    return instanceProps;\n  },\n  shouldResetStyleCacheOnItemSizeChange: false,\n  validateProps: function validateProps(_ref5) {\n    var itemSize = _ref5.itemSize;\n\n    if (process.env.NODE_ENV !== 'production') {\n      if (typeof itemSize !== 'function') {\n        throw Error('An invalid \"itemSize\" prop has been specified. ' + 'Value should be a function. ' + (\"\\\"\" + (itemSize === null ? 'null' : typeof itemSize) + \"\\\" was specified.\"));\n      }\n    }\n  }\n});\n\nvar FixedSizeGrid =\n/*#__PURE__*/\ncreateGridComponent({\n  getColumnOffset: function getColumnOffset(_ref, index) {\n    var columnWidth = _ref.columnWidth;\n    return index * columnWidth;\n  },\n  getColumnWidth: function getColumnWidth(_ref2, index) {\n    var columnWidth = _ref2.columnWidth;\n    return columnWidth;\n  },\n  getRowOffset: function getRowOffset(_ref3, index) {\n    var rowHeight = _ref3.rowHeight;\n    return index * rowHeight;\n  },\n  getRowHeight: function getRowHeight(_ref4, index) {\n    var rowHeight = _ref4.rowHeight;\n    return rowHeight;\n  },\n  getEstimatedTotalHeight: function getEstimatedTotalHeight(_ref5) {\n    var rowCount = _ref5.rowCount,\n        rowHeight = _ref5.rowHeight;\n    return rowHeight * rowCount;\n  },\n  getEstimatedTotalWidth: function getEstimatedTotalWidth(_ref6) {\n    var columnCount = _ref6.columnCount,\n        columnWidth = _ref6.columnWidth;\n    return columnWidth * columnCount;\n  },\n  getOffsetForColumnAndAlignment: function getOffsetForColumnAndAlignment(_ref7, columnIndex, align, scrollLeft, instanceProps, scrollbarSize) {\n    var columnCount = _ref7.columnCount,\n        columnWidth = _ref7.columnWidth,\n        width = _ref7.width;\n    var lastColumnOffset = Math.max(0, columnCount * columnWidth - width);\n    var maxOffset = Math.min(lastColumnOffset, columnIndex * columnWidth);\n    var minOffset = Math.max(0, columnIndex * columnWidth - width + scrollbarSize + columnWidth);\n\n    if (align === 'smart') {\n      if (scrollLeft >= minOffset - width && scrollLeft <= maxOffset + width) {\n        align = 'auto';\n      } else {\n        align = 'center';\n      }\n    }\n\n    switch (align) {\n      case 'start':\n        return maxOffset;\n\n      case 'end':\n        return minOffset;\n\n      case 'center':\n        // \"Centered\" offset is usually the average of the min and max.\n        // But near the edges of the list, this doesn't hold true.\n        var middleOffset = Math.round(minOffset + (maxOffset - minOffset) / 2);\n\n        if (middleOffset < Math.ceil(width / 2)) {\n          return 0; // near the beginning\n        } else if (middleOffset > lastColumnOffset + Math.floor(width / 2)) {\n          return lastColumnOffset; // near the end\n        } else {\n          return middleOffset;\n        }\n\n      case 'auto':\n      default:\n        if (scrollLeft >= minOffset && scrollLeft <= maxOffset) {\n          return scrollLeft;\n        } else if (minOffset > maxOffset) {\n          // Because we only take into account the scrollbar size when calculating minOffset\n          // this value can be larger than maxOffset when at the end of the list\n          return minOffset;\n        } else if (scrollLeft < minOffset) {\n          return minOffset;\n        } else {\n          return maxOffset;\n        }\n\n    }\n  },\n  getOffsetForRowAndAlignment: function getOffsetForRowAndAlignment(_ref8, rowIndex, align, scrollTop, instanceProps, scrollbarSize) {\n    var rowHeight = _ref8.rowHeight,\n        height = _ref8.height,\n        rowCount = _ref8.rowCount;\n    var lastRowOffset = Math.max(0, rowCount * rowHeight - height);\n    var maxOffset = Math.min(lastRowOffset, rowIndex * rowHeight);\n    var minOffset = Math.max(0, rowIndex * rowHeight - height + scrollbarSize + rowHeight);\n\n    if (align === 'smart') {\n      if (scrollTop >= minOffset - height && scrollTop <= maxOffset + height) {\n        align = 'auto';\n      } else {\n        align = 'center';\n      }\n    }\n\n    switch (align) {\n      case 'start':\n        return maxOffset;\n\n      case 'end':\n        return minOffset;\n\n      case 'center':\n        // \"Centered\" offset is usually the average of the min and max.\n        // But near the edges of the list, this doesn't hold true.\n        var middleOffset = Math.round(minOffset + (maxOffset - minOffset) / 2);\n\n        if (middleOffset < Math.ceil(height / 2)) {\n          return 0; // near the beginning\n        } else if (middleOffset > lastRowOffset + Math.floor(height / 2)) {\n          return lastRowOffset; // near the end\n        } else {\n          return middleOffset;\n        }\n\n      case 'auto':\n      default:\n        if (scrollTop >= minOffset && scrollTop <= maxOffset) {\n          return scrollTop;\n        } else if (minOffset > maxOffset) {\n          // Because we only take into account the scrollbar size when calculating minOffset\n          // this value can be larger than maxOffset when at the end of the list\n          return minOffset;\n        } else if (scrollTop < minOffset) {\n          return minOffset;\n        } else {\n          return maxOffset;\n        }\n\n    }\n  },\n  getColumnStartIndexForOffset: function getColumnStartIndexForOffset(_ref9, scrollLeft) {\n    var columnWidth = _ref9.columnWidth,\n        columnCount = _ref9.columnCount;\n    return Math.max(0, Math.min(columnCount - 1, Math.floor(scrollLeft / columnWidth)));\n  },\n  getColumnStopIndexForStartIndex: function getColumnStopIndexForStartIndex(_ref10, startIndex, scrollLeft) {\n    var columnWidth = _ref10.columnWidth,\n        columnCount = _ref10.columnCount,\n        width = _ref10.width;\n    var left = startIndex * columnWidth;\n    var numVisibleColumns = Math.ceil((width + scrollLeft - left) / columnWidth);\n    return Math.max(0, Math.min(columnCount - 1, startIndex + numVisibleColumns - 1 // -1 is because stop index is inclusive\n    ));\n  },\n  getRowStartIndexForOffset: function getRowStartIndexForOffset(_ref11, scrollTop) {\n    var rowHeight = _ref11.rowHeight,\n        rowCount = _ref11.rowCount;\n    return Math.max(0, Math.min(rowCount - 1, Math.floor(scrollTop / rowHeight)));\n  },\n  getRowStopIndexForStartIndex: function getRowStopIndexForStartIndex(_ref12, startIndex, scrollTop) {\n    var rowHeight = _ref12.rowHeight,\n        rowCount = _ref12.rowCount,\n        height = _ref12.height;\n    var top = startIndex * rowHeight;\n    var numVisibleRows = Math.ceil((height + scrollTop - top) / rowHeight);\n    return Math.max(0, Math.min(rowCount - 1, startIndex + numVisibleRows - 1 // -1 is because stop index is inclusive\n    ));\n  },\n  initInstanceProps: function initInstanceProps(props) {// Noop\n  },\n  shouldResetStyleCacheOnItemSizeChange: true,\n  validateProps: function validateProps(_ref13) {\n    var columnWidth = _ref13.columnWidth,\n        rowHeight = _ref13.rowHeight;\n\n    if (process.env.NODE_ENV !== 'production') {\n      if (typeof columnWidth !== 'number') {\n        throw Error('An invalid \"columnWidth\" prop has been specified. ' + 'Value should be a number. ' + (\"\\\"\" + (columnWidth === null ? 'null' : typeof columnWidth) + \"\\\" was specified.\"));\n      }\n\n      if (typeof rowHeight !== 'number') {\n        throw Error('An invalid \"rowHeight\" prop has been specified. ' + 'Value should be a number. ' + (\"\\\"\" + (rowHeight === null ? 'null' : typeof rowHeight) + \"\\\" was specified.\"));\n      }\n    }\n  }\n});\n\nvar FixedSizeList =\n/*#__PURE__*/\ncreateListComponent({\n  getItemOffset: function getItemOffset(_ref, index) {\n    var itemSize = _ref.itemSize;\n    return index * itemSize;\n  },\n  getItemSize: function getItemSize(_ref2, index) {\n    var itemSize = _ref2.itemSize;\n    return itemSize;\n  },\n  getEstimatedTotalSize: function getEstimatedTotalSize(_ref3) {\n    var itemCount = _ref3.itemCount,\n        itemSize = _ref3.itemSize;\n    return itemSize * itemCount;\n  },\n  getOffsetForIndexAndAlignment: function getOffsetForIndexAndAlignment(_ref4, index, align, scrollOffset) {\n    var direction = _ref4.direction,\n        height = _ref4.height,\n        itemCount = _ref4.itemCount,\n        itemSize = _ref4.itemSize,\n        layout = _ref4.layout,\n        width = _ref4.width;\n    // TODO Deprecate direction \"horizontal\"\n    var isHorizontal = direction === 'horizontal' || layout === 'horizontal';\n    var size = isHorizontal ? width : height;\n    var lastItemOffset = Math.max(0, itemCount * itemSize - size);\n    var maxOffset = Math.min(lastItemOffset, index * itemSize);\n    var minOffset = Math.max(0, index * itemSize - size + itemSize);\n\n    if (align === 'smart') {\n      if (scrollOffset >= minOffset - size && scrollOffset <= maxOffset + size) {\n        align = 'auto';\n      } else {\n        align = 'center';\n      }\n    }\n\n    switch (align) {\n      case 'start':\n        return maxOffset;\n\n      case 'end':\n        return minOffset;\n\n      case 'center':\n        {\n          // \"Centered\" offset is usually the average of the min and max.\n          // But near the edges of the list, this doesn't hold true.\n          var middleOffset = Math.round(minOffset + (maxOffset - minOffset) / 2);\n\n          if (middleOffset < Math.ceil(size / 2)) {\n            return 0; // near the beginning\n          } else if (middleOffset > lastItemOffset + Math.floor(size / 2)) {\n            return lastItemOffset; // near the end\n          } else {\n            return middleOffset;\n          }\n        }\n\n      case 'auto':\n      default:\n        if (scrollOffset >= minOffset && scrollOffset <= maxOffset) {\n          return scrollOffset;\n        } else if (scrollOffset < minOffset) {\n          return minOffset;\n        } else {\n          return maxOffset;\n        }\n\n    }\n  },\n  getStartIndexForOffset: function getStartIndexForOffset(_ref5, offset) {\n    var itemCount = _ref5.itemCount,\n        itemSize = _ref5.itemSize;\n    return Math.max(0, Math.min(itemCount - 1, Math.floor(offset / itemSize)));\n  },\n  getStopIndexForStartIndex: function getStopIndexForStartIndex(_ref6, startIndex, scrollOffset) {\n    var direction = _ref6.direction,\n        height = _ref6.height,\n        itemCount = _ref6.itemCount,\n        itemSize = _ref6.itemSize,\n        layout = _ref6.layout,\n        width = _ref6.width;\n    // TODO Deprecate direction \"horizontal\"\n    var isHorizontal = direction === 'horizontal' || layout === 'horizontal';\n    var offset = startIndex * itemSize;\n    var size = isHorizontal ? width : height;\n    var numVisibleItems = Math.ceil((size + scrollOffset - offset) / itemSize);\n    return Math.max(0, Math.min(itemCount - 1, startIndex + numVisibleItems - 1 // -1 is because stop index is inclusive\n    ));\n  },\n  initInstanceProps: function initInstanceProps(props) {// Noop\n  },\n  shouldResetStyleCacheOnItemSizeChange: true,\n  validateProps: function validateProps(_ref7) {\n    var itemSize = _ref7.itemSize;\n\n    if (process.env.NODE_ENV !== 'production') {\n      if (typeof itemSize !== 'number') {\n        throw Error('An invalid \"itemSize\" prop has been specified. ' + 'Value should be a number. ' + (\"\\\"\" + (itemSize === null ? 'null' : typeof itemSize) + \"\\\" was specified.\"));\n      }\n    }\n  }\n});\n\n// Pulled from react-compat\n// https://github.com/developit/preact-compat/blob/7c5de00e7c85e2ffd011bf3af02899b63f699d3a/src/index.js#L349\nfunction shallowDiffers(prev, next) {\n  for (var attribute in prev) {\n    if (!(attribute in next)) {\n      return true;\n    }\n  }\n\n  for (var _attribute in next) {\n    if (prev[_attribute] !== next[_attribute]) {\n      return true;\n    }\n  }\n\n  return false;\n}\n\n// It knows to compare individual style props and ignore the wrapper object.\n// See https://reactjs.org/docs/react-api.html#reactmemo\n\nfunction areEqual(prevProps, nextProps) {\n  var prevStyle = prevProps.style,\n      prevRest = _objectWithoutPropertiesLoose(prevProps, [\"style\"]);\n\n  var nextStyle = nextProps.style,\n      nextRest = _objectWithoutPropertiesLoose(nextProps, [\"style\"]);\n\n  return !shallowDiffers(prevStyle, nextStyle) && !shallowDiffers(prevRest, nextRest);\n}\n\n// It knows to compare individual style props and ignore the wrapper object.\n// See https://reactjs.org/docs/react-component.html#shouldcomponentupdate\n\nfunction shouldComponentUpdate(nextProps, nextState) {\n  return !areEqual(this.props, nextProps) || shallowDiffers(this.state, nextState);\n}\n\nexport { VariableSizeGrid, VariableSizeList, FixedSizeGrid, FixedSizeList, areEqual, shouldComponentUpdate };\n//# sourceMappingURL=index.esm.js.map\n","import * as React from 'react'\nimport * as ReactDOM from 'react-dom'\nimport { FixedSizeList } from 'react-window'\n\n/* globals GM */\nexport default function Explorer (root, hooks) {\n  function runHooks (name, ...args) {\n    if (!(name in hooks)) {\n      return\n    }\n    if (!Array.isArray(hooks[name])) {\n      hooks[name] = [hooks[name]]\n    }\n    return Promise.all(hooks[name].map(f => f(...args)))\n  }\n\n  class AlbumListItem extends React.Component {\n    constructor (props) {\n      super(props)\n      this.state = {\n        TralbumData: props.data.library[Object.keys(props.data.library)[props.index]]\n      }\n    }\n\n    handleAlbumClick = (ev) => {\n      const targetStyle = ev.target.style\n      targetStyle.cursor = document.body.style.cursor = 'wait'\n      const url = this.state.TralbumData.url\n      window.setTimeout(function () {\n        runHooks('playAlbumFromUrl', url).then(function () {\n          targetStyle.cursor = document.body.style.cursor = ''\n        })\n      }, 1)\n    }\n\n    render () {\n      return (\n        <div className={`albumListItem ${this.props.index % 2 ? 'albumListItemOdd' : ''}`} onClick={this.handleAlbumClick} title='Click to play' style={this.props.style}>\n          {this.state.TralbumData.artist} - {this.state.TralbumData.current.title}\n        </div>\n      )\n    }\n  }\n\n  class AlbumList extends React.Component {\n    constructor (props) {\n      super(props)\n      this.state = {\n        library: {},\n        isLoading: false,\n        error: null\n      }\n      if (!this.props.getKey) {\n        throw Error('<AlbumList> needs a getKey property')\n      }\n    }\n\n    componentDidMount () {\n      this.setState({ isLoading: true })\n      GM.getValue(this.props.getKey, '{}')\n        .then(s => JSON.parse(s))\n        .then(data => this.setState({ library: data, isLoading: false }))\n        .catch(error => this.setState({ error, isLoading: false }))\n    }\n\n    render () {\n      const { library, isLoading, error } = this.state\n\n      if (error) {\n        return <p>{error.message}</p>\n      }\n\n      if (isLoading) {\n        return <p>Loading ...</p>\n      }\n      return (\n        <FixedSizeList\n          className='List'\n          height={600}\n          itemCount={Object.keys(library).length}\n          itemSize={35}\n          //width={600}\n          itemData={{ library: library }}\n        >\n          {AlbumListItem}\n        </FixedSizeList>\n      )\n    }\n  }\n\n  this.render = function () {\n    ReactDOM.render(\n      <AlbumList getKey='tralbumlibrary' />,\n      root\n    )\n  }\n}\n","import './violentmonkey.js'\nimport Explorer from './explorer.jsx'\n\nimport discographyplayerCSS from './css/discographyplayer.css'\nimport discographyplayerSidebarCSS from './css/discographyplayerSidebar.css'\nimport pastreleasesCSS from './css/pastreleases.css'\nimport darkmodeCSS from './css/darkmode.css'\nimport geniusCSS from './css/genius.css'\n\nimport exportMenuHTML from './exportMenu.html'\nimport speakerIconMuteSrc from './img/speaker_icon_mute_48x40.png'\nimport speakerIconLowSrc from './img/speaker_icon_low_48x40.png'\nimport speakerIconMiddleSrc from './img/speaker_icon_middle_48x40.png'\nimport speakerIconHighSrc from './img/speaker_icon_high_48x40.png'\n\n/* globals GM, unsafeWindow, MouseEvent, JSON5, MediaMetadata, Response, geniusLyrics */\n\n// TODO Mark as played automatically when played\n// TODO custom CSS\n\nconst BACKUP_REMINDER_DAYS = 35\nconst TRALBUM_CACHE_HOURS = 2\nlet NOTIFICATION_TIMEOUT = 3000\nconst CHROME = navigator.userAgent.indexOf('Chrome') !== -1\nconst CAMPEXPLORER = document.location.hostname === 'campexplorer.io'\nconst BANDCAMPDOMAIN = document.location.hostname === 'bandcamp.com' || document.location.hostname.endsWith('.bandcamp.com')\nlet BANDCAMP = BANDCAMPDOMAIN\nconst NOEMOJI = CHROME && navigator.userAgent.match(/Windows (NT)? [4-9]/i)\nconst DEFAULTSKIPTIME = 10 /* Seek time to skip in seconds by default */\nconst SCRIPT_NAME = 'Bandcamp script (Deluxe Edition)'\nconst LYRICS_EMPTY_PATH = '/robots.txt'\nconst PLAYER_URL = 'https://bandcamp.com/robots.txt?player'\nlet darkModeInjected = false\nlet storeTralbumDataPermanentlySwitch = true\nconst allFeatures = {\n  discographyplayer: {\n    name: 'Enable player on discography page',\n    default: true\n  },\n  albumPageVolumeBar: {\n    name: 'Enable volume slider/shuffle/repeat on album page',\n    default: true\n  },\n  albumPageAutoRepeatAll: {\n    name: 'Always \"repeat all\" on album page',\n    default: false\n  },\n  albumPageLyrics: {\n    name: 'Show lyrics from genius.com on album page',\n    default: true\n  },\n  markasplayed: {\n    name: 'Show \"mark as played\" link on discography player',\n    default: true\n  },\n  markasplayedEverywhere: {\n    name: 'Show \"mark as played\" link everywhere',\n    default: true\n  },\n  /* markasplayedAuto: {\n    name: '(NOT YET IMPLEMENTED) Automatically \"mark as played\" once a song was played for',\n    default: false\n  }, */\n  thetimehascome: {\n    name: 'Circumvent \"The time has come to open thy wallet\" limit',\n    default: true\n  },\n  albumPageDownloadLinks: {\n    name: 'Show download links on album page',\n    default: true\n  },\n  discographyplayerDownloadLink: {\n    name: 'Show download link on discography player',\n    default: true\n  },\n  discographyplayerSidebar: {\n    name: 'Show discography player as a sidebar on the right',\n    default: false\n  },\n  discographyplayerPersist: {\n    name: 'Recover discography player on next page',\n    default: true\n  },\n  backupReminder: {\n    name: 'Remind me to backup my played albums every month',\n    default: true\n  },\n  nextSongNotifications: {\n    name: 'Show a notification when a new song starts',\n    default: false\n  },\n  releaseReminder: {\n    name: 'Show new releases that I have saved',\n    default: true\n  },\n  keepLibrary: {\n    name: 'Store all visited or played albums',\n    default: true\n  },\n  darkMode: {\n    name: (CHROME ? '🅳🅐🆁🅺🅼🅞🅳🅴' : '🅳🅰🆁🅺🅼🅾🅳🅴') + ' - enable <a href=\"https://userstyles.org/styles/171538/bandcamp-in-dark\">dark theme by Simonus</a>',\n    default: false\n  }\n}\n\nconst moreSettings = {\n  darkMode: {\n    true: async function populateDarkModeSettings (container) {\n      let darkModeValue = await GM.getValue('darkmode', '1')\n      const onChange = async function () {\n        const input = this\n        window.setTimeout(() => parentQuery(input, 'fieldset').classList.add('breathe'), 0)\n        document.getElementById('bcsde_mode_auto_status').innerHTML = ''\n        document.getElementById('bcsde_mode_const_time_from').classList.remove('errorblink')\n        document.getElementById('bcsde_mode_const_time_to').classList.remove('errorblink')\n        if (document.getElementById('bcsde_mode_always').checked) {\n          darkModeValue = '1'\n        } else if (document.getElementById('bcsde_mode_const_time').checked) {\n          let from = document.getElementById('bcsde_mode_const_time_from').value\n          let to = document.getElementById('bcsde_mode_const_time_to').value\n          const mFrom = from.match(/([0-2]?\\d:[0-5]\\d)/)\n          const mTo = to.match(/([0-2]?\\d:[0-5]\\d)/)\n          if (mFrom && mTo) {\n            from = mFrom[1]\n            to = mTo[1]\n            document.getElementById('bcsde_mode_const_time_from').value = from\n            document.getElementById('bcsde_mode_const_time_to').value = to\n            darkModeValue = `2#${from}->${to}`\n          } else {\n            if (!mFrom) {\n              document.getElementById('bcsde_mode_const_time_from').classList.add('errorblink')\n            }\n            if (!mTo) {\n              document.getElementById('bcsde_mode_const_time_to').classList.add('errorblink')\n            }\n          }\n        } else if (document.getElementById('bcsde_mode_auto').checked) {\n          let myPosition = null\n          let sunData = null\n          try {\n            myPosition = await getGPSLocation()\n            sunData = suntimes(new Date(), myPosition.latitude, myPosition.longitude)\n          } catch (e) {\n            document.getElementById('bcsde_mode_auto_status').innerHTML = 'Error:\\n' + e\n          }\n          if (myPosition && sunData) {\n            const data = Object.assign(myPosition, sunData)\n            darkModeValue = '3#' + JSON.stringify(data)\n            document.getElementById('bcsde_mode_auto_status').innerHTML = `Source:   ${data.source}\nLocation: ${data.latitude}, ${data.longitude}\nSunrise:  ${data.sunrise.toLocaleTimeString()}\nSunset:   ${data.sunset.toLocaleTimeString()}`\n          }\n        }\n        await GM.setValue('darkmode', darkModeValue)\n        window.setTimeout(() => parentQuery(input, 'fieldset').classList.remove('breathe'), 50)\n      }\n\n      const radioAlways = container.appendChild(document.createElement('input'))\n      radioAlways.setAttribute('type', 'radio')\n      radioAlways.setAttribute('name', 'mode')\n      radioAlways.setAttribute('value', 'always')\n      radioAlways.setAttribute('id', 'bcsde_mode_always')\n      radioAlways.checked = darkModeValue.startsWith('1')\n      radioAlways.addEventListener('change', onChange)\n      const labelAlways = container.appendChild(document.createElement('label'))\n      labelAlways.setAttribute('for', 'bcsde_mode_always')\n      labelAlways.appendChild(document.createTextNode('Always'))\n\n      container.appendChild(document.createElement('br'))\n\n      const radioConstTime = container.appendChild(document.createElement('input'))\n      radioConstTime.setAttribute('type', 'radio')\n      radioConstTime.setAttribute('name', 'mode')\n      radioConstTime.setAttribute('value', 'const_time')\n      radioConstTime.setAttribute('id', 'bcsde_mode_const_time')\n      radioConstTime.checked = darkModeValue.startsWith('2')\n      radioConstTime.addEventListener('change', onChange)\n\n      let [from, to] = ['22:00', '06:00']\n      if (darkModeValue.startsWith('2')) {\n        [from, to] = darkModeValue.substring(2).split('->')\n      }\n      const labelConstTime = container.appendChild(document.createElement('label'))\n      labelConstTime.setAttribute('for', 'bcsde_mode_const_time')\n      labelConstTime.appendChild(document.createTextNode('Time'))\n      const labelConstTimeFrom = container.appendChild(document.createElement('label'))\n      labelConstTimeFrom.setAttribute('for', 'bcsde_mode_const_time_from')\n      labelConstTimeFrom.appendChild(document.createTextNode(' from '))\n      const inputConstTimeFrom = container.appendChild(document.createElement('input'))\n      inputConstTimeFrom.setAttribute('type', 'text')\n      inputConstTimeFrom.setAttribute('value', from)\n      inputConstTimeFrom.setAttribute('id', 'bcsde_mode_const_time_from')\n      inputConstTimeFrom.addEventListener('change', onChange)\n      const labelConstTimeTo = container.appendChild(document.createElement('label'))\n      labelConstTimeTo.setAttribute('for', 'bcsde_mode_const_time_to')\n      labelConstTimeTo.appendChild(document.createTextNode(' to '))\n      const inputConstTimeTo = container.appendChild(document.createElement('input'))\n      inputConstTimeTo.setAttribute('type', 'text')\n      inputConstTimeTo.setAttribute('value', to)\n      inputConstTimeTo.setAttribute('id', 'bcsde_mode_const_time_to')\n      inputConstTimeTo.addEventListener('change', onChange)\n\n      container.appendChild(document.createElement('br'))\n\n      const radioAuto = container.appendChild(document.createElement('input'))\n      radioAuto.setAttribute('type', 'radio')\n      radioAuto.setAttribute('name', 'mode')\n      radioAuto.setAttribute('value', 'auto')\n      radioAuto.setAttribute('id', 'bcsde_mode_auto')\n      radioAuto.checked = darkModeValue.startsWith('3')\n      radioAuto.addEventListener('change', onChange)\n      const labelAuto = container.appendChild(document.createElement('label'))\n      labelAuto.setAttribute('for', 'bcsde_mode_auto')\n      labelAuto.appendChild(document.createTextNode('Auto (sunset till sunrise)'))\n      const preAutoStatus = container.appendChild(document.createElement('pre'))\n      preAutoStatus.setAttribute('id', 'bcsde_mode_auto_status')\n      preAutoStatus.setAttribute('style', 'font-family:monospace')\n\n      return 'Dark theme details'\n    }\n  },\n  discographyplayerSidebar: {\n    true: function checkScreenSize (container) {\n      if (!window.matchMedia('(min-width: 1600px)').matches) {\n        const span = container.appendChild(document.createElement('span'))\n        span.appendChild(document.createTextNode('Your screen/browser window is not wide enough for this option. Width of at least 1600px required'))\n        container.style.opacity = 1\n      } else {\n        container.style.opacity = 0\n      }\n      return fullfill()\n    },\n    false: function removeContainerAboutScreenSize (container) {\n      container.style.opacity = 0\n      return fullfill()\n    }\n  },\n  nextSongNotifications: {\n    true: async function populateNotificationSettings (container) {\n      const onChange = async function () {\n        const input = this\n        document.getElementById('bcsde_notification_timeout').classList.remove('errorblink')\n\n        let seconds = -1\n        try {\n          seconds = parseFloat(document.getElementById('bcsde_notification_timeout').value.trim())\n        } catch (e) {\n          seconds = -1\n        }\n\n        if (seconds < 0) {\n          document.getElementById('bcsde_notification_timeout').classList.add('errorblink')\n        } else {\n          NOTIFICATION_TIMEOUT = parseInt(1000.0 * seconds)\n          await GM.setValue('notification_timeout', NOTIFICATION_TIMEOUT)\n          input.style.boxShadow = '2px 2px 5px #0a0f'\n          window.setTimeout(function resetBoxShadowTimeout () {\n            input.style.boxShadow = ''\n          }, 3000)\n        }\n      }\n\n      const labelTimeout = container.appendChild(document.createElement('label'))\n      labelTimeout.setAttribute('for', 'bcsde_notification_timeout')\n      labelTimeout.appendChild(document.createTextNode('Show for '))\n      const inputTimeout = container.appendChild(document.createElement('input'))\n      inputTimeout.setAttribute('type', 'text')\n      inputTimeout.setAttribute('size', '3')\n      inputTimeout.setAttribute('value', (await GM.getValue('notification_timeout', NOTIFICATION_TIMEOUT)) / 1000.0)\n      inputTimeout.setAttribute('id', 'bcsde_notification_timeout')\n      inputTimeout.addEventListener('change', onChange)\n      const labelPostTimeout = container.appendChild(document.createElement('label'))\n      labelPostTimeout.setAttribute('for', 'bcsde_notification_timeout')\n      labelPostTimeout.appendChild(document.createTextNode(' seconds (0 = show until manually closed or default value of browser)'))\n    }\n  }\n\n}\n\nlet player, audio, currentDuration, timeline, playhead, bufferbar\nlet onPlayHead = false\n\nconst spriteRepeatShuffle = \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACUAAABgCAMAAACt1UvuAAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAA2UExURQAAAP////39/Tw8PP///////w4ODv////7+/v7+/k5OTktLS35+fiAgIJSUlAAAABAQECoqKpxAnVsAAAAPdFJOUwAxQ05UJGkKBRchgWiOOufd5UcAAAKrSURBVEjH7ZfrkqQgDIUbFLmphPd/2T2EgNqNzlTt7o+p3dR0d5V+JOGEYzkvZ63nsNY6517XCPIrjIDvXF7qL24ao5QynesIllDKE1MpJdom1UDBQIQlE+HmEipVIk+6cqVqQYivlq/loBJFDa6WnaitbbnMtFHnOF1niDJJX14pPa+cOm0l3Vohyuus8xpkj9ih1nPke6iaO6KV323XqwhRON4tQ3GedakNYYQqslaO+yv9xs64Lh2rX8sWeSISzVWTk8ROJmmU9MTl1PvEnHBmzXRSzvhhuqJAzjlJY9eJCVWljKwcESbL+fbTYK0NWx0IGodyvKCACqp6VqMNlguhktbxMqHdI5k7ps1SsiTxPO0YDgojkZPIysl+617cy8rUkIfPflMY4IaKLZfHhSoPn782iQJC5tIX2nfNQseGG4eoe3T1+kXh7j1j/H6W9TbC65ZxR2S0frKePUWYlhbY/hTkvL6aiKPApCRTeoxNTvUTI16r1DqPAqrGVR0UT/ojwGByJ6qO8S32HQ6wJ8r4TwFdyGnx7kzVM8l/nZpwRwkm1GAKC+5oKflMzY3aUm4rBpSsd17pVv2Bsn739ivqFWK2bhD2TE0wwTKM3Knu2puo1PJ8blqu7TEXVY1wgvGQwYN6HKJR0WGjYqxheN/lCpOzd/GlHX+gHyEe/SE/qpyV+sKPfqdEhzVv/OjwwC3zlefnnR+9YW+5Zz86fzjw3o+f1NCP9oMa+fGeOvnR2brH/378B/xI9A0/UjUjSfyOH2GzCDOuKavyUUM/eryMFjNOIMrHD/1o4di0GlCkp8IP/RjwglRSCKX9yI845VGXqwc18KOtWq3mSr35EQVnHbnzC3X144I3d7Wj6xuq+hH7gwz4PvY48GP9p8i2Vzus/dt+pB/nx18MUmsLM2EHrwAAAABJRU5ErkJggg==')\"\n\nfunction humanDuration (duration) {\n  let hours = parseInt(duration / 3600)\n  if (!hours) {\n    hours = ''\n  } else {\n    hours += ':'\n  }\n  duration %= 3600\n  let minutes = parseInt(duration / 60)\n  minutes = (minutes < 10 ? '0' : '') + minutes\n  duration %= 60\n  let seconds = parseInt(duration)\n  if (duration - seconds >= 0.5) {\n    seconds++\n  }\n  seconds = (seconds < 10 ? '0' : '') + seconds\n  return `${hours}${minutes}:${seconds}`\n}\n\nfunction addLogVolume (mediaElement) {\n  if (!Object.hasOwnProperty.call(mediaElement, 'logVolume')) {\n    Object.defineProperty(mediaElement, 'logVolume', {\n      get () {\n        return Math.log((Math.E - 1) * this.volume + 1)\n      },\n      set (percentage) {\n        this.volume = (Math.exp(percentage) - 1) / (Math.E - 1)\n      }\n    })\n  }\n}\n\nfunction randomIndex (max) {\n  // Random int from interval [0,max)\n  return Math.floor(Math.random() * Math.floor(max))\n}\n\nfunction padd (n, width, filler) {\n  let s\n  for (s = n.toString(); s.length < width; s = filler + s);\n  return s\n}\n\nfunction metricPrefix (n, decimals, k) {\n  // From http://stackoverflow.com/a/18650828\n  if (n <= 0) {\n    return String(n)\n  }\n  k = k || 1000\n  const dm = decimals <= 0 ? 0 : decimals || 2\n  const sizes = ['', 'K', 'M', 'G', 'T', 'P', 'E', 'Z', 'Y']\n  const i = Math.floor(Math.log(n) / Math.log(k))\n  return parseFloat((n / Math.pow(k, i)).toFixed(dm)) + sizes[i]\n}\n\nfunction fixFilename (s) {\n  const forbidden = '*\"/\\\\[]:|,<>?\\n\\t\\0'.split('')\n  forbidden.forEach(function (char) {\n    s = s.replace(char, '')\n  })\n  return s\n}\n\nfunction fullfill (x) {\n  return new Promise(resolve => resolve(x))\n}\n\nconst stylesToInsert = []\nfunction addStyle (css) {\n  if (GM.addStyle && css) {\n    return GM.addStyle(css)\n  } else {\n    if (css) {\n      stylesToInsert.push(css)\n    }\n    const head = (document.head ? document.head : document.documentElement)\n    if (head) {\n      let style = document.createElement('style')\n      if (style) {\n        while (stylesToInsert.length) {\n          head.append(style)\n          style.type = 'text/css'\n          style.appendChild(document.createTextNode(stylesToInsert.shift()))\n          style = document.createElement('style')\n        }\n        return fullfill(style)\n      }\n    }\n    // document was not ready, wait\n    return new Promise((resolve) => window.setTimeout(() => addStyle(false).then(resolve), 100))\n  }\n}\n\nfunction css2rgb (colorStr) {\n  const div = document.body.appendChild(document.createElement('div'))\n  div.style.color = colorStr\n  const m = window.getComputedStyle(div).color.match(/rgb\\s*\\(\\s*(\\d+)\\s*,\\s*(\\d+)\\s*,\\s*(\\d+)\\s*\\)/i)\n  div.remove()\n  if (m) {\n    m.shift()\n    return m\n  }\n  return null\n}\n\nfunction base64encode (s) {\n  // from https://gist.github.com/stubbetje/229984\n  const base64 = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/='.split('')\n  const l = s.length\n  let o = ''\n  for (let i = 0; i < l; i++) {\n    const byte0 = s.charCodeAt(i++) & 0xff\n    const byte1 = s.charCodeAt(i++) & 0xff\n    const byte2 = s.charCodeAt(i) & 0xff\n    o += base64[byte0 >> 2]\n    o += base64[((byte0 & 0x3) << 4) | (byte1 >> 4)]\n    const t = i - l\n    if (t >= 0) {\n      if (t === 0) {\n        o += base64[((byte1 & 0x0f) << 2) | (byte2 >> 6)]\n        o += base64[64]\n      } else {\n        o += base64[64]\n        o += base64[64]\n      }\n    } else {\n      o += base64[((byte1 & 0x0f) << 2) | (byte2 >> 6)]\n      o += base64[byte2 & 0x3f]\n    }\n  }\n  return o\n}\n\nfunction decodeHTMLentities (input) {\n  return new window.DOMParser().parseFromString(input, 'text/html').documentElement.textContent\n}\n\nfunction timeSince (date) {\n  // From https://stackoverflow.com/a/3177838/10367381\n  const seconds = Math.floor((new Date() - date) / 1000)\n  let interval = Math.floor(seconds / 31536000)\n  if (interval > 1) {\n    return interval + ' years'\n  }\n  interval = Math.floor(seconds / 2592000)\n  if (interval > 1) {\n    return interval + ' months'\n  }\n  interval = Math.floor(seconds / 86400)\n  if (interval > 1) {\n    return interval + ' days'\n  }\n  interval = Math.floor(seconds / 3600)\n  if (interval > 1) {\n    return interval + ' hours'\n  }\n  interval = Math.floor(seconds / 60)\n  if (interval > 1) {\n    return interval + ' minutes'\n  }\n  return Math.floor(seconds) + ' seconds'\n}\n\nfunction nowInTimeRange (range) {\n  // Format: range = 'hh:mm->hh:mm'\n  const m = range.match(/(\\d{1,2}):(\\d{1,2})->(\\d{1,2}):(\\d{1,2})/)\n  const [fromHours, fromMinutes, toHours, toMinutes] = [parseInt(m[1]), parseInt(m[2]), parseInt(m[3]), parseInt(m[4])]\n  const now = new Date()\n  const from = new Date()\n  from.setHours(fromHours)\n  from.setMinutes(fromMinutes)\n  const to = new Date()\n  to.setHours(toHours)\n  to.setMinutes(toMinutes)\n  if (to - from < 0) {\n    to.setDate(to.getDate() + 1)\n  }\n  return now > from && now < to\n}\n\nfunction nowInBetween (from, to) {\n  const time = new Date()\n  const start = from.getHours() * 60 + from.getMinutes()\n  const end = to.getHours() * 60 + to.getMinutes()\n  const now = time.getHours() * 60 + time.getMinutes()\n  if (start >= end) {\n    return (start <= now && now >= end) || (start >= now && now <= end)\n  } else {\n    return start <= now && now <= end\n  }\n}\n\nfunction loadCrossSiteImage (url) {\n  return new Promise(function downloadCrossSiteImage (resolve, reject) {\n    const canvas = document.createElement('canvas')\n    const ctx = canvas.getContext('2d')\n\n    const img0 = document.createElement('img') // Load the image in a <img> to get the dimensions\n    img0.addEventListener('load', function onImgLoad () {\n      if (img0.height === 0 || img0.width === 0) {\n        reject(new Error('loadCrossSiteImage(\"$url\") Error: Could not load image in <img>'))\n        return\n      }\n      canvas.height = img0.height\n      canvas.width = img0.width\n      // Download image data\n      GM.xmlHttpRequest({\n        method: 'GET',\n        overrideMimeType: 'text/plain; charset=x-user-defined',\n        url: url,\n        onload: function (resp) {\n          // Create a data url image\n          const dataurl = 'data:image/jpeg;base64,' + base64encode(resp.responseText)\n          const img1 = document.createElement('img')\n          img1.addEventListener('load', function () {\n            // Load data url image into canvas\n            ctx.drawImage(img1, 0, 0)\n            resolve(canvas)\n          })\n          img1.src = dataurl\n        },\n        onerror: function (response) {\n          console.log('loadCrossSiteImage(\"' + url + '\") Error: ' + response.status + '\\n' + ('error' in response ? response.error : ''))\n          reject(new Error('error' in response ? response.error : 'loadCrossSiteImage failed'))\n        }\n      })\n    })\n    img0.src = url\n  })\n}\n\nfunction removeViaQuerySelector (parent, selector) {\n  if (typeof selector === 'undefined') {\n    selector = parent\n    parent = document\n  }\n  for (let el = parent.querySelector(selector); el; el = parent.querySelector(selector)) {\n    el.remove()\n  }\n}\n\nfunction firstChildWithText (parent) {\n  for (let i = 0; i < parent.childNodes.length; i++) {\n    const node = parent.childNodes[i]\n    if (node.nodeType === window.Node.TEXT_NODE && node.nodeValue.trim()) {\n      return node\n    } else if (node.childNodes.length) {\n      const r = firstChildWithText(node)\n      if (r) {\n        return r\n      }\n    }\n  }\n  return false\n}\n\nfunction parentQuery (node, q) {\n  const parents = [node.parentElement]\n  node = node.parentElement.parentElement\n  while (node) {\n    const lst = node.querySelectorAll(q)\n    for (let i = 0; i < lst.length; i++) {\n      if (parents.indexOf(lst[i]) !== -1) {\n        return lst[i]\n      }\n    }\n    parents.push(node)\n    node = node.parentElement\n  }\n  return null\n}\n\nfunction suntimes (date, lat, lng) {\n  // According to \"Predicting Sunrise and Sunset Times\" by Donald A. Teets:\n  // https://www.maa.org/sites/default/files/teets09010341463.pdf\n  lat = lat * Math.PI / 180.0\n  const dayOfYear = Math.round((date - new Date(date).setMonth(0, 0)) / 86400000)\n  const sunDist = 149598000.0\n  const radius = 6378.0\n  const epsilon = 0.409\n  const thetha = 2 * Math.PI / 365.25 * (dayOfYear - 80)\n  const n = 720 - 10 * Math.sin(2 * thetha) + 8 * Math.sin(2 * Math.PI / 365.25 * dayOfYear)\n  const z = sunDist * Math.sin(thetha) * Math.sin(epsilon)\n  const rp = Math.sqrt(sunDist * sunDist - z * z)\n  const t0 = 1440 / (2 * Math.PI) * Math.acos((radius - z * Math.sin(lat)) / (rp * Math.cos(lat)))\n  const sunriseMin = n - t0 - 5 - (4.0 * lng % 15.0) - date.getTimezoneOffset()\n  const sunsetMin = sunriseMin + 2 * t0\n  const sunrise = new Date(date)\n  sunrise.setHours(sunriseMin / 60, Math.round(sunriseMin % 60))\n  const sunset = new Date(date)\n  sunset.setHours(sunsetMin / 60, Math.round(sunsetMin % 60))\n  return { sunrise: sunrise, sunset: sunset }\n}\n\nfunction fromISO6709 (s) {\n  // Format: s = '+-DDMM+-DDDMM'\n  // Format: s = '+-DDMMSS+-DDDMMSS'\n  function convert (iso, negative) {\n    const mm = iso % 100\n    const dd = iso / 100\n    return (dd + mm / 60) * (negative ? -1 : 1)\n  }\n\n  const m = s.match(/([+-])(\\d+)([+-])(\\d+)/)\n  const lat = convert(parseInt(m[2]), m[1] === '-')\n  const lng = convert(parseInt(m[4]), m[3] === '-')\n\n  return { latitude: lat, longitude: lng }\n}\n\nfunction getGPSLocation () {\n  return new Promise(function downloadCrossSiteImage (resolve, reject) {\n    navigator.geolocation.getCurrentPosition(function onSuccess (position) {\n      resolve({\n        source: `navigator.geolocation@${new Date(position.timestamp).toLocaleString()}`,\n        latitude: position.coords.latitude,\n        longitude: position.coords.longitude\n      })\n    }, function onError (err) {\n      console.log('getGPSLocation Error:')\n      console.log(err)\n      const tz = Intl.DateTimeFormat().resolvedOptions().timeZone\n      console.log('getGPSLocation: Timezone: ' + tz)\n      GM.xmlHttpRequest({\n        method: 'GET',\n        url: 'https://raw.githubusercontent.com/iospirit/NSTimeZone-ISCLLocation/master/zone.tab',\n        onload: function (response) {\n          if (response.responseText.indexOf(tz) !== -1) {\n            const line = response.responseText.split(tz)[0].split('\\n').pop()\n            const myPosition = fromISO6709(line)\n            myPosition.source = 'Browser timezone ' + tz\n            resolve(myPosition)\n          } else if (response.status !== 200) {\n            reject(new Error('Could not download time zone locations: http status=' + response.status))\n          } else {\n            reject(new Error('Unkown time zone location: ' + tz))\n          }\n        },\n        onerror: function (response) {\n          reject(new Error('Could not download time zone locations: ' + response.error))\n        }\n      })\n    })\n  })\n}\n\nconst _dateOptions = { year: 'numeric', month: 'short', day: 'numeric' }\nconst _dateOptionsWithoutYear = { month: 'short', day: 'numeric' }\nconst _dateOptionsNumericWithoutYear = { year: '2-digit', month: '2-digit', day: '2-digit' }\nfunction dateFormater (date) {\n  if (date.getFullYear() === (new Date()).getFullYear()) {\n    return date.toLocaleDateString(undefined, _dateOptionsWithoutYear)\n  } else {\n    return date.toLocaleDateString(undefined, _dateOptions)\n  }\n}\nfunction dateFormaterRelease (date) {\n  return date.toLocaleDateString(undefined, _dateOptionsWithoutYear) + ', ' + date.getFullYear()\n}\nfunction dateFormaterNumeric (date) {\n  return date.toLocaleDateString(undefined, _dateOptionsNumericWithoutYear)\n}\nlet enabledFeaturesLoaded = false\nfunction getEnabledFeatures (enabledFeaturesValue) {\n  for (const feature in allFeatures) {\n    allFeatures[feature].enabled = allFeatures[feature].default\n  }\n  if (enabledFeaturesValue !== false) {\n    const enabledFeatures = JSON.parse(enabledFeaturesValue)\n    if (enabledFeatures.constructor === Object) {\n      for (const feature in enabledFeatures) {\n        if (feature in allFeatures) {\n          allFeatures[feature].enabled = enabledFeatures[feature].enabled\n        }\n      }\n    }\n  }\n  enabledFeaturesLoaded = true\n  return allFeatures\n}\n\nfunction findUserProfileUrl () {\n  if (document.querySelector('#collection-main a')) {\n    return document.querySelector('#collection-main a').href\n  }\n  return 'https://bandcamp.com/login'\n}\n\nlet ivRestoreVolume\nfunction getStoredVolume (callbackIfVolumeExists) {\n  GM.getValue('volume', '0.7').then(str => {\n    return parseFloat(str)\n  }).then(function storedVolumeLoaded (volume) {\n    if (!Number.isNaN(volume) && volume > 0.0) {\n      callbackIfVolumeExists(volume)\n    }\n  })\n}\nfunction restoreVolume () {\n  getStoredVolume(function getStoredVolumeCallback (volume) {\n    const restoreVolumeInterval = function restoreInterval () {\n      const audios = document.querySelectorAll('audio,video')\n      if (audios.length > 0) {\n        let paused = true\n        audios.forEach(function (media) {\n          addLogVolume(media)\n          paused = paused && media.paused\n          media.logVolume = volume\n        })\n        if (!paused) {\n          // Clear interval once audio is actually playing\n          window.clearInterval(ivRestoreVolume)\n        }\n        // Update volume bar on tag player (by double clicking mute button)\n        const muteWrapper = document.querySelector('.vol-icon-wrapper')\n        if (muteWrapper) {\n          const mouseDownEvent = new MouseEvent('mousedown', { view: unsafeWindow, bubbles: true, cancelable: true })\n          muteWrapper.dispatchEvent(mouseDownEvent)\n          muteWrapper.dispatchEvent(mouseDownEvent)\n        }\n      }\n    }\n    restoreVolumeInterval()\n    ivRestoreVolume = window.setInterval(restoreVolumeInterval, 500)\n  })\n  window.setTimeout(function clearRestoreInterval () {\n    window.clearInterval(ivRestoreVolume)\n  }, 7000)\n}\n\nfunction findPreviousAlbumCover (currentUrl) {\n  const currentKey = albumKey(currentUrl)\n  const as = document.querySelectorAll('.music-grid .music-grid-item a[href*=\"/album/\"],.music-grid .music-grid-item a[href*=\"/track/\"]')\n  let last = false\n  let found = false\n  for (let i = 0; i < as.length; i++) {\n    if (last && albumKey(as[i].href) === currentKey) {\n      found = last\n      break\n    }\n    last = as[i]\n  }\n  if (found) {\n    return playAlbumFromCover.apply(found, null)\n  }\n  return false\n}\nfunction findNextAlbumCover (currentUrl) {\n  const currentKey = albumKey(currentUrl)\n  const as = document.querySelectorAll('.music-grid .music-grid-item a[href*=\"/album/\"],.music-grid .music-grid-item a[href*=\"/track/\"]')\n  let isNext = false\n  for (let i = 0; i < as.length; i++) {\n    if (isNext) {\n      playAlbumFromCover.apply(as[i], null)\n      return true\n    }\n    if (albumKey(as[i].href) === currentKey) {\n      isNext = true\n    }\n  }\n  return false\n}\nconst shufflePlayed = []\nfunction musicPlayerNextSong (next) {\n  const current = player.querySelector('.playlist .playing')\n  if (!next) {\n    if (player.querySelector('.shufflebutton').classList.contains('active')) {\n      // Shuffle mode\n      const allLoadedSongs = document.querySelectorAll('.playlist .playlistentry')\n      // Set a random song (that is not the current song and not in shufflePlayed)\n      let index = null\n      for (let i = 0; i < 10; i++) {\n        index = randomIndex(allLoadedSongs.length)\n        const file = allLoadedSongs[index].dataset.file\n        if (file !== current.dataset.file && shufflePlayed.indexOf(file) !== -1) {\n          break\n        }\n      }\n      next = allLoadedSongs[index]\n      shufflePlayed.push(next.dataset.file)\n    } else {\n      // Normal mode\n      next = current.nextElementSibling\n      while (next) {\n        if ('file' in next.dataset) {\n          break\n        }\n        next = next.nextElementSibling\n      }\n    }\n  }\n  if (next) {\n    current.classList.remove('playing')\n    next.classList.add('playing')\n    musicPlayerPlaySong(next)\n  } else {\n    // End of playlist reached\n    if (findNextAlbumCover(current.dataset.albumUrl) === false) {\n      const notloaded = player.querySelector('.playlist .playlistheading a.notloaded')\n      if (notloaded) {\n        // Unloaded albums in playlist\n        const url = notloaded.href\n        notloaded.remove()\n        cachedTralbumData(url).then(function onCachedTralbumDataLoaded (TralbumData) {\n          if (TralbumData) {\n            addAlbumToPlaylist(TralbumData)\n          } else {\n            playAlbumFromUrl(url)\n          }\n        })\n      } else {\n        audio.pause()\n        audio.currentTime -= 1\n        musicPlayerOnTimeUpdate()\n        window.alert('End of playlist reached')\n      }\n    }\n  }\n}\n\nlet ivSlideInNextSong\nfunction musicPlayerPlaySong (next, startTime) {\n  currentDuration = next.dataset.duration\n  player.querySelector('.durationDisplay .current').innerHTML = '-'\n  player.querySelector('.durationDisplay .total').innerHTML = humanDuration(currentDuration)\n  audio.src = next.dataset.file\n  if (typeof startTime !== 'undefined' && startTime !== false) {\n    audio.currentTime = startTime\n  }\n  bufferbar.classList.remove('bufferbaranimation')\n  window.setTimeout(function bufferbaranimationWidth () {\n    bufferbar.style.width = '0px'\n    window.setTimeout(function bufferbaranimationClass () {\n      bufferbar.classList.add('bufferbaranimation')\n    }, 10)\n  }, 0)\n\n  const key = albumKey(next.dataset.albumUrl)\n\n  // Meta\n  const currentlyPlaying = document.querySelector('.currentlyPlaying')\n  const nextInRow = player.querySelector('.nextInRow')\n  nextInRow.querySelector('.cover').href = next.dataset.albumUrl\n  nextInRow.querySelector('.cover img').src = next.dataset.albumCover\n  nextInRow.querySelector('.info .link').href = next.dataset.albumUrl\n  nextInRow.querySelector('.info .title').innerHTML = next.dataset.title\n  nextInRow.querySelector('.info .artist').innerHTML = next.dataset.artist\n  nextInRow.querySelector('.info .album').innerHTML = next.dataset.album\n\n  // Favicon\n  musicPlayerFavicon(next.dataset.albumCover.replace(/_\\d.jpg$/, '_3.jpg'))\n\n  // Wishlist\n  const collectWishlist = player.querySelector('.collect-wishlist')\n  collectWishlist.dataset.albumUrl = next.dataset.albumUrl\n  player.querySelectorAll('.collect-wishlist>*').forEach(function (e) { e.style.display = 'none' })\n  if (next.dataset.isPurchased === 'true') {\n    player.querySelector('.collect-wishlist .wishlist-own').style.display = 'inline-block'\n    collectWishlist.dataset.wishlist = 'own'\n  } else if (next.dataset.inWishlist === 'true') {\n    player.querySelector('.collect-wishlist .wishlist-collected').style.display = 'inline-block'\n    collectWishlist.dataset.wishlist = 'collected'\n  } else {\n    player.querySelector('.collect-wishlist .wishlist-add').style.display = 'inline-block'\n    collectWishlist.dataset.wishlist = 'add'\n  }\n\n  // Played/Listened\n  const collectListened = player.querySelector('.collect-listened')\n  if (allFeatures.markasplayed.enabled && collectListened) {\n    collectListened.dataset.albumUrl = next.dataset.albumUrl\n    player.querySelectorAll('.collect-listened>*').forEach(function (e) { e.style.display = 'none' })\n    GM.getValue('myalbums', '{}').then(function myalbumsLoaded (str) {\n      const myalbums = JSON.parse(str)\n      if (key in myalbums && 'listened' in myalbums[key] && myalbums[key].listened) {\n        player.querySelector('.collect-listened .listened').style.display = 'inline-block'\n        const date = new Date(myalbums[key].listened)\n        const since = timeSince(date)\n        player.querySelector('.collect-listened .listened').title = since + ' ago\\nClick to mark as NOT played'\n        collectListened.dataset.listened = myalbums[key].listened\n      } else {\n        player.querySelector('.collect-listened .mark-listened').style.display = 'inline-block'\n        collectListened.dataset.listened = false\n      }\n    })\n  } else if (collectListened) {\n    collectListened.remove()\n  }\n\n  // Notification\n  if (allFeatures.nextSongNotifications.enabled && 'notification' in GM) {\n    GM.notification({\n      title: document.location.host,\n      text: next.dataset.title + '\\nby ' + next.dataset.artist + '\\nfrom ' + next.dataset.album,\n      image: next.dataset.albumCover,\n      highlight: false,\n      silent: true,\n      timeout: NOTIFICATION_TIMEOUT,\n      onclick: musicPlayerNext\n    })\n  }\n\n  // Media hub\n  if ('mediaSession' in navigator) {\n    navigator.mediaSession.metadata = new MediaMetadata({\n      title: next.dataset.title,\n      artist: next.dataset.artist,\n      album: next.dataset.album,\n      artwork: [{\n        src: next.dataset.albumCover,\n        sizes: '350x350',\n        type: 'image/jpeg'\n      }]\n    })\n    navigator.mediaSession.setActionHandler('previoustrack', musicPlayerPrev)\n    navigator.mediaSession.setActionHandler('nexttrack', musicPlayerNext)\n\n    navigator.mediaSession.setActionHandler('play', _ => audio.play())\n    navigator.mediaSession.setActionHandler('pause', _ => audio.pause())\n\n    navigator.mediaSession.setActionHandler('seekbackward', function (event) {\n      const skipTime = event.seekOffset || DEFAULTSKIPTIME\n      audio.currentTime = Math.max(audio.currentTime - skipTime, 0)\n      musicPlayerUpdatePositionState()\n    })\n    navigator.mediaSession.setActionHandler('seekforward', function (event) {\n      const skipTime = event.seekOffset || DEFAULTSKIPTIME\n      audio.currentTime = Math.min(audio.currentTime + skipTime, audio.duration || currentDuration)\n      musicPlayerUpdatePositionState()\n    })\n\n    try {\n      navigator.mediaSession.setActionHandler('stop', _ => musicPlayerClose())\n    } catch (error) {\n      console.log('Warning! The \"stop\" media session action is not supported.')\n    }\n\n    try {\n      navigator.mediaSession.setActionHandler('seekto', function (event) {\n        if (event.fastSeek && ('fastSeek' in audio)) {\n          audio.fastSeek(event.seekTime)\n          return\n        }\n        audio.currentTime = event.seekTime\n        musicPlayerUpdatePositionState()\n      })\n    } catch (error) {\n      console.log('Warning! The \"seekto\" media session action is not supported.')\n    }\n  }\n\n  // Download link\n  const downloadLink = player.querySelector('.downloadlink')\n  if (allFeatures.discographyplayerDownloadLink.enabled) {\n    downloadLink.href = next.dataset.file\n    downloadLink.download = (next.dataset.trackNumber > 9 ? '' : '0') + next.dataset.trackNumber + '. ' + fixFilename(next.dataset.artist + ' - ' + next.dataset.title) + '.mp3'\n    downloadLink.style.display = 'block'\n  } else {\n    downloadLink.style.display = 'none'\n  }\n\n  // Show \"playing\" indication on album covers\n  let coverLinkPattern = albumPath(next.dataset.albumUrl)\n  if (document.location.href.split('.')[0] !== next.dataset.albumUrl.split('.')[0]) {\n    /*\n    Subdomain is different from album subdomain -> multiple artists on this page, use full url to detect albums.\n    Otherwise albums with the same name but a different artist name will be highlighted.\n    This would happen quite often on search results.\n    */\n    coverLinkPattern = albumKey(next.dataset.albumUrl)\n  }\n\n  document.querySelectorAll('img.albumIsCurrentlyPlaying').forEach(img => img.classList.remove('albumIsCurrentlyPlaying'))\n  document.querySelectorAll('.albumIsCurrentlyPlayingIndicator').forEach(div => div.remove())\n  document.querySelectorAll('a[href*=\"' + coverLinkPattern + '\"] img').forEach(function (img) {\n    let node = img\n    while (node) {\n      if (node.id === 'discographyplayer') {\n        return\n      }\n      if (node === document.body) {\n        break\n      }\n      node = node.parentNode\n    }\n    img.classList.add('albumIsCurrentlyPlaying')\n    if (!img.parentNode.querySelector('.albumIsCurrentlyPlayingIndicator')) {\n      const indicator = img.parentNode.appendChild(document.createElement('div'))\n      indicator.classList.add('albumIsCurrentlyPlayingIndicator')\n      indicator.addEventListener('click', function (ev) {\n        ev.preventDefault()\n        if (!musicPlayerPlay()) {\n          // Album is now paused -> Remove indicators\n          document.querySelectorAll('img.albumIsCurrentlyPlaying').forEach(img => img.classList.remove('albumIsCurrentlyPlaying'))\n          document.querySelectorAll('.albumIsCurrentlyPlayingIndicator').forEach(div => div.remove())\n        }\n      })\n      indicator.appendChild(document.createElement('div')).classList.add('currentlyPlayingBg')\n      indicator.appendChild(document.createElement('div')).classList.add('currentlyPlayingIcon')\n    }\n  })\n\n  // Animate\n  if (allFeatures.discographyplayerSidebar.enabled && window.matchMedia('(min-width: 1600px)').matches) {\n    // Slide up\n    currentlyPlaying.style.marginTop = -parseInt(currentlyPlaying.clientHeight + 1) + 'px'\n    nextInRow.style.height = '99%'\n    nextInRow.style.width = '99%'\n    window.clearTimeout(ivSlideInNextSong)\n    ivSlideInNextSong = window.setTimeout(function slideInSongInterval () {\n      currentlyPlaying.remove()\n      const clone = nextInRow.cloneNode(true)\n      clone.style.height = '0%'\n      clone.className = 'nextInRow'\n      nextInRow.className = 'currentlyPlaying'\n      nextInRow.parentNode.appendChild(clone)\n    }, 600)\n  } else {\n    // Slide to the left\n    currentlyPlaying.style.marginLeft = -parseInt(currentlyPlaying.clientWidth + 1) + 'px'\n    nextInRow.style.height = '99%'\n    nextInRow.style.width = '99%'\n\n    window.clearTimeout(ivSlideInNextSong)\n\n    ivSlideInNextSong = window.setTimeout(function slideInSongInterval () {\n      currentlyPlaying.remove()\n      const clone = nextInRow.cloneNode(true)\n      clone.style.width = '0%'\n      clone.className = 'nextInRow'\n      nextInRow.className = 'currentlyPlaying'\n      nextInRow.parentNode.appendChild(clone)\n    }, 7 * 1000)\n  }\n\n  window.setTimeout(() => player.querySelector('.playlist .playing').scrollIntoView({ block: 'nearest' }), 200)\n}\n\nfunction musicPlayerPlay () {\n  if (audio.paused) {\n    audio.play().then(_ => musicPlayerUpdatePositionState())\n    musicPlayerCookieChannelSendStop()\n    return true\n  } else {\n    audio.pause()\n    return false\n  }\n}\nfunction musicPlayerStop () {\n  if (!audio.paused) {\n    audio.pause()\n  }\n}\nfunction musicPlayerPrev () {\n  musicPlayerShowBusy()\n  const current = player.querySelector('.playlist .playing')\n  let prev = current.previousElementSibling\n  while (prev) {\n    if ('file' in prev.dataset) {\n      break\n    }\n    prev = prev.previousElementSibling\n  }\n  if (prev) {\n    musicPlayerNextSong(prev)\n  }\n}\nfunction musicPlayerNext () {\n  musicPlayerShowBusy()\n  musicPlayerNextSong()\n}\nfunction musicPlayerPrevAlbum () {\n  audio.pause()\n  window.setTimeout(function musicPlayerPrevAlbumTimeout () {\n    musicPlayerShowBusy()\n    const url = player.querySelector('.playlist .playing').dataset.albumUrl\n    if (!findPreviousAlbumCover(url)) {\n      // Find previous album in playlist\n      let prev = false\n      const as = player.querySelectorAll('.playlist .playlistheading a')\n      for (let i = 0; i < as.length; i++) {\n        if (albumKey(as[i].href) === albumKey(url)) {\n          if (i > 0) {\n            prev = as[i - 1]\n          }\n          break\n        }\n      }\n      if (prev) {\n        prev.parentNode.click()\n      } else {\n        // Just play first song in playlist\n        player.querySelector('.playlist .playlistentry').click()\n      }\n    }\n  }, 10)\n}\nfunction musicPlayerNextAlbum () {\n  audio.pause()\n  window.setTimeout(function musicPlayerNextAlbumTimeout () {\n    musicPlayerShowBusy()\n    const r = findNextAlbumCover(player.querySelector('.playlist .playing').dataset.albumUrl)\n    if (r === false) {\n      // Find next album in playlist\n      let reachedPlaying = false\n      let found = false\n      const lis = player.querySelectorAll('.playlist li')\n      for (let i = 0; i < lis.length; i++) {\n        if (reachedPlaying && lis[i].classList.contains('playlistheading')) {\n          lis[i].click()\n          found = true\n          break\n        } else if (lis[i].classList.contains('playing')) {\n          reachedPlaying = true\n        }\n      }\n      if (!found) {\n        audio.play().then(_ => musicPlayerUpdatePositionState())\n        window.alert('End of playlist reached')\n      }\n    }\n  }, 10)\n}\n\nfunction musicPlayerToggleShuffle () {\n  player.querySelector('.shufflebutton').classList.toggle('active')\n  if (player.querySelector('.shufflebutton').classList.contains('active')) {\n    if (!window.confirm('Would you like to shuffle all albums on this page?\\n\\n(It may take several minutes to load all albums into the playlist)')) {\n      return\n    }\n\n    // Load all albums from page into the player\n    addAllAlbumsAsHeadings()\n\n    // Load unloaded items in playlist\n    let delay = 0\n    // Disable permanent storage for speed\n    storeTralbumDataPermanentlySwitch = false\n\n    let n = player.querySelectorAll('.playlist .playlistheading a.notloaded').length + 1\n\n    if (n > 0) {\n      const queueLoadingIndicator = document.body.appendChild(document.createElement('div'))\n      queueLoadingIndicator.setAttribute('id', 'queueloadingindicator')\n      queueLoadingIndicator.style = 'position:fixed;top:1%;left:10px;background:#d5dce4;color:#033162;font-size:10pt;border:1px solid #033162;z-index:200;'\n    }\n\n    const updateLoadingIndicator = function () {\n      const div = document.getElementById('queueloadingindicator')\n      if (div) {\n        div.innerHTML = `Loading albums into playlist. ${--n} albums remaining...`\n        if (n <= 0) {\n          div.remove()\n          storeTralbumDataPermanentlySwitch = allFeatures.keepLibrary.enabled\n        }\n      }\n    }\n    window.setTimeout(updateLoadingIndicator, 1)\n\n    player.querySelectorAll('.playlist .playlistheading a.notloaded').forEach(async function (notloaded) {\n      const url = notloaded.href\n      notloaded.remove()\n      cachedTralbumData(url).then(function onCachedTralbumDataLoaded (TralbumData) {\n        if (TralbumData) {\n          addAlbumToPlaylist(TralbumData, null)\n          window.setTimeout(updateLoadingIndicator, 10)\n        } else {\n          // Delay to avoid rate limit\n          window.setTimeout(() => playAlbumFromUrl(url, null).then(updateLoadingIndicator), delay * 1000)\n          delay += 4\n        }\n      })\n    })\n  }\n}\n\nfunction musicPlayerOnTimelineClick (ev) {\n  musicPlayerMovePlayHead(ev)\n  const timelineWidth = timeline.offsetWidth - playhead.offsetWidth\n  const clickPercent = (ev.clientX - timeline.getBoundingClientRect().left) / timelineWidth\n  audio.currentTime = currentDuration * clickPercent\n}\n\nfunction musicPlayerOnTimeUpdate () {\n  const playpause = player.querySelector('.playpause')\n  const timelineWidth = timeline.offsetWidth - playhead.offsetWidth\n  const playPercent = timelineWidth * (audio.currentTime / currentDuration)\n  playhead.style.marginLeft = playPercent + 'px'\n  if (audio.currentTime === currentDuration) {\n    playpause.querySelector('.play').style.display = 'none'\n    playpause.querySelector('.busy').style.display = ''\n    playpause.querySelector('.pause').style.display = 'none'\n    if ('mediaSession' in navigator) {\n      navigator.mediaSession.playbackState = 'none'\n    }\n  } else if (audio.paused) {\n    playpause.querySelector('.play').style.display = ''\n    playpause.querySelector('.busy').style.display = 'none'\n    playpause.querySelector('.pause').style.display = 'none'\n    if (document.title.startsWith('\\u25B6\\uFE0E ')) {\n      document.title = document.title.substring(3)\n    }\n    if ('mediaSession' in navigator) {\n      navigator.mediaSession.playbackState = 'paused'\n    }\n  } else {\n    playpause.querySelector('.play').style.display = 'none'\n    playpause.querySelector('.busy').style.display = 'none'\n    playpause.querySelector('.pause').style.display = ''\n    if (!document.title.startsWith('\\u25B6\\uFE0E ')) {\n      document.title = '\\u25B6\\uFE0E ' + document.title\n    }\n    if ('mediaSession' in navigator) {\n      navigator.mediaSession.playbackState = 'playing'\n    }\n  }\n  player.querySelector('.durationDisplay .current').innerHTML = humanDuration(audio.currentTime)\n}\n\nfunction musicPlayerUpdateBufferBar () {\n  if (currentDuration) {\n    if (audio.buffered.length > 0) {\n      bufferbar.style.width = Math.min(100, 1 + parseInt(100 * audio.buffered.end(0) / currentDuration)) + '%'\n    } else {\n      bufferbar.style.width = '100%'\n    }\n  } else {\n    bufferbar.style.width = '0px'\n  }\n}\n\nfunction musicPlayerShowBusy (ev) {\n  const playpause = player.querySelector('.playpause')\n  playpause.querySelector('.play').style.display = 'none'\n  playpause.querySelector('.busy').style.display = ''\n  playpause.querySelector('.pause').style.display = 'none'\n}\n\nfunction musicPlayerMovePlayHead (event) {\n  const newMargLeft = event.clientX - timeline.getBoundingClientRect().left\n  const timelineWidth = timeline.offsetWidth - playhead.offsetWidth\n  if (newMargLeft >= 0 && newMargLeft <= timelineWidth) {\n    playhead.style.marginLeft = newMargLeft + 'px'\n  }\n  if (newMargLeft < 0) {\n    playhead.style.marginLeft = '0px'\n  }\n  if (newMargLeft > timelineWidth) {\n    playhead.style.marginLeft = timelineWidth + 'px'\n  }\n}\nfunction musicPlayerOnPlayheadMouseDown () {\n  onPlayHead = true\n  window.addEventListener('mousemove', musicPlayerMovePlayHead, true)\n  audio.removeEventListener('timeupdate', musicPlayerOnTimeUpdate, false)\n}\n\nfunction musicPlayerOnPlayheadMouseUp (event) {\n  if (onPlayHead) {\n    musicPlayerMovePlayHead(event)\n    window.removeEventListener('mousemove', musicPlayerMovePlayHead, true)\n    // change current time\n    const timelineWidth = timeline.offsetWidth - playhead.offsetWidth\n\n    const clickPercent = (event.clientX - timeline.getBoundingClientRect().left) / timelineWidth\n    audio.currentTime = currentDuration * clickPercent\n    audio.addEventListener('timeupdate', musicPlayerOnTimeUpdate, false)\n  }\n  onPlayHead = false\n}\n\nfunction musicPlayerOnVolumeClick (ev) {\n  const volSlider = player.querySelector('.vol-slider')\n  const sliderWidth = volSlider.offsetWidth\n  const percent = (ev.clientX - volSlider.getBoundingClientRect().left) / sliderWidth\n  audio.logVolume = percent > 0.9 ? 1.0 : percent\n  GM.setValue('volume', audio.logVolume)\n}\nfunction musicPlayerOnVolumeWheel (ev) {\n  ev.preventDefault()\n  const direction = Math.min(Math.max(-1.0, ev.deltaY), 1.0)\n  audio.logVolume = Math.min(Math.max(0.0, audio.logVolume - 0.05 * direction), 1.0)\n  GM.setValue('volume', audio.logVolume)\n}\nfunction musicPlayerOnMuteClick (ev) {\n  if (audio.logVolume < 0.01) {\n    if ('lastvolume' in audio.dataset && audio.dataset.lastvolume) {\n      audio.logVolume = audio.dataset.lastvolume\n      GM.setValue('volume', audio.logVolume)\n    } else {\n      audio.logVolume = 1.0\n    }\n  } else {\n    audio.dataset.lastvolume = audio.logVolume\n    audio.logVolume = 0.0\n  }\n}\n\nfunction musicPlayerOnVolumeChanged (ev) {\n  let icons\n  if (NOEMOJI) {\n    const muteIcon = `<img style=\"width:20px\" src=\"${speakerIconMuteSrc}\" alt=\"\\uD83D\\uDD07\">`\n    const lowIcon = `<img style=\"width:20px\" src=\"${speakerIconLowSrc}\" alt=\"\\uD83D\\uDD07\">`\n    const middleIcon = `<img style=\"width:20px\" src=\"${speakerIconMiddleSrc}\" alt=\"\\uD83D\\uDD07\">`\n    const highIcon = `<img style=\"width:20px\" src=\"${speakerIconHighSrc}\" alt=\"\\uD83D\\uDD07\">`\n    icons = [muteIcon, lowIcon, middleIcon, highIcon]\n  } else {\n    icons = ['\\uD83D\\uDD07', '\\uD83D\\uDD08', '\\uD83D\\uDD09', '\\uD83D\\uDD0A']\n  }\n  const percent = audio.logVolume\n  const volSlider = player.querySelector('.vol-slider')\n  volSlider.querySelector('.vol-amt').style.width = parseInt(100 * percent) + '%'\n  const volIconWrapper = player.querySelector('.vol-icon-wrapper')\n  volIconWrapper.title = 'Mute (' + parseInt(percent * 100) + '%)'\n  if (percent < 0.05) {\n    volIconWrapper.innerHTML = icons[0]\n  } else if (percent < 0.3) {\n    volIconWrapper.innerHTML = icons[1]\n  } else if (percent < 0.8) {\n    volIconWrapper.innerHTML = icons[2]\n  } else {\n    volIconWrapper.innerHTML = icons[3]\n  }\n}\n\nfunction musicPlayerOnEnded (ev) {\n  musicPlayerNextSong()\n  window.setTimeout(() => player.querySelector('.playlist .playing').scrollIntoView({ block: 'nearest' }), 200)\n}\nfunction musicPlayerOnPlaylistClick (ev, contextMenuRoot) {\n  const li = this\n  if (ev.ctrlKey && player.querySelector('.playlist .isselected')) {\n    // Select multiple with ctrlKey\n    ev.preventDefault()\n    musicPlayerContextMenuCtrl.call(li, ev)\n    return\n  }\n  if (ev.shiftKey && musicPlayerContextMenuLastSelectedLi && musicPlayerContextMenuLastSelectedLi.classList.contains('isselected')) {\n    // Select multiple with shift key\n    ev.preventDefault()\n    if (musicPlayerContextMenuShift.call(li, ev)) {\n      return\n    }\n  }\n  musicPlayerNextSong(li)\n  if (contextMenuRoot) {\n    contextMenuRoot.remove()\n  }\n}\nfunction removeSelectedFromPlaylist (ev, contextMenuRoot) {\n  player.querySelectorAll('.playlist .isselected').forEach(function (li) {\n    if (li.classList.contains('playlistentry')) {\n      let walk = li.previousElementSibling\n      let remainingTrackN = 0\n      while (walk.classList.contains('playlistentry')) {\n        remainingTrackN++\n        walk = walk.previousElementSibling\n      }\n      walk = li.nextElementSibling\n      while (walk.classList.contains('playlistentry')) {\n        remainingTrackN++\n        walk = walk.nextElementSibling\n      }\n      if (remainingTrackN === 0) {\n        // If this is last song of album, then remove also album\n        walk = li.previousElementSibling\n        while (walk) {\n          if (walk.classList.contains('playlistheading')) {\n            walk.remove()\n            break\n          }\n          walk = walk.previousElementSibling\n        }\n      }\n      // Remove track\n      li.remove()\n    } else {\n      // Remove album\n      let next = li.nextElementSibling\n      while (next && next.classList.contains('playlistentry')) {\n        next.remove()\n        next = li.nextElementSibling\n      }\n      li.remove()\n    }\n  })\n  if (contextMenuRoot) {\n    contextMenuRoot.remove()\n  }\n}\nfunction musicPlayerOnPlaylistHeadingClick (ev, contextMenuRoot) {\n  const li = this\n  const a = li.querySelector('a[href]')\n  if (a && a.classList.contains('notloaded')) {\n    const url = a.href\n    cachedTralbumData(url).then(function onCachedTralbumDataLoaded (TralbumData) {\n      li.remove()\n      if (TralbumData) {\n        addAlbumToPlaylist(TralbumData)\n      } else {\n        playAlbumFromUrl(url)\n      }\n    })\n  } else if (a && li.nextElementSibling) {\n    li.nextElementSibling.click()\n  }\n  if (contextMenuRoot) {\n    contextMenuRoot.remove()\n  }\n}\nlet musicPlayerContextMenuLastSelectedLi = null\nfunction musicPlayerContextMenuCtrl (ev) {\n  const li = this\n  li.classList.toggle('isselected')\n  if (li.classList.contains('isselected')) {\n    musicPlayerContextMenuLastSelectedLi = li\n  }\n}\nfunction musicPlayerContextMenuShift (ev) {\n  const li = this\n  // Find the last selected element (i.e. in which direction we need to go)\n  let dir = 0\n  let walk = li.previousElementSibling\n  while (walk && dir === 0) {\n    if (walk === musicPlayerContextMenuLastSelectedLi) {\n      dir = -1\n    }\n    walk = walk.previousElementSibling\n  }\n  walk = li.nextElementSibling\n  while (walk && dir === 0) {\n    if (walk === musicPlayerContextMenuLastSelectedLi) {\n      dir = 1\n      break\n    }\n    walk = walk.nextElementSibling\n  }\n  // Select every track in-between\n  if (dir === -1) {\n    walk = li.previousElementSibling\n    while (walk !== musicPlayerContextMenuLastSelectedLi) {\n      if (walk.classList.contains('playlistentry')) {\n        walk.classList.add('isselected')\n      }\n      walk = walk.previousElementSibling\n    }\n    li.classList.add('isselected')\n    return true\n  } else if (dir === 1) {\n    walk = li.nextElementSibling\n    while (walk !== musicPlayerContextMenuLastSelectedLi) {\n      if (walk.classList.contains('playlistentry')) {\n        walk.classList.add('isselected')\n      }\n      walk = walk.nextElementSibling\n    }\n    li.classList.add('isselected')\n    return true\n  } else {\n    return false\n  }\n}\n\nfunction musicPlayerContextMenu (ev) {\n  const li = this\n  if (ev.ctrlKey && player.querySelector('.playlist .isselected')) {\n    // Select multiple with ctrl key\n    musicPlayerContextMenuCtrl.call(li, ev)\n    return\n  }\n  if (ev.shiftKey && musicPlayerContextMenuLastSelectedLi && musicPlayerContextMenuLastSelectedLi.classList.contains('isselected')) {\n    // Select multiple with shift key\n    if (musicPlayerContextMenuShift.call(li, ev)) {\n      return\n    }\n  }\n\n  player.querySelectorAll('.playlist .isselected').forEach(e => e.classList.remove('isselected'))\n  const oldMenu = document.getElementById('discographyplayer_contextmenu')\n  if (oldMenu) {\n    removeViaQuerySelector('#discographyplayer_contextmenu')\n    if (li.dataset.id && li.dataset.id === oldMenu.dataset.id) {\n      return\n    }\n  }\n\n  li.classList.add('isselected')\n  musicPlayerContextMenuLastSelectedLi = li\n  const div = document.body.appendChild(document.createElement('div'))\n  li.dataset.id = Math.random()\n  div.dataset.id = li.dataset.id\n  div.setAttribute('id', 'discographyplayer_contextmenu')\n\n  div.style.left = (ev.pageX + 11) + 'px'\n  div.style.top = (ev.pageY) + 'px'\n\n  const menuEntries = []\n  if (li.classList.contains('playlistentry') || li.classList.contains('playlistheading')) {\n    menuEntries.push(['Remove selected', 'Remove selected tracks or albums from playlist\\nSelect more with CTRL + Right click', removeSelectedFromPlaylist])\n  }\n  if (li.classList.contains('playlistentry')) {\n    menuEntries.push(['Play track', 'Start playback', musicPlayerOnPlaylistClick])\n  }\n  if (li.classList.contains('playlistheading')) {\n    menuEntries.push(['Play album', 'Start playback', musicPlayerOnPlaylistHeadingClick])\n  }\n\n  menuEntries.forEach(function (menuEntry) {\n    const subMenu = div.appendChild(document.createElement('div'))\n    subMenu.classList.add('contextmenu_submenu')\n    subMenu.appendChild(document.createTextNode(menuEntry[0]))\n    subMenu.setAttribute('title', menuEntry[1])\n    subMenu.addEventListener('click', function (clickEvent) {\n      menuEntry[2].call(li, clickEvent, div)\n    })\n  })\n}\n\nfunction musicPlayerOnPlaylistContextMenu (ev) {\n  ev.preventDefault()\n  musicPlayerContextMenu.call(this, ev)\n}\nfunction musicPlayerOnPlaylistHeadingContextMenu (ev) {\n  ev.preventDefault()\n  musicPlayerContextMenu.call(this, ev)\n}\nfunction musicPlayerFavicon (url) {\n  removeViaQuerySelector(document.head, 'link[rel*=icon]')\n  const link = document.createElement('link')\n  link.type = 'image/x-icon'\n  link.rel = 'shortcut icon'\n  link.href = url\n  document.head.appendChild(link)\n}\n\nfunction musicPlayerCollectWishlistClick (ev) {\n  ev.preventDefault()\n\n  if (player.querySelector('.collect-wishlist').dataset === 'own') {\n    return\n  }\n\n  const url = player.querySelector('.collect-wishlist').dataset.albumUrl\n\n  player.querySelectorAll('.collect-wishlist>*').forEach(function (e) { e.style.display = 'none' })\n\n  window.open(url + '#collect-wishlist')\n}\n\nasync function musicPlayerCollectListenedClick (ev) {\n  ev.preventDefault()\n\n  const collectListened = player.querySelector('.collect-listened')\n\n  const url = collectListened.dataset.albumUrl\n\n  window.setTimeout(function musicPlayerCollectListenedResetTimeout () {\n    player.querySelectorAll('.collect-listened>*').forEach(function (e) { e.style.display = 'none' })\n    player.querySelector('.collect-listened .listened-saving').style.display = 'inline-block'\n    player.querySelector('.collect-listened').style.cursor = 'wait'\n  }, 0)\n\n  let albumData = await myAlbumsGetAlbum(url)\n  if (!albumData) {\n    albumData = await myAlbumsNewFromUrl(url, {})\n  }\n\n  if (albumData.listened) {\n    albumData.listened = false\n  } else {\n    albumData.listened = (new Date()).toJSON()\n  }\n\n  collectListened.dataset.listened = albumData.listened\n\n  await myAlbumsUpdateAlbum(albumData)\n\n  player.querySelectorAll('.collect-listened>*').forEach(function (e) { e.style.display = 'none' })\n  if (albumData.listened) {\n    player.querySelector('.collect-listened .listened').style.display = 'inline-block'\n  } else {\n    player.querySelector('.collect-listened .mark-listened').style.display = 'inline-block'\n  }\n  player.querySelector('.collect-listened').style.cursor = ''\n\n  window.setTimeout(makeAlbumLinksGreat, 100)\n}\n\nfunction musicPlayerUpdatePositionState () {\n  if ('mediaSession' in navigator && 'setPositionState' in navigator.mediaSession) {\n    console.log('Updating position state...')\n    navigator.mediaSession.setPositionState({\n      duration: audio.duration || currentDuration || 180,\n      playbackRate: audio.playbackRate,\n      position: audio.currentTime\n    })\n  }\n}\n\nfunction musicPlayerCookieChannel (onStopEventCb) {\n  if (!BANDCAMPDOMAIN) {\n    return\n  }\n  window.addEventListener('message', function onMessage (event) {\n    // Receive messages from the cookie channel event handler\n    if (event.origin === document.location.protocol + '//' + document.location.hostname &&\n    event.data && typeof (event.data) === 'object' && 'discographyplayerCookiechannelPlaylist' in event.data &&\n    event.data.discographyplayerCookiechannelPlaylist.length >= 2 && event.data.discographyplayerCookiechannelPlaylist[1] === 'stop') {\n      onStopEventCb(event.data.discographyplayerCookiechannelPlaylist)\n    }\n  })\n  const script = document.createElement('script')\n  script.innerHTML = `\n  if(typeof Cookie !== 'undefined') {\n    var channel = new Cookie.CommChannel('playlist')\n    channel.send('stop')\n    channel.subscribe(function(a,b) {\n      window.postMessage({'discographyplayerCookiechannelPlaylist': b}, document.location.href)\n      })\n    channel.startListening()\n    window.addEventListener('message', function onMessage (event) {\n      // Receive messages from the user script\n      if (event.origin === document.location.protocol + '//' + document.location.hostname\n      && event.data && typeof(event.data) === 'object' && 'discographyplayerCookiechannelPlaylist' in event.data\n      && event.data.discographyplayerCookiechannelPlaylist === 'sendstop') {\n        channel.send('stop')\n      }\n    })\n    window.addEventListener('unload', function(event) {\n      channel.cleanup()\n    })\n  }\n  `\n  document.head.appendChild(script)\n}\nfunction musicPlayerCookieChannelSendStop (onStopEventCb) {\n  if (BANDCAMPDOMAIN) {\n    window.postMessage({ discographyplayerCookiechannelPlaylist: 'sendstop' }, document.location.href)\n  }\n}\n\nfunction musicPlayerSaveState () {\n  // Add remaining albums as headings\n  addAllAlbumsAsHeadings()\n  // Remove context menu and selection, we don't want to restore those\n  player.querySelectorAll('.playlist .isselected').forEach(e => e.classList.remove('isselected'))\n  removeViaQuerySelector('#discographyplayer_contextmenu')\n  let startPlaybackIndex = false\n  const playlistEntries = player.querySelectorAll('.playlist .playlistentry')\n  for (let i = 0; i < playlistEntries.length; i++) {\n    if (playlistEntries[i].classList.contains('playing')) {\n      startPlaybackIndex = i\n      break\n    }\n  }\n  const startPlaybackTime = audio.currentTime\n  return GM.setValue('musicPlayerState', JSON.stringify({\n    time: (new Date().getTime()),\n    htmlPlaylist: player.querySelector('.playlist').innerHTML,\n    startPlayback: !audio.paused,\n    startPlaybackIndex: startPlaybackIndex,\n    startPlaybackTime: startPlaybackTime,\n    shuffleActive: player.querySelector('.shufflebutton').classList.contains('active')\n  }))\n}\n\nfunction musicPlayerRestoreState (state) {\n  if (!allFeatures.discographyplayerPersist.enabled) {\n    return\n  }\n  if (state.time + 1000 * 30 < (new Date().getTime())) {\n    // Saved state expires after 30 seconds\n    return\n  }\n\n  // Re-create music player\n  musicPlayerCreate()\n  player.querySelector('.playlist').innerHTML = state.htmlPlaylist\n  const playlistEntries = player.querySelectorAll('.playlist .playlistentry')\n  playlistEntries.forEach(function addPlaylistEntryOnClick (li) {\n    li.addEventListener('click', musicPlayerOnPlaylistClick)\n    li.addEventListener('contextmenu', musicPlayerOnPlaylistContextMenu)\n  })\n  player.querySelectorAll('.playlist .playlistheading').forEach(function addPlaylistHeadingEntryOnClick (li) {\n    li.addEventListener('click', musicPlayerOnPlaylistHeadingClick)\n    li.addEventListener('contextmenu', musicPlayerOnPlaylistHeadingContextMenu)\n  })\n  if (state.startPlaybackIndex !== false) {\n    player.querySelectorAll('.playlist .playing').forEach(function (el) {\n      el.classList.remove('playing')\n    })\n    playlistEntries[state.startPlaybackIndex].classList.add('playing')\n    window.setTimeout(() => player.querySelector('.playlist .playing').scrollIntoView({ block: 'nearest' }), 200)\n  }\n  // Start playback\n  if (state.startPlayback && state.startPlaybackIndex !== false) {\n    musicPlayerPlaySong(playlistEntries[state.startPlaybackIndex], state.startPlaybackTime)\n  }\n  if ('shuffleActive' in state && state.shuffleActive) {\n    player.querySelector('.shufflebutton').classList.add('active')\n  }\n}\n\nfunction musicPlayerToggleMinimize (ev, hide) {\n  if (hide || player.style.bottom !== '-57px') {\n    player.style.bottom = '-57px'\n    this.classList.add('minimized')\n  } else {\n    player.style.bottom = '0px'\n    this.classList.remove('minimized')\n  }\n}\n\nfunction musicPlayerClose () {\n  if (player) {\n    player.style.display = 'none'\n  }\n  if (audio) {\n    audio.pause()\n  }\n  document.querySelectorAll('img.albumIsCurrentlyPlaying').forEach(img => img.classList.remove('albumIsCurrentlyPlaying'))\n  document.querySelectorAll('.albumIsCurrentlyPlayingIndicator').forEach(div => div.remove())\n}\n\nfunction musicPlayerCreate () {\n  if (player) {\n    player.style.display = 'block'\n    return\n  }\n\n  musicPlayerCookieChannel(musicPlayerStop)\n\n  const img1px = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mOsmLZvJgAFwQJn5VVZ5QAAAABJRU5ErkJggg=='\n\n  const listenedListUrl = findUserProfileUrl() + '#listened-tab'\n\n  const checkSymbol = NOEMOJI ? '✓' : '✔'\n\n  player = document.createElement('div')\n  document.body.appendChild(player)\n  player.id = 'discographyplayer'\n  player.innerHTML = `\n<div class=\"col col25 nowPlaying\">\n  <div class=\"currentlyPlaying\">\n    <a class=\"cover\" target=\"_blank\" href=\"#\">\n      <img src=\"${img1px}\">\n    </a>\n    <div class=\"info\">\n      <a class=\"link\" target=\"_blank\" href=\"#\">\n        <div class=\"title\">◧◩◨▧■□▩</div>\n        <div class=\"artist\">by <span>◩▧◧□ ◩◨▧ ■◩▩</span></div>\n        <div>from <span class=\"album\">◨■■▩ ▧◨□</span></div>\n      </a>\n    </div>\n  </div>\n  <div class=\"nextInRow\">\n    <a class=\"cover\" target=\"_blank\" href=\"#\">\n      <img src=\"${img1px}\">\n    </a>\n    <div class=\"info\">\n      <a class=\"link\" target=\"_blank\" href=\"#\">\n        <div class=\"title\">◧◩◨▧■□▩</div>\n        <div>by <span class=\"artist\">◩▧◧□ ◩◨▧ ■◩▩</span></div>\n        <div>from <span class=\"album\">◨■■▩ ▧◨□</span></div>\n      </a>\n    </div>\n  </div>\n</div>\n<div class=\"col col25 colcontrols\">\n  <audio autoplay=\"autoplay\" preload=\"auto\"></audio>\n  <div class=\"audioplayer\">\n    <div id=\"timeline\">\n      <div id=\"bufferbar\" class=\"bufferbaranimation\"></div>\n      <div id=\"playhead\"></div>\n    </div>\n    <div class=\"controls\">\n\n      <div class=\"prevalbum\" title=\"Previous album\">\n        <div class=\"arrowbutton prevalbum-icon\"></div>\n      </div>\n\n      <div class=\"prev\" title=\"Previous song\">\n        <div class=\"arrowbutton prev-icon\"></div>\n      </div>\n\n      <div class=\"playpause\" title=\"Play/Pause\">\n        <div class=\"play\" style=\"display: none;\"></div>\n        <div class=\"busy\" style=\"display: none;\"></div>\n        <div class=\"pause\" style=\"\"></div>\n      </div>\n\n      <div class=\"next\" title=\"Next song\">\n        <div class=\"arrowbutton next-icon\"></div>\n      </div>\n\n      <div class=\"nextalbum\" title=\"Next album\">\n        <div class=\"arrowbutton nextalbum-icon\"></div>\n      </div>\n\n      <div class=\"shuffleswitch\" title=\"Shuffle\">\n        <div class=\"shufflebutton\" style=\"background-image:${spriteRepeatShuffle}\"></div>\n      </div>\n\n    </div>\n    \n    <div class=\"durationDisplay\"><span class=\"current\">-</span>/<span class=\"total\">-</span></div>\n\n    <a class=\"downloadlink\" title=\"Download mp3\">\n      ⭳\n    </a>\n    <br class=\"clb\">\n  </div>\n</div>\n<div class=\"col col35\">\n  <ol class=\"playlist\"></ol>\n</div>\n<div class=\"col col15 colcontrols colvolumecontrols\">\n\n  <div class=\"vol\">\n      <div class=\"vol-icon-wrapper\" title=\"Mute\">\n          🔊\n      </div>\n      <div class=\"vol-slider\">\n          <div class=\"vol-amt\" style=\"width: 100%;\"></div>\n          <div class=\"vol-bg\"></div>\n      </div>\n  </div>\n\n  <div class=\"collect\">\n    <div class=\"collect-wishlist\">\n      <a class=\"wishlist-default\" href=\"https://bandcamp.com/wishlist\">Wishlist</a>\n\n      <span class=\"wishlist-add\" title=\"Add this album to your wishlist\">\n        <span class=\"bc-ui2 icon add-item-icon\"></span>\n        <span class=\"add-item-label\">Add to wishlist</span>\n      </span>\n      <span class=\"wishlist-collected\" title=\"Remove this album from your wishlist\">\n        <span class=\"bc-ui2 icon collected-item-icon\"></span>\n        <span>In Wishlist</span>\n      </span>\n      <span class=\"wishlist-own\" title=\"You own this album\">\n        <span class=\"bc-ui2 icon own-item-icon\"></span>\n        <span>You own this</span>\n      </span>\n      <span class=\"wishlist-saving\">\n        Saving....\n      </span>\n    </div>\n    <div class=\"collect-listened\">\n      <a class=\"listened-default\" href=\"${listenedListUrl}\">\n        Played albums\n        </a>\n      <span class=\"listened\" title=\"Mark album as NOT played\">\n        <span class=\"listened-symbol\">${checkSymbol}</span>\n        <span class=\"listened-label\">Played</span>\n      </span>\n      <span class=\"mark-listened\" title=\"Mark album as played\">\n        <span class=\"mark-listened-symbol\">${checkSymbol}</span>\n        <span class=\"mark-listened-label\">Mark as played</span>\n      </span>\n      <span class=\"listened-saving\">\n        Saving...\n      </span>\n    </div>\n  </div>\n\n  <br class=\"cll\">\n  <div class=\"minimizebutton\">\n    <span class=\"minimized\" title=\"Maximize player\">&uarr;</span>\n    <span class=\"maximized\" title=\"Minimize player\">&darr;</span>\n  </div>\n  <div class=\"closebutton\" title=\"Close player\">x</div>\n</div>`\n\n  addStyle(discographyplayerCSS)\n\n  if (allFeatures.discographyplayerSidebar.enabled) {\n    // Sidebar discographyplayer\n    addStyle(discographyplayerSidebarCSS)\n  }\n\n  audio = player.querySelector('audio')\n  addLogVolume(audio)\n  getStoredVolume(function setVolumeCallback (volume) { audio.logVolume = volume })\n  playhead = player.querySelector('#playhead')\n  bufferbar = player.querySelector('#bufferbar')\n  timeline = player.querySelector('#timeline')\n\n  player.querySelector('.minimizebutton').addEventListener('click', musicPlayerToggleMinimize)\n  player.querySelector('.closebutton').addEventListener('click', musicPlayerClose)\n\n  audio.addEventListener('ended', musicPlayerOnEnded)\n  audio.addEventListener('timeupdate', musicPlayerOnTimeUpdate)\n  audio.addEventListener('volumechange', musicPlayerOnVolumeChanged)\n  audio.addEventListener('canplaythrough', function onCanPlayThrough () {\n    currentDuration = audio.duration\n    player.querySelector('.durationDisplay .total').innerHTML = humanDuration(currentDuration)\n  })\n\n  timeline.addEventListener('click', musicPlayerOnTimelineClick, false)\n  playhead.addEventListener('mousedown', musicPlayerOnPlayheadMouseDown, false)\n  window.addEventListener('mouseup', musicPlayerOnPlayheadMouseUp, false)\n\n  player.querySelector('.prevalbum').addEventListener('click', musicPlayerPrevAlbum)\n  player.querySelector('.prev').addEventListener('click', musicPlayerPrev)\n  player.querySelector('.playpause').addEventListener('click', musicPlayerPlay)\n  player.querySelector('.next').addEventListener('click', musicPlayerNext)\n  player.querySelector('.nextalbum').addEventListener('click', musicPlayerNextAlbum)\n  player.querySelector('.shuffleswitch').addEventListener('click', musicPlayerToggleShuffle)\n\n  player.querySelector('.vol-slider').addEventListener('click', musicPlayerOnVolumeClick)\n  player.querySelector('.vol').addEventListener('wheel', musicPlayerOnVolumeWheel, { passive: false })\n  player.querySelector('.vol-icon-wrapper').addEventListener('click', musicPlayerOnMuteClick)\n\n  player.querySelector('.collect-wishlist').addEventListener('click', musicPlayerCollectWishlistClick)\n  player.querySelector('.collect-listened').addEventListener('click', musicPlayerCollectListenedClick)\n\n  player.querySelector('.downloadlink').addEventListener('click', function onDownloadLinkClick (ev) {\n    const addSpinner = (el) => el.classList.add('downloading')\n    const removeSpinner = (el) => el.classList.remove('downloading')\n    downloadMp3FromLink(ev, this, addSpinner, removeSpinner)\n  })\n  if (NOEMOJI) {\n    player.querySelector('.downloadlink').innerHTML = '↓'\n  }\n\n  window.addEventListener('unload', function onPageUnLoad (ev) {\n    if (allFeatures.discographyplayerPersist.enabled && player.style.display !== 'none' && !audio.paused) {\n      musicPlayerSaveState()\n    }\n  })\n\n  window.setInterval(musicPlayerUpdateBufferBar, 1200)\n}\n\nfunction addHeadingToPlaylist (title, url, albumLoaded) {\n  musicPlayerCreate()\n  let content = document.createTextNode('💽 ' + title)\n  if (url) {\n    const a = document.createElement('a')\n    a.href = url\n    a.target = '_blank'\n    a.appendChild(content)\n    content = a\n    a.className = albumLoaded ? 'loaded' : 'notloaded'\n    a.title = 'Open album page'\n  }\n  const li = document.createElement('li')\n  li.appendChild(content)\n  li.className = 'playlistheading'\n  if (!albumLoaded) {\n    li.className += ' notloaded'\n    li.title = 'Load album into playlist'\n  }\n  li.addEventListener('click', musicPlayerOnPlaylistHeadingClick)\n  li.addEventListener('contextmenu', musicPlayerOnPlaylistHeadingContextMenu)\n  player.querySelector('.playlist').appendChild(li)\n}\n\nfunction addToPlaylist (startPlayback, data) {\n  musicPlayerCreate()\n\n  const li = document.createElement('li')\n  if (data.trackNumber != null && data.trackNumber !== 'null') {\n    li.appendChild(document.createTextNode((data.trackNumber > 9 ? '' : '0') + data.trackNumber + '. ' + data.artist + ' - ' + data.title))\n  } else {\n    li.appendChild(document.createTextNode(data.artist + ' - ' + data.title))\n  }\n  const span = document.createElement('span')\n  span.className = 'duration'\n  span.appendChild(document.createTextNode(humanDuration(data.duration)))\n  li.appendChild(span)\n  li.value = data.trackNumber\n  li.dataset.file = data.file\n  li.dataset.title = data.title\n  li.dataset.trackNumber = data.trackNumber\n  li.dataset.duration = data.duration\n  li.dataset.artist = data.artist\n  li.dataset.album = data.album\n  li.dataset.albumUrl = data.albumUrl\n  li.dataset.albumCover = data.albumCover\n  li.dataset.inWishlist = data.inWishlist\n  li.dataset.isPurchased = data.isPurchased\n\n  li.addEventListener('click', musicPlayerOnPlaylistClick)\n  li.addEventListener('contextmenu', musicPlayerOnPlaylistContextMenu)\n  li.className = 'playlistentry'\n  player.querySelector('.playlist').appendChild(li)\n\n  if (startPlayback) {\n    player.querySelectorAll('.playlist .playing').forEach(function (el) {\n      el.classList.remove('playing')\n    })\n    li.classList.add('playing')\n    musicPlayerPlaySong(li)\n    window.setTimeout(() => player.querySelector('.playlist .playing').scrollIntoView({ block: 'nearest' }), 200)\n  }\n}\n\nfunction addAlbumToPlaylist (TralbumData, startPlaybackIndex = 0) {\n  let i = 0\n  const artist = TralbumData.artist\n  const album = TralbumData.current.title\n  const albumUrl = document.location.protocol + '//' + albumKey(TralbumData.url)\n  const albumCover = `https://f4.bcbits.com/img/a${TralbumData.art_id}_2.jpg`\n  addHeadingToPlaylist(album, 'url' in TralbumData ? TralbumData.url : false, true)\n  let streamable = 0\n  for (const key in TralbumData.trackinfo) {\n    const track = TralbumData.trackinfo[key]\n    if (!track.file) {\n      continue\n    }\n    const trackNumber = track.track_num\n    const file = track.file[Object.keys(track.file)[0]]\n    const title = track.title\n    const duration = track.duration\n    const inWishlist = 'tralbum_collect_info' in TralbumData && 'is_collected' in TralbumData.tralbum_collect_info && TralbumData.tralbum_collect_info.is_collected\n    const isPurchased = 'tralbum_collect_info' in TralbumData && 'is_purchased' in TralbumData.tralbum_collect_info && TralbumData.tralbum_collect_info.is_purchased\n    addToPlaylist(startPlaybackIndex === i++, {\n      file: file,\n      title: title,\n      trackNumber: trackNumber,\n      duration: duration,\n      artist: artist,\n      album: album,\n      albumUrl: albumUrl,\n      albumCover: albumCover,\n      inWishlist: inWishlist,\n      isPurchased: isPurchased\n    })\n    streamable++\n  }\n  if (streamable === 0) {\n    const li = document.createElement('li')\n    li.appendChild(document.createTextNode((NOEMOJI ? '\\u27C1' : '\\uD83D\\uDE22') + ' Album is not streamable'))\n    player.querySelector('.playlist').appendChild(li)\n  }\n  player.querySelectorAll('.playlist .playlistheading a.notloaded').forEach(function (el) {\n    // Move unloaded items to the end\n    el.parentNode.parentNode.appendChild(el.parentNode)\n  })\n}\n\nfunction addAllAlbumsAsHeadings () {\n  const as = document.querySelectorAll('.music-grid .music-grid-item a[href*=\"/album/\"],.music-grid .music-grid-item a[href*=\"/track/\"]')\n  const lis = player.querySelectorAll('.playlist .playlistentry')\n  const unloadedAs = player.querySelectorAll('.playlist .playlistheading.notloaded a')\n  const isAlreadyInPlaylist = function (url) {\n    for (let i = 0; i < lis.length; i++) {\n      if (albumKey(lis[i].dataset.albumUrl) === albumKey(url)) {\n        return true\n      }\n    }\n    for (let i = 0; i < unloadedAs.length; i++) {\n      if (albumKey(unloadedAs[i].href) === albumKey(url)) {\n        return true\n      }\n    }\n    return false\n  }\n\n  for (let i = 0; i < as.length; i++) {\n    const url = as[i].href\n    // Check if already in playlist\n    if (!isAlreadyInPlaylist(url)) {\n      const title = ('textContent' in as[i].dataset ? as[i].dataset.textContent : as[i].querySelector('.title').textContent).trim()\n      addHeadingToPlaylist(title, url, false)\n    }\n  }\n}\n\nlet getTralbumDataDelay = 0\nfunction getTralbumData (url, cb, retry = true) {\n  return new Promise(function getTralbumDataPromise (resolve, reject) {\n    GM.xmlHttpRequest({\n      method: 'GET',\n      url: url,\n      onload: function getTralbumDataOnLoad (response) {\n        if (!response.responseText || response.responseText.indexOf('400 Bad Request') !== -1) {\n          let msg = ''\n          try {\n            msg = response.responseText.split('<center>')[1].split('</center>')[0]\n          } catch (e) {\n            msg = response.responseText\n          }\n          window.alert('An error occured. Please clear your cookies of bandcamp.com and try again.\\n\\nOriginal error:\\n' + msg)\n          reject(new Error('Too many cookies'))\n          return\n        }\n        if (!response.responseText || response.responseText.indexOf('429 Too Many Requests') !== -1) {\n          if (retry) {\n            retry = false\n            getTralbumDataDelay += 3\n            const delay = getTralbumDataDelay\n            console.warn(`getTralbumData(): 429 Too Many Requests. Trying again in ${delay} seconds`)\n            window.setTimeout(() => getTralbumDataPromise(resolve, reject), delay * 1000)\n            return\n          }\n          let msg = ''\n          try {\n            msg = response.responseText.split('<center>')[1].split('</center>')[0]\n          } catch (e) {\n            msg = response.responseText\n          }\n          window.alert('An error occured. You\\'re probably being rate limited by bandcamp.\\n\\nOriginal error:\\n' + msg)\n          reject(new Error('429 Too Many Requests'))\n          return\n        }\n        let TralbumData = null\n        try {\n          if (response.responseText.indexOf('var TralbumData =') !== -1) {\n            TralbumData = JSON5.parse(response.responseText.split('var TralbumData =')[1].split('\\n};\\n')[0].replace(/\"\\s+\\+\\s+\"/, '') + '\\n}')\n          } else if (response.responseText.indexOf('data-tralbum=\"') !== -1) {\n            let str = response.responseText.split('data-tralbum=\"')[1].split('\"')[0]\n            str = decodeHTMLentities(response.responseText.split('data-tralbum=\"')[1].split('\"')[0])\n            TralbumData = JSON.parse(str)\n          }\n        } catch (e) {\n          window.alert('An error occured when parsing TralbumData from url=' + url + '.\\n\\nOriginal error:\\n' + e)\n          reject(e)\n          return\n        }\n        if (TralbumData) {\n          correctTralbumData(TralbumData, response.responseText)\n          resolve(TralbumData)\n        } else {\n          const msg = 'Could not parse TralbumData from url=' + url\n          window.alert(msg)\n          console.debug(response.responseText)\n          reject(new Error(msg))\n        }\n      },\n      onerror: function getTralbumDataOnError (response) {\n        console.log('getTralbumData(' + url + ') in onerror() Error: ' + response.status + '\\nResponse:\\n' + response.responseText + '\\n' + ('error' in response ? response.error : ''))\n        reject(new Error('error' in response ? response.error : 'getTralbumData failed with GM.xmlHttpRequest.onerror'))\n      }\n    })\n  })\n}\nfunction correctTralbumData (TralbumDataObj, html) {\n  const TralbumData = JSON.parse(JSON.stringify(TralbumDataObj))\n  // Corrections for single tracks\n  if (TralbumData.current.type === 'track' && TralbumData.current.title.toLowerCase().indexOf('single') === -1) {\n    TralbumData.current.title += ' - Single'\n  }\n  for (let i = 0; i < TralbumData.trackinfo.length; i++) {\n    if (TralbumData.trackinfo[i].track_num === null) {\n      TralbumData.trackinfo[i].track_num = i + 1\n    }\n  }\n  // Add tags from html\n  if (html && html.indexOf('tags-inline-label') !== -1) {\n    const m = html.split('tags-inline-label')[1].split('</div>')[0].match(/\\/tag\\/[^\"]+\"/g)\n    if (m && m.length > 0) {\n      TralbumData.tags = []\n      m.forEach(function (t) {\n        t = t.split('/').pop()\n        t = t.substring(0, t.length - 1)\n        TralbumData.tags.push(t)\n      })\n    }\n  }\n  // Remove stuff we don't use to save storage space\n  delete TralbumData.current.require_email_0\n  delete TralbumData.current.audit\n  delete TralbumData.current.download_pref\n  delete TralbumData.current.set_price\n  delete TralbumData.current.killed\n  delete TralbumData.current.auto_repriced\n  delete TralbumData.current.minimum_price_nonzero\n  delete TralbumData.current.minimum_price\n  delete TralbumData.current.purchase_url\n  delete TralbumData.current.new_desc_format\n  delete TralbumData.current.private\n  delete TralbumData.current.is_set_price\n  delete TralbumData.current.require_email\n  delete TralbumData.current.upc\n  delete TralbumData.packages\n  delete TralbumData.last_subscription_item\n  delete TralbumData.last_subscription_item\n  delete TralbumData.has_discounts\n  delete TralbumData.is_bonus\n  delete TralbumData.play_cap_data\n  delete TralbumData.client_id_sig\n  delete TralbumData.is_purchased\n  delete TralbumData.items_purchased\n  delete TralbumData.is_private_stream\n  delete TralbumData.is_band_member\n  delete TralbumData.licensed_version_ids\n  delete TralbumData.package_associated_license_id\n  for (let i = 0; i < TralbumData.trackinfo.length; i++) {\n    delete TralbumData.trackinfo[i].is_draft\n    delete TralbumData.trackinfo[i].album_preorder\n    delete TralbumData.trackinfo[i].unreleased_track\n    delete TralbumData.trackinfo[i].encoding_error\n    delete TralbumData.trackinfo[i].video_mobile_url\n    delete TralbumData.trackinfo[i].encoding_pending\n    delete TralbumData.trackinfo[i].video_poster_url\n    delete TralbumData.trackinfo[i].video_source_type\n    delete TralbumData.trackinfo[i].video_source_id\n    delete TralbumData.trackinfo[i].video_mobile_url\n    delete TralbumData.trackinfo[i].video_caption\n    delete TralbumData.trackinfo[i].video_featured\n    delete TralbumData.trackinfo[i].video_id\n    for (const attr in TralbumData.trackinfo[i]) {\n      if (TralbumData.trackinfo[i][attr] === null) {\n        delete TralbumData.trackinfo[i][attr]\n      }\n    }\n  }\n  for (const attr in TralbumData) {\n    if (TralbumData[attr] === null) {\n      delete TralbumData[attr]\n    }\n  }\n  return TralbumData\n}\n\nfunction albumKey (url) {\n  if (url.startsWith('/')) {\n    url = document.location.hostname + url\n  }\n  if (url.indexOf('://') !== -1) {\n    url = url.split('://')[1]\n  }\n  if (url.indexOf('#') !== -1) {\n    url = url.split('#')[0]\n  }\n  if (url.indexOf('?') !== -1) {\n    url = url.split('?')[0]\n  }\n  return url\n}\n\nfunction albumPath (url) {\n  if (url.startsWith('/')) {\n    return albumKey(url)\n  }\n  const a = document.createElement('a')\n  a.href = url\n  return a.pathname\n}\n\nasync function storeTralbumData (TralbumData) {\n  const expires = TRALBUM_CACHE_HOURS * 3600000\n  const cache = JSON.parse(await GM.getValue('tralbumdata', '{}'))\n  for (const prop in cache) {\n    // Delete cached values, that are older than 2 hours\n    if ((new Date()).getTime() - (new Date(cache[prop].time)).getTime() > expires) {\n      delete cache[prop]\n    }\n  }\n  TralbumData.time = (new Date()).toJSON()\n  cache[albumKey(TralbumData.url)] = TralbumData\n  await GM.setValue('tralbumdata', JSON.stringify(cache))\n  storeTralbumDataPermanently(TralbumData)\n}\n\nasync function cachedTralbumData (url) {\n  const expires = TRALBUM_CACHE_HOURS * 3600000\n  const key = albumKey(url)\n  const cache = JSON.parse(await GM.getValue('tralbumdata', '{}'))\n  for (const prop in cache) {\n    // Delete cached values, that are older than 2 hours\n    if ((new Date()).getTime() - (new Date(cache[prop].time)).getTime() > expires) {\n      delete cache[prop]\n      continue\n    }\n    if (prop === key) {\n      return cache[prop]\n    }\n  }\n  return false\n}\n\nasync function storeTralbumDataPermanently (TralbumData) {\n  if (!storeTralbumDataPermanentlySwitch) {\n    return\n  }\n  const library = JSON.parse(await GM.getValue('tralbumlibrary', '{}'))\n  const key = albumKey(TralbumData.url)\n  if (key in library) {\n    library[key] = Object.assign(library[key], TralbumData)\n  } else {\n    library[key] = TralbumData\n  }\n  await GM.setValue('tralbumlibrary', JSON.stringify(library))\n}\n\nfunction playAlbumFromCover (ev) {\n  let parent = this\n  for (let j = 0; parent.tagName !== 'A' && j < 20; j++) {\n    parent = parent.parentNode\n  }\n  const url = parent.href\n  parent.querySelector('img')\n  parent.classList.add('discographyplayer_currentalbum')\n\n  // Check if already in playlist\n  if (player) {\n    musicPlayerCreate()\n    const lis = player.querySelectorAll('.playlist .playlistentry')\n    for (let i = 0; i < lis.length; i++) {\n      if (albumKey(lis[i].dataset.albumUrl) === albumKey(url)) {\n        lis[i].click()\n        return\n      }\n    }\n  }\n\n  // Load data\n  cachedTralbumData(url).then(function onCachedTralbumDataLoaded (TralbumData) {\n    if (TralbumData) {\n      addAlbumToPlaylist(TralbumData)\n    } else {\n      playAlbumFromUrl(url)\n    }\n  })\n}\n\nfunction playAlbumFromUrl (url, startPlaybackIndex = 0) {\n  if (!url.startsWith('http')) {\n    url = document.location.protocol + '//' + url\n  }\n  return getTralbumData(url).then(function onGetTralbumDataLoaded (TralbumData) {\n    storeTralbumData(TralbumData)\n    return addAlbumToPlaylist(TralbumData, startPlaybackIndex)\n  }).catch(function onGetTralbumDataError (e) {\n    window.alert('Could not play and load album data from url:\\n' + url + '\\n' + ('error' in e ? e.error : e))\n    console.log(e)\n  })\n}\n\nasync function myAlbumsGetAlbum (url) {\n  const key = albumKey(url)\n  const data = JSON.parse(await GM.getValue('myalbums', '{}'))\n\n  if (key in data) {\n    return data[key]\n  } else {\n    return false\n  }\n}\n\nasync function myAlbumsUpdateAlbum (albumData) {\n  const key = albumKey(albumData.url)\n  const data = JSON.parse(await GM.getValue('myalbums', '{}'))\n\n  if (key in data) {\n    data[key] = Object.assign(data[key], albumData)\n  } else {\n    data[key] = albumData\n  }\n\n  await GM.setValue('myalbums', JSON.stringify(data))\n}\n\nasync function myAlbumsNewFromUrl (url, fallback) {\n  // Get data from cache or load from url\n  url = albumKey(url)\n  const albumData = fallback || {}\n  let TralbumData = await cachedTralbumData(url)\n  if (!TralbumData) {\n    try {\n      TralbumData = await getTralbumData(document.location.protocol + '//' + url)\n    } catch (e) {\n      console.log('myAlbumsNewFromUrl() Could not load album data from url:\\n' + url)\n    }\n    if (TralbumData) {\n      storeTralbumData(TralbumData)\n    }\n  }\n  if (TralbumData) {\n    albumData.artist = TralbumData.artist\n    albumData.title = TralbumData.current.title\n    albumData.albumCover = `https://f4.bcbits.com/img/a${TralbumData.art_id}_2.jpg`\n    albumData.releaseDate = TralbumData.current.release_date\n  }\n  albumData.url = url\n  albumData.listened = false\n  return albumData\n}\n\nfunction makeAlbumCoversGreat () {\n  if (!('makeAlbumCoversGreat' in document.head.dataset)) {\n    document.head.dataset.makeAlbumCoversGreat = true\n    const campExplorerCSS = `\n.music-grid-item {\n  position: relative\n}\n.music-grid-item .art-play {\n  margin-top: -50px;\n}\n`\n    addStyle(`\n.music-grid-item .art-play {\n  position: absolute;\n  width: 74px;\n  height: 54px;\n  left: 50%;\n  top: 50%;\n  margin-left: -36px;\n  margin-top: -27px;\n  opacity: 0;\n  transition: opacity 0.2s;\n}\n.music-grid-item .art-play-bg {\n  position: absolute;\n  width: 100%;\n  height: 100%;\n  left: 0;\n  top: 0;\n  background: #000;\n  border-radius: 4px;\n}\n.music-grid-item .art-play-icon {\n  position: absolute;\n  width: 0;\n  height: 0;\n  left: 28px;\n  top: 17px;\n  border-width: 10px 0 10px 17px;\n  border-color: transparent transparent transparent #fff;\n  border-style: dashed dashed dashed solid;\n}\n.music-grid-item:hover .art-play {\n  opacity: 0.6;\n}\n\n${CAMPEXPLORER ? campExplorerCSS : ''}\n`)\n  }\n  const onclick = function onclick (ev) {\n    ev.preventDefault()\n    playAlbumFromCover.apply(this, ev)\n  }\n  const artPlay = document.createElement('div')\n  artPlay.className = 'art-play'\n  artPlay.innerHTML = '<div class=\"art-play-bg\"></div><div class=\"art-play-icon\"></div>'\n\n  if (CAMPEXPLORER) {\n    document.querySelectorAll('ul.albums').forEach(e => e.classList.add('music-grid'))\n    document.querySelectorAll('ul.albums li.album').forEach(e => e.classList.add('music-grid-item'))\n  }\n\n  // Albums and single tracks\n  const imgs = document.querySelectorAll('.music-grid .music-grid-item a[href*=\"/album/\"] img,.music-grid .music-grid-item a[href*=\"/track/\"] img')\n  for (let i = 0; i < imgs.length; i++) {\n    if (imgs[i].parentNode.getElementsByClassName('art-play').length) {\n      continue\n    }\n    imgs[i].addEventListener('click', onclick)\n\n    // Add play overlay\n    const clone = artPlay.cloneNode(true)\n    clone.addEventListener('click', onclick)\n    imgs[i].parentNode.appendChild(clone)\n  }\n}\n\nasync function makeAlbumLinksGreat (parentElement) {\n  const doc = parentElement || document\n  const myalbums = JSON.parse(await GM.getValue('myalbums', '{}'))\n\n  if (!('makeAlbumLinksGreat' in document.head.dataset)) {\n    document.head.dataset.makeAlbumLinksGreat = true\n    addStyle(`\n    .bdp_check_onlinkhover_container { z-index:1002; position:absolute; display:none }\n    .bdp_check_onlinkhover_container_shown { display:block; background-color:rgba(255,255,255,0.9); padding:0px 2px 0px 0px; border-radius:5px  }\n    .bdp_check_onlinkhover_container:hover { position:absolute; transition: all 300ms linear; background-color:rgba(255,255,255,0.9); padding:0px 10px 0px 7px; border-radius:5px }\n    .bdp_check_onchecked_container { z-index:-1; position:absolute; opacity:0.0; margin-top:-2px}\n    a:hover .bdp_check_onchecked_container { z-index:1002; position:absolute; transition: opacity 300ms linear; opacity:1.0}\n\n    .bdp_check_onlinkhover_symbol {color:rgba(0,0,50,0.7)}\n    .bdp_check_onlinkhover_text {color:rgba(0,0,50,0.7)}\n    .bdp_check_onlinkhover_container:hover .bdp_check_onlinkhover_symbol { color:rgba(0,0,100,1.0) }\n    .bdp_check_onlinkhover_container:hover .bdp_check_onlinkhover_text { color:rgba(0,100,0,1.0)}\n    .bdp_check_onchecked_symbol { color:rgba(0,100,0,0.8) }\n    .bdp_check_onchecked_text { color:rgba(150,200,150,0.8) }\n\n    a:hover .bdp_check_onchecked_symbol { text-shadow: 1px 1px #fff; color:rgba(0,50,0,1.0); transition: all 300ms linear }\n    a:hover .bdp_check_onchecked_text { text-shadow: 1px 1px #000; color:rgba(200,255,200,0.8); transition: all 300ms linear }\n\n    `)\n  }\n\n  const excluded = [...document.querySelectorAll('#carousel-player .now-playing a')]\n  excluded.push(...document.querySelectorAll('#discographyplayer a'))\n  excluded.push(...document.querySelectorAll('#pastreleases a'))\n\n  /*\n  <div class=\"bdp_check_container bdp_check_onlinkhover_container\"><span class=\"bdp_check_onlinkhover_symbol\">\\u2610</span> <span class=\"bdp_check_onlinkhover_text\">Check</span></div>\n  <div class=\"bdp_check_container bdp_check_onlinkhover_container\"><span class=\"bdp_check_onlinkhover_symbol\">\\u1f5f9</span> <span class=\"bdp_check_onlinkhover_text\">Check</span></div>\n  <span class=\"bdp_check_onchecked_symbol\">\\u2611</span> TITLE <div class=\"bdp_check_container bdp_check_onchecked_container\"><span class=\"bdp_check_onchecked_text\">Played</span></div>\n  */\n\n  const onClickSetListened = async function onClickSetListenedAsync (ev) {\n    ev.preventDefault()\n\n    let parentA = this\n    for (let j = 0; parentA.tagName !== 'A' && j < 20; j++) {\n      parentA = parentA.parentNode\n    }\n    window.setTimeout(function showSavingLabel () {\n      parentA.style.cursor = 'wait'\n      parentA.querySelector('.bdp_check_container').innerHTML = 'Saving...'\n    }, 0)\n\n    const url = parentA.href\n    let albumData = await myAlbumsGetAlbum(url)\n    if (!albumData) {\n      albumData = await myAlbumsNewFromUrl(url, { title: this.dataset.textContent })\n    }\n    albumData.listened = (new Date()).toJSON()\n\n    await myAlbumsUpdateAlbum(albumData)\n\n    window.setTimeout(function hideSavingLabel () {\n      parentA.style.cursor = ''\n      makeAlbumLinksGreat()\n    }, 100)\n  }\n  const onClickRemoveListened = async function onClickRemoveListenedAsync (ev) {\n    ev.preventDefault()\n\n    let parentA = this\n    for (let j = 0; parentA.tagName !== 'A' && j < 20; j++) {\n      parentA = parentA.parentNode\n    }\n    window.setTimeout(function showSavingLabel () {\n      parentA.style.cursor = 'wait'\n      parentA.querySelector('.bdp_check_container').innerHTML = 'Saving...'\n    }, 0)\n\n    const url = parentA.href\n    const albumData = await myAlbumsGetAlbum(url)\n    if (albumData) {\n      albumData.listened = false\n      await myAlbumsUpdateAlbum(albumData)\n    }\n\n    window.setTimeout(function hideSavingLabel () {\n      parentA.style.cursor = ''\n      makeAlbumLinksGreat()\n    }, 100)\n  }\n  const mouseOverLink = function onMouseOverLink (ev) {\n    const bdpCheckOnlinkhoverContainer = this.querySelector('.bdp_check_onlinkhover_container')\n    if (bdpCheckOnlinkhoverContainer) {\n      bdpCheckOnlinkhoverContainer.classList.add('bdp_check_onlinkhover_container_shown')\n    }\n  }\n  const mouseOutLink = function onMouseOutLink (ev) {\n    const a = this\n    a.dataset.iv = window.setTimeout(function mouseOutLinkTimeout () {\n      const div = a.querySelector('.bdp_check_onlinkhover_container')\n      if (div) {\n        div.classList.remove('bdp_check_onlinkhover_container_shown')\n        div.dataset.iv = a.dataset.iv\n      }\n    }, 1000)\n  }\n  const mouseMoveLink = function onMouseLoveLink (ev) {\n    if ('iv' in this.dataset) {\n      window.clearTimeout(this.dataset.iv)\n    }\n  }\n  const mouseOverDivCheck = function onMouseOverDivCheck (ev) {\n    const bdpCheckOnlinkhoverSymbol = this.querySelector('.bdp_check_onlinkhover_symbol')\n    if (bdpCheckOnlinkhoverSymbol) {\n      bdpCheckOnlinkhoverSymbol.innerText = NOEMOJI ? '\\u2611' : '\\uD83D\\uDDF9'\n    }\n    if ('iv' in this.dataset) {\n      window.clearTimeout(this.dataset.iv)\n    }\n  }\n  const mouseOutDivCheck = function onMouseOutDivCheck (ev) {\n    const bdpCheckOnlinkhoverSymbol = this.querySelector('.bdp_check_onlinkhover_symbol')\n    if (bdpCheckOnlinkhoverSymbol) {\n      bdpCheckOnlinkhoverSymbol.innerText = '\\u2610'\n    }\n  }\n  const divCheck = document.createElement('div')\n  divCheck.setAttribute('class', 'bdp_check_container bdp_check_onlinkhover_container')\n  divCheck.setAttribute('title', 'Mark as played')\n  divCheck.innerHTML = '<span class=\"bdp_check_onlinkhover_symbol\">\\u2610</span> <span class=\"bdp_check_onlinkhover_text\">Check</span>'\n\n  const divChecked = document.createElement('div')\n  divChecked.setAttribute('class', 'bdp_check_container bdp_check_onchecked_container')\n  divChecked.innerHTML = '<span class=\"bdp_check_onchecked_text\">Played</span>'\n\n  const spanChecked = document.createElement('span')\n  spanChecked.appendChild(document.createTextNode('\\u2611 '))\n  spanChecked.setAttribute('class', 'bdp_check_onchecked_symbol')\n\n  const a = doc.querySelectorAll('a[href*=\"/album/\"],.music-grid .music-grid-item a[href*=\"/track/\"]')\n  let lastKey = ''\n  for (let i = 0; i < a.length; i++) {\n    if (excluded.indexOf(a[i]) !== -1) {\n      continue\n    }\n\n    const key = albumKey(a[i].href)\n    if (key === lastKey) {\n      // Skip multiple consequent links to same album\n      continue\n    }\n    const textContent = a[i].textContent.trim()\n    if (!textContent) {\n      // Skip album covers only\n      continue\n    }\n    let div\n    if (a[i].dataset.textContent) {\n      removeViaQuerySelector(a[i], '.bdp_check_onlinkhover_container')\n      removeViaQuerySelector(a[i], '.bdp_check_onchecked_container')\n      removeViaQuerySelector(a[i], '.bdp_check_onchecked_symbol')\n    } else {\n      a[i].dataset.textContent = textContent\n      a[i].addEventListener('mouseover', mouseOverLink)\n      a[i].addEventListener('mousemove', mouseMoveLink)\n      a[i].addEventListener('mouseout', mouseOutLink)\n    }\n    if (key in myalbums && 'listened' in myalbums[key] && myalbums[key].listened) {\n      div = divChecked.cloneNode(true)\n      div.addEventListener('click', onClickRemoveListened)\n      const date = new Date(myalbums[key].listened)\n      const since = timeSince(date)\n      const dateStr = dateFormater(date)\n      div.title = since + ' ago\\nClick to mark as NOT played'\n      div.querySelector('.bdp_check_onchecked_text').appendChild(document.createTextNode(' ' + dateStr))\n      const span = spanChecked.cloneNode(true)\n      span.title = since + ' ago\\nClick to mark as NOT played'\n      span.addEventListener('click', onClickRemoveListened)\n\n      const firstText = firstChildWithText(a[i]) || a[i].firstChild\n      firstText.parentNode.insertBefore(span, firstText)\n    } else {\n      div = divCheck.cloneNode(true)\n      div.addEventListener('mouseover', mouseOverDivCheck)\n      div.addEventListener('mouseout', mouseOutDivCheck)\n      div.addEventListener('click', onClickSetListened)\n    }\n    a[i].appendChild(div)\n    lastKey = key\n  }\n}\nfunction removeTheTimeHasComeToOpenThyHeartWallet () {\n  if ('theTimeHasComeToOpenThyHeartWallet' in document.head.dataset) {\n    return\n  }\n  document.head.dataset.theTimeHasComeToOpenThyHeartWallet = true\n  document.head.appendChild(document.createElement('script')).innerHTML = `\n    Log.debug(\"theTimeHasComeToOpenThyHeartWallet: start...\")\n    function removeViaQuerySelector (parent, selector) {\n      if (typeof selector === 'undefined') {\n        selector = parent\n        parent = document\n      }\n      for (let el = parent.querySelector(selector); el; el = parent.querySelector(selector)) {\n        el.remove()\n      }\n    }\n    if (typeof TralbumData !== 'undefined') {\n      if (TralbumData.play_cap_data) {\n        TralbumData.play_cap_data.streaming_limit = 100\n        TralbumData.play_cap_data.streaming_limits_enabled = false\n      }\n      for(let i = 0; i < TralbumData.trackinfo.length; i++) {\n        TralbumData.trackinfo[i].is_capped = false\n        TralbumData.trackinfo[i].play_count = 1\n      }\n\n      /* // Alternative would be create new player\n      TralbumLimits.onPlayerInit = () => true\n      TralbumLimits.updatePlayCounts = () => true\n      Player.init(TralbumData, AlbumPage.onPlayerInit);\n      */\n\n      // Update player with modified TralbumData\n      Player.update(TralbumData)\n      Log.debug(\"theTimeHasComeToOpenThyHeartWallet: player updated\")\n    }\n\n    // Restore lyrics onClick\n    /*\n    function parentByClassName(node, className) {\n      while(!node.parentNode.classList.contains(className)) {\n        node = node.parentNode\n        if (node.parentNode === document.documentElement) {\n          return null\n        }\n      }\n      return node.parentNode\n    }\n    function onLyricsClick (ev) {\n      ev.preventDefault()\n      const tr = parentByClassName(this, 'track_row_view')\n      if (tr.classList.contains('current_track')) {\n        parentByClassName(tr, 'track_list').classList.toggle('auto_lyrics')\n      } else {\n        tr.classList.toggle('showlyrics')\n      }\n    }\n    document.querySelectorAll('#track_table .track_row_view .info_link a').forEach(function (a) {\n      a.addEventListener('click', onLyricsClick)\n    })\n    */\n\n    // Hide popup (not really needed, but won't hurt)\n    window.setInterval(function() {\n      if(document.getElementById('play-limits-dialog-cancel-btn')) {\n        document.getElementById('play-limits-dialog-cancel-btn').click()\n        window.setTimeout(function() {\n          removeViaQuerySelector(document, '.ui-dialog.ui-widget')\n          removeViaQuerySelector(document, '.ui-widget-overlay')\n        }, 100)\n      }\n    }, 3000)\n    Log.debug(\"theTimeHasComeToOpenThyHeartWallet: done!\")\n  `\n}\n\nfunction makeCarouselPlayerGreatAgain () {\n  if (player) {\n    // Hide/minimize discography player\n    const closePlayerOnCarouselIv = window.setInterval(function closePlayerOnCarouselInterval () {\n      if (!document.getElementById('carousel-player') || document.getElementById('carousel-player').getClientRects()[0].bottom - window.innerHeight > 0) {\n        return\n      }\n      if (player.style.display === 'none') {\n        // Put carousel player back down in normal position, because discography player is hidden forever\n        document.getElementById('carousel-player').style.bottom = '0px'\n        window.clearInterval(closePlayerOnCarouselIv)\n      } else if (!player.style.bottom) {\n        // Minimize discography player and push carousel player up above the minimized player\n        musicPlayerToggleMinimize.call(player.querySelector('.minimizebutton'), null, true)\n        document.getElementById('carousel-player').style.bottom = (player.clientHeight - 57) + 'px'\n      }\n    }, 5000)\n  }\n\n  let addListenedButtonToCarouselPlayerLast = null\n  const addListenedButtonToCarouselPlayer = function listenedButtonOnCarouselPlayer () {\n    const url = document.querySelector('#carousel-player a[href]') ? albumKey(document.querySelector('#carousel-player a[href]').href) : null\n    if (url && addListenedButtonToCarouselPlayerLast === url) {\n      return\n    }\n    if (!url) {\n      console.log('No url found in carousel player: `#carousel-player a[href]`')\n      return\n    }\n    addListenedButtonToCarouselPlayerLast = url\n\n    removeViaQuerySelector('#carousel-player .carousellistenedstatus')\n\n    const a = document.createElement('a')\n    a.className = 'carousellistenedstatus'\n    a.addEventListener('click', ev => ev.preventDefault())\n    document.querySelector('#carousel-player .controls-extra').insertBefore(a, document.querySelector('#carousel-player .controls-extra').firstChild)\n    a.innerHTML = '<span class=\"listenedstatus\">Loading...</span>'\n    a.href = 'https://' + url\n    makeAlbumLinksGreat(a.parentNode).then(function () {\n      removeViaQuerySelector(a, '.listenedstatus')\n      const span = document.createElement('span')\n      span.addEventListener('click', function () {\n        const span = this\n        span.parentNode.querySelector('.bdp_check_container').click()\n        window.setTimeout(function () {\n          if (span.parentNode.querySelector('.bdp_check_container').textContent.indexOf('Played') !== -1) {\n            span.parentNode.innerHTML = 'Listened'\n          } else {\n            span.parentNode.innerHTML = 'Unplayed'\n          }\n        }, 3000)\n      })\n      if (a.querySelector('.bdp_check_onchecked_text')) {\n        span.className = 'listenedstatus listened'\n        span.innerHTML = '<span class=\"listened-symbol\">✓</span> <span class=\"listened-label\">Played</span>'\n      } else {\n        span.className = 'listenedstatus mark-listened'\n        span.innerHTML = '<span class=\"mark-listened-symbol\">✓</span> <span class=\"mark-listened-label\">Mark as played</span>'\n      }\n      a.insertBefore(span, a.firstChild)\n      a.dataset.textContent = document.querySelector('#carousel-player .now-playing .info a .artist span').textContent + ' - ' + document.querySelector('#carousel-player .now-playing .info a .title').textContent\n    })\n  }\n\n  let lastMediaHubMeta = [null, null]\n  const onNotificationClick = function () {\n    if (!document.querySelector('#carousel-player .transport .next-icon').classList.contains('disabled')) {\n      document.querySelector('#carousel-player .transport .next-icon').click()\n    }\n  }\n  const updateChromePositionState = function () {\n    const audio = document.querySelector('body>audio')\n    if (audio && 'mediaSession' in navigator && 'setPositionState' in navigator.mediaSession) {\n      navigator.mediaSession.setPositionState({\n        duration: audio.duration || 180,\n        playbackRate: audio.playbackRate,\n        position: audio.currentTime\n      })\n    }\n  }\n  const addChromeMediaHubToCarouselPlayer = function chromeMediaHubToCarouselPlayer () {\n    const title = document.querySelector('#carousel-player .info-progress span[data-bind*=\"trackTitle\"]').textContent.trim()\n    const artwork = document.querySelector('#carousel-player .now-playing img').src\n\n    if (lastMediaHubMeta[0] === title && lastMediaHubMeta[1] === artwork) {\n      return\n    }\n    lastMediaHubMeta = [title, artwork]\n\n    const artist = document.querySelector('#carousel-player .now-playing .artist span').textContent.trim()\n    const album = document.querySelector('#carousel-player .now-playing .title').textContent.trim()\n\n    // Notification\n    if (allFeatures.nextSongNotifications.enabled && 'notification' in GM) {\n      GM.notification({\n        title: document.location.host,\n        text: title + '\\nby ' + artist + '\\nfrom ' + album,\n        image: artwork,\n        highlight: false,\n        silent: true,\n        timeout: NOTIFICATION_TIMEOUT,\n        onclick: onNotificationClick\n      })\n    }\n\n    // Media hub\n    if ('mediaSession' in navigator) {\n      const audio = document.querySelector('body>audio')\n      if (audio) {\n        navigator.mediaSession.playbackState = !audio.paused ? 'playing' : 'paused'\n        updateChromePositionState()\n      }\n\n      navigator.mediaSession.metadata = new MediaMetadata({\n        title: title,\n        artist: artist,\n        album: album,\n        artwork: [{\n          src: artwork,\n          sizes: '350x350',\n          type: 'image/jpeg'\n        }]\n      })\n      if (!document.querySelector('#carousel-player .transport .prev-icon').classList.contains('disabled')) {\n        navigator.mediaSession.setActionHandler('previoustrack', () => document.querySelector('#carousel-player .transport .prev-icon').click())\n      } else {\n        navigator.mediaSession.setActionHandler('previoustrack', null)\n      }\n      if (!document.querySelector('#carousel-player .transport .next-icon').classList.contains('disabled')) {\n        navigator.mediaSession.setActionHandler('nexttrack', () => document.querySelector('#carousel-player .transport .next-icon').click())\n      } else {\n        navigator.mediaSession.setActionHandler('nexttrack', null)\n      }\n      const playButton = document.querySelector('#carousel-player .playpause .play')\n      if (playButton && playButton.style.display === 'none') {\n        navigator.mediaSession.setActionHandler('play', null)\n        navigator.mediaSession.setActionHandler('pause', function () {\n          document.querySelector('#carousel-player .playpause').click()\n          navigator.mediaSession.playbackState = 'paused'\n        })\n      } else {\n        navigator.mediaSession.setActionHandler('play', function () {\n          document.querySelector('#carousel-player .playpause').click()\n          navigator.mediaSession.playbackState = 'playing'\n        })\n        navigator.mediaSession.setActionHandler('pause', null)\n      }\n\n      if (audio) {\n        navigator.mediaSession.setActionHandler('seekbackward', function (event) {\n          const skipTime = event.seekOffset || DEFAULTSKIPTIME\n          audio.currentTime = Math.max(audio.currentTime - skipTime, 0)\n          updateChromePositionState()\n        })\n        navigator.mediaSession.setActionHandler('seekforward', function (event) {\n          const skipTime = event.seekOffset || DEFAULTSKIPTIME\n          audio.currentTime = Math.min(audio.currentTime + skipTime, audio.duration)\n          updateChromePositionState()\n        })\n\n        try {\n          navigator.mediaSession.setActionHandler('stop', function () {\n            audio.pause()\n            audio.currentTime = 0\n            navigator.mediaSession.playbackState = 'paused'\n          })\n        } catch (error) {\n          console.log('Warning! The \"stop\" media session action is not supported.')\n        }\n\n        try {\n          navigator.mediaSession.setActionHandler('seekto', function (event) {\n            if (event.fastSeek && ('fastSeek' in audio)) {\n              audio.fastSeek(event.seekTime)\n              return\n            }\n            audio.currentTime = event.seekTime\n            updateChromePositionState()\n          })\n        } catch (error) {\n          console.log('Warning! The \"seekto\" media session action is not supported.')\n        }\n      }\n    }\n  }\n\n  window.setInterval(function addListenedButtonToCarouselPlayerInterval () {\n    if (!document.getElementById('carousel-player') || document.getElementById('carousel-player').getClientRects()[0].bottom - window.innerHeight > 0) {\n      return\n    }\n    addListenedButtonToCarouselPlayer()\n    addChromeMediaHubToCarouselPlayer()\n  }, 2000)\n\n  addStyle(`\n  #carousel-player a.carousellistenedstatus:link,#carousel-player a.carousellistenedstatus:visited,#carousel-player a.carousellistenedstatus:hover{\n    text-decoration:none;\n    cursor:default\n  }\n  #carousel-player .listened .listened-symbol{\n    color:rgb(0,220,50);\n    text-shadow:1px 0px #DDD,-1px 0px #DDD,0px -1px #DDD,0px 1px #DDD\n  }\n  #carousel-player .mark-listened .mark-listened-symbol{\n    color:#FFF;\n    text-shadow:1px 0px #959595,-1px 0px #959595,0px -1px #959595,0px 1px #959595\n  }\n  #carousel-player .mark-listened:hover .mark-listened-symbol{\n    text-shadow:1px 0px #0AF,-1px 0px #0AF,0px -1px #0AF,0px 1px #0AF\n  }\n  `)\n}\n\nasync function addListenedButtonToCollectControls () {\n  const lastLi = document.querySelector('.share-panel-wrapper-desktop ul li')\n  if (!lastLi) {\n    window.setTimeout(addListenedButtonToCollectControls, 300)\n    return\n  }\n\n  const checkSymbol = NOEMOJI ? '✓' : '✔'\n\n  const myalbums = JSON.parse(await GM.getValue('myalbums', '{}'))\n\n  const key = albumKey(document.location.href)\n  const listened = key in myalbums && 'listened' in myalbums[key] && myalbums[key].listened\n\n  const onClickSetListened = async function onClickSetListenedAsync (ev) {\n    ev.preventDefault()\n\n    let parent = this\n    for (let j = 0; parent.tagName !== 'LI' && j < 20; j++) {\n      parent = parent.parentNode\n    }\n    window.setTimeout(function showSavingLabel () {\n      parent.style.cursor = 'wait'\n      parent.innerHTML = 'Saving...'\n    }, 0)\n\n    const url = document.location.href\n    let albumData = await myAlbumsGetAlbum(url)\n    if (!albumData) {\n      albumData = await myAlbumsNewFromUrl(url, { title: this.dataset.textContent })\n    }\n    albumData.listened = (new Date()).toJSON()\n\n    await myAlbumsUpdateAlbum(albumData)\n\n    window.setTimeout(addListenedButtonToCollectControls, 100)\n  }\n  const onClickRemoveListened = async function onClickRemoveListenedAsync (ev) {\n    ev.preventDefault()\n\n    let parent = this\n    for (let j = 0; parent.tagName !== 'LI' && j < 20; j++) {\n      parent = parent.parentNode\n    }\n    window.setTimeout(function showSavingLabel () {\n      parent.style.cursor = 'wait'\n      parent.innerHTML = 'Saving...'\n    }, 0)\n\n    const url = document.location.href\n    const albumData = await myAlbumsGetAlbum(url)\n    if (albumData) {\n      albumData.listened = false\n      await myAlbumsUpdateAlbum(albumData)\n    }\n\n    window.setTimeout(addListenedButtonToCollectControls, 100)\n  }\n\n  removeViaQuerySelector('#discographyplayer_sharepanel')\n\n  const li = lastLi.parentNode.appendChild(document.createElement('li'))\n  const button = li.appendChild(document.createElement('span'))\n  const icon = button.appendChild(document.createElement('span'))\n  const a = button.appendChild(document.createElement('a'))\n\n  li.setAttribute('id', 'discographyplayer_sharepanel')\n  a.addEventListener('click', (ev) => ev.preventDefault())\n  icon.className = 'sharepanelchecksymbol'\n\n  if (listened) {\n    const date = new Date(listened)\n    const since = timeSince(date)\n\n    button.title = since + '\\nClick to mark as NOT played'\n    button.addEventListener('click', onClickRemoveListened)\n\n    icon.style.color = 'rgb(0,220,50)'\n    icon.style.textShadow = '1px 0px #DDD,-1px 0px #DDD,0px -1px #DDD,0px 1px #DDD'\n    icon.style.paddingRight = '5px'\n    icon.appendChild(document.createTextNode(checkSymbol))\n\n    a.appendChild(document.createTextNode('Played'))\n\n    li.appendChild(document.createTextNode(' - '))\n\n    const link = li.appendChild(document.createElement('span'))\n    const viewLink = link.appendChild(document.createElement('a'))\n    viewLink.href = findUserProfileUrl() + '#listened-tab'\n    viewLink.title = 'View list of played albums'\n    viewLink.appendChild(document.createTextNode('view'))\n  } else {\n    button.title = 'Click to mark as played'\n    button.addEventListener('click', onClickSetListened)\n    try {\n      icon.style.color = window.getComputedStyle(document.getElementById('pgBd')).backgroundColor\n      icon.style.textShadow = '1px 0px #959595,-1px 0px #959595,0px -1px #959595,0px 1px #959595'\n      icon.style.paddingRight = '5px'\n    } catch (e) {\n      icon.style.color = '#959595'\n      icon.style.fontWeight = 700\n    }\n    icon.appendChild(document.createTextNode(checkSymbol))\n\n    a.appendChild(document.createTextNode('Unplayed'))\n  }\n}\n\nfunction makeListenedListTabLink () {\n  const grid = document.getElementById('grids').appendChild(document.createElement('div'))\n  grid.className = 'grid'\n  grid.id = 'listened-grid'\n\n  const inner = grid.appendChild(document.createElement('div'))\n  inner.className = 'inner'\n  inner.innerHTML = 'Loading...'\n\n  const li = document.querySelector('ol#grid-tabs').appendChild(document.createElement('li'))\n  li.id = 'listenedlisttablink'\n  li.dataset.tab = 'listened'\n  li.setAttribute('data-grid-id', 'listened-grid')\n  const span = li.appendChild(document.createElement('span'))\n  span.className = 'tab-title'\n  span.appendChild(document.createTextNode('played'))\n\n  const count = span.appendChild(document.createElement('span'))\n  count.className = 'count'\n  GM.getValue('myalbums', '{}').then(function myalbumsLoaded (str) {\n    let n = 0\n    const myalbums = JSON.parse(str)\n    for (const key in myalbums) {\n      if (myalbums[key].listened) {\n        n++\n      }\n    }\n    count.appendChild(document.createTextNode(n))\n  })\n  li.addEventListener('click', showListenedListTab)\n\n  return li\n}\n\nasync function showListenedListTab () {\n  if (document.getElementById('owner-controls')) document.getElementById('owner-controls').style.display = 'none'\n  if (document.getElementById('wishlist-controls')) document.getElementById('wishlist-controls').style.display = 'none'\n\n  const grid = document.getElementById('listened-grid')\n  const gridActive = document.querySelector('#grids .grid.active')\n  if (gridActive && gridActive !== grid) {\n    gridActive.classList.remove('active')\n  }\n  grid.classList.add('active')\n\n  const tabLink = document.getElementById('listenedlisttablink')\n  const tabLinkActive = document.querySelector('#grid-tab li.active')\n  if (tabLinkActive && tabLinkActive !== tabLink) {\n    tabLinkActive.classList.remove('active')\n  }\n  tabLink.classList.add('active')\n\n  if (grid.querySelector('.collection-items')) {\n    return\n  }\n\n  grid.innerHTML = ''\n\n  const collectionItems = grid.appendChild(document.createElement('div'))\n  collectionItems.className = 'collection-items'\n\n  const collectionGrid = collectionItems.appendChild(document.createElement('ol'))\n  collectionGrid.className = 'collection-grid'\n\n  const myalbums = JSON.parse(await GM.getValue('myalbums', '{}'))\n\n  for (const key in myalbums) {\n    const albumData = myalbums[key]\n\n    if (!albumData.listened) {\n      continue\n    }\n\n    const artist = albumData.artist || 'Unkown artist'\n    const title = albumData.title || 'Unkown title'\n    const albumCover = albumData.albumCover || 'https://bandcamp.com/img/0.gif'\n    const url = key\n    const date = new Date(albumData.listened)\n    const since = timeSince(date)\n    const dateStr = dateFormater(date)\n    let releaseDate\n    if ('releaseDate' in albumData) {\n      releaseDate = dateFormaterRelease(new Date(albumData.releaseDate))\n    } else {\n      releaseDate = 'Unknown'\n    }\n\n    const li = collectionGrid.appendChild(document.createElement('li'))\n    li.className = 'collection-item-container'\n    li.innerHTML = `\n      <div class=\"collection-item-gallery-container\">\n        <span class=\"bc-ui2 collect-item-icon-alt\"></span>\n        <div class=\"collection-item-art-container\">\n          <img class=\"collection-item-art\" alt=\"\" src=\"${albumCover}\">\n        </div>\n        <div class=\"collection-title-details\">\n          <a target=\"_blank\" href=\"https://${url}\" class=\"item-link\">\n            <div class=\"collection-item-title\">${title}</div>\n            <div class=\"collection-item-artist\">by ${artist}</div>\n          </a>\n        </div>\n        <div class=\"collection-item-fav-track\">\n          <span title=\"${since} ago\" class=\"favoriteTrackLabel\">played</span>\n          <div title=\"${since} ago\">\n            <span class=\"fav-track-link\">${dateStr}</span>\n          </div>\n          <span class=\"favoriteTrackLabel\">released</span>\n          <div>\n            <span class=\"fav-track-link\">${releaseDate}</span>\n          </div>\n        </div>\n      </div>\n    `\n  }\n}\n\nfunction addVolumeBarToAlbumPage () {\n  // Do not add if one of these scripts already added a volume bar\n  // https://openuserjs.org/scripts/cuzi/Bandcamp_Volume_Bar\n  // https://openuserjs.org/scripts/Mranth0ny62/Bandcamp_Volume_Bar\n  // https://openuserjs.org/scripts/ArtificialInput/Bandcamp_Volume_Bar\n  // https://greasyfork.org/en/scripts/11047-bandcamp-volume-bar/\n  // https://greasyfork.org/en/scripts/38012-bandcamp-volume-bar/\n  if (document.querySelector('.volumeControl')) {\n    return false\n  }\n\n  if (!document.querySelector('#trackInfoInner .playbutton')) {\n    return\n  }\n\n  addStyle(`\n    /* Hide if inline_player is hidden */\n    .hidden .volumeButton,.hidden .volumeControl,.hidden .volumeLabel{\n      display:none\n    }\n\n    .volumeButton {\n      display: inline-block;\n      user-select:none;\n      background: #fff;\n      border: 1px solid #d9d9d9;\n      border-radius: 2px;\n      cursor: pointer;\n      min-height: 50px;\n      min-width: 54px;\n      text-align:center;\n      margin-top:5px;\n    }\n\n    .volumeSymbol {\n      margin-top: 16px;\n      font-size: 30px;\n      color:#222;\n      font-weight:bolder;\n      transform: rotate(-90deg);\n      text-shadow: rgb(255, 255, 255) 0px 0px 0px;\n      transition: text-shadow linear 300ms;\n    }\n    .volumeControl {\n      display:inline-block;\n      user-select:none;\n      top:5px;\n    }\n    .volumeLabel {\n      display:inline-block;\n    }\n\n    .nextsongcontrolbutton {\n      background:#fff;\n      border:1px solid #d9d9d9;\n      border-radius:2px;\n      cursor:pointer;\n      height:24px;\n      width:35px;\n      margin-top:2px;\n      margin-left:80px;\n      float:left;\n      text-align:center\n    }\n\n    .nextsongcontrolicon {\n      background-size:cover;\n      background-image:${spriteRepeatShuffle};\n      width:31px;\n      height:20px;\n      filter:drop-shadow(#FFF 1px 1px 2px);\n      display:inline-block;\n      margin-top:1px;\n      transition: filter 500ms;\n    }\n    .nextsongcontrolbutton.active .nextsongcontrolicon {\n      filter:drop-shadow(#0060F2 1px 1px 2px);\n    }\n\n  `)\n\n  const playbutton = document.querySelector('#trackInfoInner .playbutton')\n  const volumeButton = playbutton.cloneNode(true)\n  document.querySelector('#trackInfoInner .inline_player').appendChild(volumeButton)\n  volumeButton.classList.replace('playbutton', 'volumeButton')\n  volumeButton.style.width = playbutton.clientWidth + 'px'\n  const volumeSymbol = volumeButton.appendChild(document.createElement('div'))\n  volumeSymbol.className = 'volumeSymbol'\n  volumeSymbol.appendChild(document.createTextNode(CHROME ? '\\uD83D\\uDD5B' : '\\u23F2'))\n\n  const progbar = document.querySelector('#trackInfoInner .progbar_cell .progbar')\n  const volumeBar = progbar.cloneNode(true)\n  document.querySelector('#trackInfoInner .inline_player').appendChild(volumeBar)\n  volumeBar.classList.add('volumeControl')\n  volumeBar.style.width = Math.max(200, progbar.clientWidth) + 'px'\n  const thumb = volumeBar.querySelector('.thumb')\n  thumb.setAttribute('id', 'deluxe_thumb')\n  const progbarFill = volumeBar.querySelector('.progbar_fill')\n\n  const volumeLabel = document.createElement('div')\n  document.querySelector('#trackInfoInner .inline_player').appendChild(volumeLabel)\n  volumeLabel.classList.add('volumeLabel')\n\n  let dragging = false\n  let dragPos\n  const width100 = volumeBar.clientWidth - (thumb.clientWidth + 2) // 2px border\n  const rot0 = CHROME ? -180 : -90\n  const rot100 = CHROME ? 350 : 265 - rot0\n  const blue0 = 180\n  const blue100 = 75\n  const green0 = 90\n  const green100 = 100\n  const audioAlbumPage = document.querySelector('body>audio')\n  addLogVolume(audioAlbumPage)\n  const volumeBarPos = volumeBar.getBoundingClientRect().left\n\n  const displayVolume = function updateDisplayVolume () {\n    const level = audioAlbumPage.logVolume\n    volumeLabel.innerHTML = parseInt(level * 100.0) + '%'\n    thumb.style.left = (width100 * level) + 'px'\n    progbarFill.style.width = parseInt(level * 100.0) + '%'\n    volumeSymbol.style.transform = 'rotate(' + ((level * rot100) + rot0) + 'deg)'\n    if (level > 0.005) {\n      volumeSymbol.style.textShadow = 'rgb(0, ' + ((level * green100) + green0) + ', ' + ((level * blue100) + blue0) + ') 0px 0px 4px'\n      volumeSymbol.style.color = '#03a'\n    } else {\n      volumeSymbol.style.textShadow = 'rgb(255, 255, 255) 0px 0px 0px'\n      volumeSymbol.style.color = '#222'\n    }\n  }\n\n  thumb.addEventListener('mousedown', function thumbMouseDown (ev) {\n    if (ev.button === 0) {\n      dragging = true\n      dragPos = ev.offsetX\n    }\n  })\n  volumeBar.addEventListener('mouseup', function thumbMouseUp (ev) {\n    if (ev.button !== 0) {\n      return\n    }\n    ev.preventDefault()\n    ev.stopPropagation()\n\n    if (!dragging) {\n      // Click on volume bar without dragging:\n      audioAlbumPage.muted = false\n      audioAlbumPage.logVolume = Math.max(0.0, Math.min(1.0, (ev.pageX - volumeBarPos) / width100))\n      displayVolume()\n    }\n    dragging = false\n    GM.setValue('volume', audioAlbumPage.logVolume)\n  })\n  document.addEventListener('mouseup', function documentMouseUp (ev) {\n    if (ev.button === 0 && dragging) {\n      dragging = false\n      ev.preventDefault()\n      ev.stopPropagation()\n      GM.setValue('volume', audioAlbumPage.logVolume)\n    }\n  })\n  document.addEventListener('mousemove', function documentMouseMove (ev) {\n    if (ev.button === 0 && dragging) {\n      ev.preventDefault()\n      ev.stopPropagation()\n      audioAlbumPage.muted = false\n      audioAlbumPage.logVolume = Math.max(0.0, Math.min(1.0, ((ev.pageX - volumeBarPos) - dragPos) / width100))\n      displayVolume()\n    }\n  })\n  const onWheel = function onMouseWheel (ev) {\n    ev.preventDefault()\n    const direction = Math.min(Math.max(-1.0, ev.deltaY), 1.0)\n    audioAlbumPage.logVolume = Math.min(Math.max(0.0, audioAlbumPage.logVolume - 0.05 * direction), 1.0)\n    displayVolume()\n    GM.setValue('volume', audioAlbumPage.logVolume)\n  }\n  volumeButton.addEventListener('wheel', onWheel, { passive: false })\n  volumeBar.addEventListener('wheel', onWheel, { passive: false })\n  volumeButton.addEventListener('click', function onVolumeButtonClick (ev) {\n    if (audioAlbumPage.logVolume < 0.01) {\n      if ('lastvolume' in audioAlbumPage.dataset && audioAlbumPage.dataset.lastvolume) {\n        audioAlbumPage.logVolume = audioAlbumPage.dataset.lastvolume\n        GM.setValue('volume', audioAlbumPage.logVolume)\n      } else {\n        audioAlbumPage.logVolume = 1.0\n      }\n    } else {\n      audioAlbumPage.dataset.lastvolume = audioAlbumPage.logVolume\n      audioAlbumPage.logVolume = 0.0\n    }\n    displayVolume()\n  })\n\n  displayVolume()\n\n  window.clearInterval(ivRestoreVolume)\n\n  // Repeat/shuffle buttons\n  const playnextcontrols = document.querySelector('#trackInfoInner .inline_player').appendChild(document.createElement('div'))\n\n  // Show repeat button\n  const repeatButton = playnextcontrols.appendChild(document.createElement('div'))\n  repeatButton.classList.add('nextsongcontrolbutton', 'repeat')\n  repeatButton.setAttribute('title', 'Repeat')\n  const repeatButtonIcon = repeatButton.appendChild(document.createElement('div'))\n  repeatButtonIcon.classList.add('nextsongcontrolicon')\n\n  repeatButton.dataset.repeat = 'none'\n  repeatButtonIcon.style.backgroundPositionY = '-20px'\n\n  repeatButton.addEventListener('click', function () {\n    const posY = this.getElementsByClassName('nextsongcontrolicon')[0].style.backgroundPositionY\n    if (posY === '-20px') {\n      this.getElementsByClassName('nextsongcontrolicon')[0].style.backgroundPositionY = '-40px'\n      this.classList.toggle('active')\n      this.dataset.repeat = 'one'\n    } else if (posY === '-40px') {\n      this.getElementsByClassName('nextsongcontrolicon')[0].style.backgroundPositionY = '-60px'\n      this.dataset.repeat = 'all'\n    } else {\n      this.getElementsByClassName('nextsongcontrolicon')[0].style.backgroundPositionY = '-20px'\n      this.classList.toggle('active')\n      this.dataset.repeat = 'none'\n    }\n  })\n  if (allFeatures.albumPageAutoRepeatAll.enabled) {\n    repeatButton.click()\n    repeatButton.click()\n  }\n\n  // Show shuffle button\n  const shuffleButton = playnextcontrols.appendChild(document.createElement('div'))\n  if (document.querySelectorAll('#track_table a div').length > 2) {\n    shuffleButton.classList.add('nextsongcontrolbutton', 'shuffle')\n    shuffleButton.setAttribute('title', 'Shuffle')\n    const shuffleButtonIcon = shuffleButton.appendChild(document.createElement('div'))\n    shuffleButtonIcon.classList.add('nextsongcontrolicon')\n    shuffleButtonIcon.style.backgroundPositionY = '0px'\n\n    shuffleButton.addEventListener('click', function () {\n      this.classList.toggle('active')\n    })\n  }\n\n  const findLastSongIndex = function () {\n    const allDiv = document.querySelectorAll('#track_table a div')\n    const nextDiv = document.querySelector('#track_table a div.playing')\n    if (!nextDiv) {\n      return allDiv.length - 1\n    }\n    for (let i = 1; i < allDiv.length; i++) {\n      if (allDiv[i] === nextDiv) {\n        return i - 1\n      }\n    }\n    return -1\n  }\n\n  const albumPageAudioOnEnded = function (ev) {\n    const allDiv = document.querySelectorAll('#track_table a div')\n\n    if (repeatButton.dataset.repeat === 'one') {\n      // Click on last song again\n      if (allDiv.length > 0) {\n        allDiv[findLastSongIndex()].click()\n      } else {\n        // No tracklist, click on play button\n        document.querySelector('#trackInfoInner .inline_player .playbutton').click()\n      }\n    } else if (shuffleButton.classList.contains('active') && allDiv.length > 1) {\n      // Find last song\n      const lastSongIndex = findLastSongIndex()\n      // Set a random song (that is not the last song)\n      let index = lastSongIndex\n      while (index === lastSongIndex) {\n        index = randomIndex(allDiv.length)\n      }\n      if (index !== lastSongIndex + 1) {\n        allDiv[index].click()\n      }\n    } else if (repeatButton.dataset.repeat === 'all') {\n      if (findLastSongIndex() === allDiv.length - 1) {\n        if (allDiv[0]) {\n          allDiv[0].click() // Click on first song's play button\n        } else {\n          // No tracklist, click on play button\n          document.querySelector('#trackInfoInner .inline_player .playbutton').click()\n        }\n      }\n    }\n  }\n\n  let lastMediaHubTitle = null\n  const onNotificationClick = function () {\n    if (!document.querySelector('#trackInfoInner .inline_player .nextbutton').classList.contains('hiddenelem')) {\n      document.querySelector('#trackInfoInner .inline_player .nextbutton').click()\n    }\n  }\n  const updateChromePositionState = function () {\n    if (audioAlbumPage && 'mediaSession' in navigator && 'setPositionState' in navigator.mediaSession) {\n      navigator.mediaSession.setPositionState({\n        duration: audioAlbumPage.duration || 180,\n        playbackRate: audioAlbumPage.playbackRate,\n        position: audioAlbumPage.currentTime\n      })\n    }\n  }\n  const albumPageUpdateMediaHubListener = function albumPageUpdateMediaHub () {\n    const TralbumData = unsafeWindow.TralbumData\n    const title = document.querySelector('#trackInfoInner .inline_player .title').textContent.trim()\n    if (lastMediaHubTitle === title) {\n      return\n    }\n    lastMediaHubTitle = title\n\n    // Notification\n    if (allFeatures.nextSongNotifications.enabled && 'notification' in GM) {\n      GM.notification({\n        title: document.location.host,\n        text: title + '\\nby ' + TralbumData.artist + '\\nfrom ' + TralbumData.current.title,\n        image: `https://f4.bcbits.com/img/a${TralbumData.current.art_id}_2.jpg`,\n        highlight: false,\n        silent: true,\n        timeout: NOTIFICATION_TIMEOUT,\n        onclick: onNotificationClick\n      })\n    }\n\n    // Media hub\n    if ('mediaSession' in navigator) {\n      if (audioAlbumPage) {\n        navigator.mediaSession.playbackState = !audioAlbumPage.paused ? 'playing' : 'paused'\n        updateChromePositionState()\n      }\n\n      // Pre load image to get dimension\n      const cover = document.createElement('img')\n      cover.onload = function onCoverLoaded () {\n        navigator.mediaSession.metadata = new MediaMetadata({\n          title: title,\n          artist: TralbumData.artist,\n          album: TralbumData.current.title,\n          artwork: [{\n            src: cover.src,\n            sizes: `${cover.width}x${cover.height}`,\n            type: 'image/jpeg'\n          }]\n        })\n      }\n      cover.src = `https://f4.bcbits.com/img/a${TralbumData.current.art_id}_2.jpg`\n      if (!document.querySelector('#trackInfoInner .inline_player .prevbutton').classList.contains('hiddenelem')) {\n        navigator.mediaSession.setActionHandler('previoustrack', () => document.querySelector('#trackInfoInner .inline_player .prevbutton').click())\n      } else {\n        navigator.mediaSession.setActionHandler('previoustrack', null)\n      }\n      if (!document.querySelector('#trackInfoInner .inline_player .nextbutton').classList.contains('hiddenelem')) {\n        navigator.mediaSession.setActionHandler('nexttrack', () => document.querySelector('#trackInfoInner .inline_player .nextbutton').click())\n      } else {\n        navigator.mediaSession.setActionHandler('nexttrack', null)\n      }\n      if (audioAlbumPage) {\n        navigator.mediaSession.setActionHandler('play', function () {\n          audioAlbumPage.play()\n          navigator.mediaSession.playbackState = 'playing'\n        })\n        navigator.mediaSession.setActionHandler('pause', function () {\n          audioAlbumPage.pause()\n          navigator.mediaSession.playbackState = 'paused'\n        })\n\n        navigator.mediaSession.setActionHandler('seekbackward', function (event) {\n          const skipTime = event.seekOffset || DEFAULTSKIPTIME\n          audioAlbumPage.currentTime = Math.max(audioAlbumPage.currentTime - skipTime, 0)\n          updateChromePositionState()\n        })\n        navigator.mediaSession.setActionHandler('seekforward', function (event) {\n          const skipTime = event.seekOffset || DEFAULTSKIPTIME\n          audioAlbumPage.currentTime = Math.min(audioAlbumPage.currentTime + skipTime, audioAlbumPage.duration)\n          updateChromePositionState()\n        })\n\n        try {\n          navigator.mediaSession.setActionHandler('stop', function () {\n            audioAlbumPage.pause()\n            audioAlbumPage.currentTime = 0\n            navigator.mediaSession.playbackState = 'paused'\n          })\n        } catch (error) {\n          console.log('Warning! The \"stop\" media session action is not supported.')\n        }\n\n        try {\n          navigator.mediaSession.setActionHandler('seekto', function (event) {\n            if (event.fastSeek && ('fastSeek' in audioAlbumPage)) {\n              audioAlbumPage.fastSeek(event.seekTime)\n              return\n            }\n            audioAlbumPage.currentTime = event.seekTime\n            updateChromePositionState()\n          })\n        } catch (error) {\n          console.log('Warning! The \"seekto\" media session action is not supported.')\n        }\n      }\n    }\n  }\n\n  audioAlbumPage.addEventListener('ended', albumPageAudioOnEnded)\n  audioAlbumPage.addEventListener('play', albumPageUpdateMediaHubListener)\n  audioAlbumPage.addEventListener('ended', albumPageUpdateMediaHubListener)\n}\n\nfunction clickAddToWishlist () {\n  const wishButton = document.querySelector('#collect-item>*')\n  if (!wishButton) {\n    window.setTimeout(clickAddToWishlist, 300)\n    return\n  }\n  wishButton.click()\n  if (document.querySelector('#collection-main a')) {\n    // if logged in, the click should be successful, so try to close the window\n    window.setTimeout(window.close, 1000)\n  }\n}\n\nfunction addReleaseDateButton () {\n  const TralbumData = unsafeWindow.TralbumData\n  const now = new Date()\n  const releaseDate = new Date(TralbumData.current.release_date)\n  const days = parseInt(Math.ceil((releaseDate - now) / (1000 * 60 * 60 * 24)))\n  if (releaseDate < now) {\n    return // Release date is in the past\n  }\n  const key = albumKey(TralbumData.url)\n\n  addStyle(`\n  .releaseReminderButton {\n    font-size:13px;\n    font-weight:700;\n    cursor:pointer;\n    transition: border 500ms, padding 500ms\n  }\n  .releaseReminderButton.active {\n    border-radius:5px;\n    padding:0px 5px;\n    border:#3fb32f66 solid 2px\n  }\n  .releaseReminderButton:hover .releaseLabel {\n    text-decoration:underline\n  }\n  `)\n\n  const div = document.querySelector('.share-collect-controls').appendChild(document.createElement('div'))\n  div.style = 'margin-top:4px'\n  const span = div.appendChild(document.createElement('span'))\n  span.className = 'custom-link-color releaseReminderButton'\n  span.title = 'Releases ' + dateFormaterRelease(releaseDate)\n  const daysStr = days === 1 ? 'tomorrow' : (`in ${days} days`)\n  span.innerHTML = `<span>\\u23F0</span> <span class=\"releaseLabel\">Notify <time datetime=\"${releaseDate.toISOString()}\">${daysStr}</time></span>`\n  span.addEventListener('click', (ev) => toggleReleaseReminder(ev, span))\n\n  GM.getValue('releasereminder', '{}').then(function (str) {\n    const releaseReminderData = JSON.parse(str)\n    if (key in releaseReminderData) {\n      span.classList.add('active')\n      span.innerHTML = `<span>\\u23F0</span> <span class=\"releaseLabel\">Reminder set (<time datetime=\"${releaseDate.toISOString()}\">${daysStr}</time>)</span>`\n    }\n  })\n}\n\nasync function toggleReleaseReminder (ev, span) {\n  const TralbumData = unsafeWindow.TralbumData\n  const key = albumKey(TralbumData.url)\n  const releaseReminderData = JSON.parse(await GM.getValue('releasereminder', '{}'))\n  if (key in releaseReminderData) {\n    delete releaseReminderData[key]\n  } else {\n    releaseReminderData[key] = {\n      albumCover: `https://f4.bcbits.com/img/a${TralbumData.art_id}_2.jpg`,\n      releaseDate: TralbumData.current.release_date,\n      artist: TralbumData.artist,\n      title: TralbumData.current.title\n    }\n  }\n  await GM.setValue('releasereminder', JSON.stringify(releaseReminderData))\n\n  if (span) {\n    const releaseDate = new Date(TralbumData.current.release_date)\n    const now = new Date()\n    const days = parseInt(Math.ceil((releaseDate - now) / (1000 * 60 * 60 * 24)))\n    const daysStr = days === 1 ? 'tomorrow' : (`in ${days} days`)\n    if (key in releaseReminderData) {\n      span.classList.add('active')\n      span.innerHTML = `<span>\\u23F0</span> <span class=\"releaseLabel\">Reminder set (<time datetime=\"${releaseDate.toISOString()}\">${daysStr}</time>)</span>`\n    } else {\n      span.classList.remove('active')\n      span.innerHTML = `<span>\\u23F0</span> <span class=\"releaseLabel\">Notify <time datetime=\"${releaseDate.toISOString()}\">${daysStr}</time></span>`\n    }\n  }\n}\nasync function removeReleaseReminder (ev) {\n  ev.preventDefault()\n  const key = this.parentNode.dataset.key\n  const releaseReminderData = JSON.parse(await GM.getValue('releasereminder', '{}'))\n  if (key in releaseReminderData) {\n    delete releaseReminderData[key]\n    await GM.setValue('releasereminder', JSON.stringify(releaseReminderData))\n  }\n  this.parentNode.remove()\n}\nfunction maximizePastReleases () {\n  document.getElementById('pastreleases').style.opacity = 0.0\n  window.setTimeout(() => showPastReleases(null, true), 500)\n  document.getElementById('pastreleases').removeEventListener('click', maximizePastReleases)\n}\nasync function showPastReleases (ev, forceShow) {\n  let hideDate = await GM.getValue('pastreleaseshidden', false)\n  const releaseReminderData = JSON.parse(await GM.getValue('releasereminder', '{}'))\n  const releases = []\n  let pastReleasesCounter = 0\n  const now = new Date()\n  now.setHours(23)\n  now.setMinutes(59)\n  for (const key in releaseReminderData) {\n    releaseReminderData[key].key = key\n    releaseReminderData[key].date = new Date(releaseReminderData[key].releaseDate)\n    releaseReminderData[key].past = now >= releaseReminderData[key].date\n    if (releaseReminderData[key].past) {\n      pastReleasesCounter++\n    }\n    releases.push(releaseReminderData[key])\n  }\n  releases.sort((a, b) => b.date - a.date)\n\n  if (releases.length === 0 || pastReleasesCounter === 0) {\n    return\n  }\n\n  if (!document.getElementById('pastreleases')) {\n    addStyle(pastreleasesCSS)\n  }\n  const div = document.body.appendChild(document.getElementById('pastreleases') || document.createElement('div'))\n  div.setAttribute('id', 'pastreleases')\n  div.style.maxHeight = (document.documentElement.clientHeight - 50) + 'px'\n  div.style.maxWidth = (document.documentElement.clientWidth - 100) + 'px'\n  if (document.getElementById('discographyplayer') && !allFeatures.discographyplayerSidebar.enabled) {\n    div.style.bottom = document.getElementById('discographyplayer').clientHeight + 10 + 'px'\n  }\n  window.setTimeout(function () {\n    div.style.opacity = 1.0\n  }, 200)\n  div.innerHTML = ''\n\n  const table = div.appendChild(document.createElement('div'))\n  table.classList.add('tablediv')\n\n  const firstRow = table.appendChild(document.createElement('div'))\n  firstRow.classList.add('header')\n  firstRow.appendChild(document.createTextNode('\\u23F0'))\n  firstRow.appendChild(document.createElement('span'))\n\n  if (!forceShow && hideDate && !isNaN(hideDate = new Date(hideDate)) && (new Date() - hideDate) < 1000 * 60 * 60) {\n    firstRow.appendChild(document.createTextNode(`${pastReleasesCounter} release` + (pastReleasesCounter === 1 ? '' : 's')))\n    table.addEventListener('click', maximizePastReleases)\n    return\n  } else {\n    GM.setValue('pastreleaseshidden', '')\n  }\n\n  const upcoming = firstRow.appendChild(document.createElement('span'))\n  if (releases.length !== pastReleasesCounter) {\n    upcoming.appendChild(document.createTextNode(' Show upcoming'))\n    upcoming.classList.add('upcoming')\n    upcoming.addEventListener('click', function () {\n      document.querySelectorAll('#pastreleases .future').forEach(function (el) {\n        el.style.display = 'table-row'\n      })\n      this.remove()\n    })\n  }\n\n  const controls = firstRow.appendChild(document.createElement('span'))\n  controls.classList.add('controls')\n\n  const refresh = controls.appendChild(document.createElement('span'))\n  refresh.setAttribute('title', 'Update')\n  refresh.addEventListener('click', function () {\n    document.getElementById('pastreleases').style.opacity = 0.0\n    window.setTimeout(() => showPastReleases(null, true), 1200)\n  })\n  refresh.appendChild(document.createTextNode(NOEMOJI ? 'Refresh' : '⟳'))\n\n  const close = controls.appendChild(document.createElement('span'))\n  close.setAttribute('title', 'Hide')\n  close.addEventListener('click', function () {\n    GM.setValue('pastreleaseshidden', new Date().toJSON())\n    document.getElementById('pastreleases').style.opacity = 0.0\n    window.setTimeout(function () {\n      document.getElementById('pastreleases').remove()\n    }, 700)\n  })\n  close.appendChild(document.createTextNode('X'))\n\n  releases.forEach(function (release) {\n    const days = parseInt(Math.ceil((release.date - now) / (1000 * 60 * 60 * 24)))\n    const daysStr = days === 1 ? 'tomorrow' : (`in ${days} days`)\n    let title = `${release.artist} - ${release.title}`\n\n    const entry = table.appendChild(document.createElement('a'))\n    entry.setAttribute('title', title)\n    entry.dataset.key = release.key\n    entry.classList.add('entry')\n    entry.classList.add(release.past ? 'past' : 'future')\n    entry.setAttribute('href', document.location.protocol + '//' + release.key)\n    entry.setAttribute('target', '_blank')\n\n    const removeButton = entry.appendChild(document.createElement('span'))\n    removeButton.setAttribute('title', 'Remove album')\n    removeButton.classList.add('remove')\n    removeButton.appendChild(document.createTextNode(NOEMOJI ? 'X' : '╳'))\n    removeButton.addEventListener('click', removeReleaseReminder)\n\n    const time = entry.appendChild(document.createElement('time'))\n    time.setAttribute('datetime', release.date.toISOString())\n    time.setAttribute('title', 'Releases ' + dateFormaterRelease(release.date))\n    if (release.past) {\n      time.appendChild(document.createTextNode(dateFormaterNumeric(release.date)))\n    } else {\n      time.appendChild(document.createTextNode(daysStr))\n    }\n\n    const span = entry.appendChild(document.createElement('span'))\n    span.classList.add('title')\n    title = title.length < 60 ? title : (title.substr(0, 57) + '…')\n    span.appendChild(document.createTextNode(' ' + title))\n\n    const image = entry.appendChild(document.createElement('div'))\n    image.classList.add('image')\n    image.style.backgroundRepeat = 'no-repeat'\n    image.style.backgroundSize = 'contain'\n    image.style.backgroundImage = `url(${release.albumCover})`\n  })\n}\n\nfunction showTagSearchForm () {\n  const menuA = document.querySelector('#bcsde_tagsearchbutton')\n  menuA.style.display = 'none'\n\n  if (!document.getElementById('bcsde_tagsearchform')) {\n    addStyle(`\n    #bcsde_tagsearchform {\n      margin:0px 7px;\n    }\n    #bcsde_tagsearchform_tags {\n      display: inline-block;\n      list-style: none;\n      padding: 0;\n    }\n    #bcsde_tagsearchform_tags li {\n      display:inline;\n      background:#f2eaea8a;\n      border: 1px solid rgb(225, 45, 5);\n      border-radius: 15px;\n      padding: 2px 10px 2px 2px;\n      font-size: 13px;\n      font-weight: 500;\n    }\n    #bcsde_tagsearchform_tags li svg {\n      filter: invert(100%);\n      fill:rgb(225, 45, 5);\n      vertical-align: middle;\n    }\n    #bcsde_tagsearchform_tags li .checkmark-icon {\n      display:inline-block;\n    }\n    #bcsde_tagsearchform_tags li .close-icon {\n      display:none;\n    }\n    #bcsde_tagsearchform_tags li:hover .checkmark-icon {\n      display:none;\n    }\n    #bcsde_tagsearchform_tags li:hover .close-icon {\n      display:inline-block;\n    }\n    #bcsde_tagsearchform button {\n      margin: 3px;\n      color: black !important;\n    }\n    #bcsde_tagsearchform_input {\n      background-color: #DFDFDF;\n      padding: 10px 30px 10px 10px;\n      font-size: 14px;\n      border: none;\n      width: 150px;\n      color: #333;\n      margin: 6px 0;\n      border-radius: 3px;\n      box-sizing: border-box;\n      input-select:auto;\n      -webkit-user-select:auto;\n    }\n    #bcsde_tagsearchform_suggestions {\n      list-style: none;\n      margin: 0;\n      position: absolute;\n      z-index: 10;\n      background: #FFF;\n      visibility: hidden;\n      border: 1px solid #000;\n      font-weight: normal;\n      padding: 8px 0;\n      opacity:0;\n      transition:visibility 200ms linear,opacity 200ms linear;\n      ${darkModeModeCurrent === true ? 'filter: invert(85%);' : ''}\n    }\n    #bcsde_tagsearchform_suggestions.visible {\n      visibility:visible;\n      opacity:1;\n    }\n    #bcsde_tagsearchform_suggestions li {\n      padding: 8px 10px;\n      cursor: pointer;\n      list-style: none;\n      margin: 0;\n      display: list-item;\n      text-align: left;\n    }\n    #bcsde_tagsearchform_suggestions li:hover,#bcsde_tagsearchform_suggestions li:focus {\n      background: #F3F3F3;\n    }\n    `)\n    const div = document.createElement('div')\n    div.setAttribute('id', 'bcsde_tagsearchform')\n    menuA.parentNode.appendChild(div)\n\n    const tagsHolder = div.appendChild(document.createElement('ul'))\n    tagsHolder.setAttribute('id', 'bcsde_tagsearchform_tags')\n\n    const m = document.location.href.match(/\\/tag\\/([A-Za-z0-9-]+)(\\?tab=all_releases&t=(.+))?/) // https://bandcamp.com/tag/metal?tab=all_releases&t=post-punk%2Cdark\n    const tags = []\n    if (m) {\n      tags.push(m[1])\n      if (m[3]) {\n        tags.push(...m[3].split('&')[0].split('#')[0].split('%2C'))\n      }\n    }\n    tags.forEach(tag => {\n      tagsHolder.appendChild(tagSearchLabel(tag, tag.replace('-', ' ')))\n    })\n\n    const button = div.appendChild(document.createElement('button'))\n    button.appendChild(document.createTextNode('Go'))\n    button.addEventListener('click', openTagSearch)\n\n    const input = div.appendChild(document.createElement('input'))\n    input.setAttribute('type', 'text')\n    input.setAttribute('id', 'bcsde_tagsearchform_input')\n    input.setAttribute('placeholder', 'tag search')\n    input.addEventListener('keyup', tagSearchInputChange)\n\n    const suggestions = div.appendChild(document.createElement('ol'))\n    suggestions.setAttribute('id', 'bcsde_tagsearchform_suggestions')\n\n    if (document.querySelector('#corphome-autocomplete-form ul.hd-nav.corp-nav .log-in-link')) {\n      // Homepage and not logged in -> make some room by removing the other list items from the nav\n      document.querySelectorAll('#corphome-autocomplete-form ul.hd-nav.corp-nav>li:not([class~=\"menubar-item-tag-search\"])').forEach(listItem => listItem.remove())\n    }\n  } else {\n    document.querySelector('#bcsde_tagsearchform').style.display = ''\n  }\n}\n\nfunction tagSearchLabel (tagNormName, tagName) {\n  const li = document.createElement('li')\n  li.dataset.tagNormName = tagNormName\n  li.dataset.name = tagName\n  const remove = li.appendChild(document.createElement('span'))\n  remove.addEventListener('click', function () {\n    this.parentNode.remove()\n  })\n\n  remove.innerHTML = `\n  <svg class=\"checkmark-icon\" width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\n    <use xmlns:xlink=\"http://www.w3.org/1999/xlink\" xlink:href=\"#material-done\"></use>\n  </svg>\n  <svg class=\"close-icon\" width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\n    <use xmlns:xlink=\"http://www.w3.org/1999/xlink\" xlink:href=\"#material-close\"></use>\n  </svg>\n  `\n\n  li.appendChild(document.createTextNode(tagName))\n  return li\n}\n\nlet ivTagSearchInput = null\nfunction tagSearchInputChange (ev) {\n  clearInterval(ivTagSearchInput)\n\n  if (ev.key === 'Enter') {\n    const input = document.getElementById('bcsde_tagsearchform_input')\n    if (input.value) {\n      useTagSuggestion(null, input.value)\n      return\n    }\n  }\n\n  ivTagSearchInput = window.setTimeout(showTagSuggestions, 300)\n}\n\nfunction showTagSuggestions () {\n  const input = document.getElementById('bcsde_tagsearchform_input')\n  const suggestions = document.getElementById('bcsde_tagsearchform_suggestions')\n  if (!input.value.trim()) {\n    suggestions.classList.remove('visible')\n    return\n  }\n  getTagSuggestions(input.value).then(data => {\n    let found = false\n    if (data.ok && 'matching_tags' in data) {\n      suggestions.innerHTML = ''\n      suggestions.classList.add('visible')\n      suggestions.style.left = input.offsetLeft + 'px'\n      data.matching_tags.forEach(result => {\n        found = true\n        const li = suggestions.appendChild(document.createElement('li'))\n        li.dataset.tagNormName = result.tag_norm_name\n        li.dataset.name = result.tag_name\n        li.addEventListener('click', useTagSuggestion)\n        li.appendChild(document.createTextNode(result.tag_name))\n      })\n    }\n    if (!found) {\n      if (input.value.trim()) {\n        const li = suggestions.appendChild(document.createElement('li'))\n        li.dataset.tagNormName = input.value.replace(/\\s+/, '-')\n        li.dataset.name = input.value\n        li.addEventListener('click', useTagSuggestion)\n        li.appendChild(document.createTextNode(input.value))\n      } else {\n        suggestions.classList.remove('visible')\n      }\n    }\n  })\n}\n\nfunction useTagSuggestion (ev, str = null) {\n  const suggestions = document.getElementById('bcsde_tagsearchform_suggestions')\n  const tagsHolder = document.getElementById('bcsde_tagsearchform_tags')\n  const input = document.getElementById('bcsde_tagsearchform_input')\n\n  let tagNormName\n  let name\n  if (str) {\n    // Use str\n    tagNormName = str.replace(/\\s+/, '-')\n    name = str\n  } else {\n    // Use tag that was clicked\n    tagNormName = this.dataset.tagNormName\n    name = this.dataset.name\n  }\n\n  tagsHolder.appendChild(tagSearchLabel(tagNormName, name))\n\n  suggestions.classList.remove('visible')\n  input.value = ''\n  input.focus()\n}\n\nfunction getTagSuggestions (query) {\n  const url = 'https://bandcamp.com/api/fansignup/1/search_tag'\n  return new Promise(function getTagSuggestionsPromise (resolve, reject) {\n    GM.xmlHttpRequest({\n      method: 'POST',\n      data: JSON.stringify({\n        count: 20,\n        search_term: query\n      }),\n      url: url,\n      onload: function getTagSuggestionsOnLoad (response) {\n        if (!response.responseText || response.responseText.indexOf('400 Bad Request') !== -1) {\n          reject(new Error('Tag suggestions error: Too many cookies'))\n          return\n        }\n        if (!response.responseText || response.responseText.indexOf('429 Too Many Requests') !== -1) {\n          reject(new Error('Tag suggestions error: 429 Too Many Requests'))\n          return\n        }\n        let result = null\n        try {\n          result = JSON.parse(response.responseText)\n        } catch (e) {\n          console.debug(response.responseText)\n          reject(e)\n          return\n        }\n        resolve(result)\n      },\n      onerror: function getTagSuggestionsOnError (response) {\n        reject(new Error('error' in response ? response.error : 'getTagSuggestions failed with GM.xmlHttpRequest.onerror'))\n      }\n    })\n  })\n}\n\nfunction openTagSearch () {\n  // https://bandcamp.com/tag/metal?tab=all_releases&t=post-punk%2Cdark\n  this.innerHTML = 'Loading...'\n\n  const tagsHolder = document.getElementById('bcsde_tagsearchform_tags')\n\n  const tags = [...new Set(Array.from(tagsHolder.querySelectorAll('li')).map(li => li.dataset.tagNormName))]\n\n  if (!tags) {\n    return\n  }\n\n  const url = `https://bandcamp.com/tag/${tags.shift()}?tab=all_releases&t=${tags.join('%2C')}`\n\n  document.location.href = url\n}\n\nfunction mainMenu (startBackup) {\n  addStyle(`\n    .deluxemenu {\n      position:fixed;\n      height:auto;\n      overflow:auto;\n      top:20px;\n      left:20px;\n      z-index:1102;\n      padding:5px;\n      transition: left 1s;\n      border:2px solid black;\n      border-radius:10px;\n      color:black;\n      background:white;\n    }\n    .deluxemenu input{\n      box-shadow: 2px 2px 5px #5555;\n      transition: box-shadow 500ms;\n    }\n    .deluxemenu fieldset{\n      border: 1px solid #000a;\n      border-radius: 4px;\n      box-shadow: 1px 1px 3px #0005;\n    }\n    .deluxemenu fieldset legend{\n      margin-left: 10px;\n      color: #000a\n    }\n    .breathe {\n      animation: breathe 1.5s linear infinite\n    }\n    @keyframes breathe {\n      50% { opacity: 0.3 }\n    }\n    .errorblink {\n      animation: errorblink 1.5s linear infinite;\n      border: 2px solid red;\n    }\n    @keyframes errorblink {\n      50% { border-color:#6a0c41 }\n    }\n    .deluxemenu ul {\n      margin: 0px;\n      padding: 0px 0px 0px 10px;\n      list-style:disc;\n    }\n    .deluxemenu ul li{\n      margin: 0px;\n      padding: 0px;\n    }\n  `)\n\n  if (startBackup === true) {\n    exportMenu()\n    return\n  }\n\n  if (document.querySelector('.deluxemenu')) {\n    return\n  }\n\n  // Blur background\n  if (document.getElementById('centerWrapper')) { document.getElementById('centerWrapper').style.filter = 'blur(4px)' }\n\n  const main = document.body.appendChild(document.createElement('div'))\n  main.className = 'deluxemenu'\n  main.innerHTML = `<h2>${SCRIPT_NAME}</h2>\n  Source code license: <a target=\"_blank\" href=\"https://github.com/cvzi/Bandcamp-script-deluxe-edition/blob/master/LICENSE\">MIT</a><br>\n  Support: <a target=\"_blank\" href=\"https://github.com/cvzi/Bandcamp-script-deluxe-edition\">github.com/cvzi/Bandcamp-script-deluxe-edition</a><br>\n  Dark theme based on: <a target=\"_blank\" href=\"https://userstyles.org/styles/171538/bandcamp-in-dark\">\"Bandcamp In Dark\"</a> by <a target=\"_blank\" href=\"https://userstyles.org/users/563391\">Simonus</a><br>\n  Dev &amp; build tools used: <a target=\"_blank\" href=\"https://github.com/cvzi/Bandcamp-script-deluxe-edition/blob/master/package.json#L43-L71\">package.json</a><br>\n  Emoji: <a target=\"_blank\" href=\"https://github.com/hfg-gmuend/openmoji\">OpenMoji</a><br>\n  Javascript libraries used:<br><ul>\n  <li><a target=\"_blank\" href=\"https://json5.org/\">JSON5 - JSON for Humans</a> (MIT license)</li>\n  <li><a target=\"_blank\" href=\"https://github.com/facebook/react\">React</a> (MIT license)</li>\n  <li><a target=\"_blank\" href=\"https://github.com/cvzi/genius-lyrics-userscript/\">GeniusLyrics.js</a> (GPLv3)</li>\n   </ul>\n   <h3>Options</h3>\n  `\n\n  window.setTimeout(function moveMenuIntoView () {\n    main.style.maxHeight = (document.documentElement.clientHeight - 150) + 'px'\n    main.style.maxWidth = (document.documentElement.clientWidth - 40) + 'px'\n    main.style.left = Math.max(20, 0.5 * (document.body.clientWidth - main.clientWidth)) + 'px'\n  }, 0)\n\n  Promise.all([\n    GM.getValue('volume', '0.7'),\n    GM.getValue('myalbums', '{}'),\n    GM.getValue('tralbumdata', '{}'),\n    GM.getValue('enabledFeatures', false),\n    GM.getValue('markasplayedThreshold', '10s')\n  ]).then(function allPromisesLoaded (values) {\n    // let volume = parseFloat(values[0])\n    // volume = Number.isNaN(volume) ? 0.7 : volume\n    const myalbums = JSON.parse(values[1])\n    const tralbumdata = JSON.parse(values[2])\n    getEnabledFeatures(values[3])\n    const markasplayedThreshold = values[4]\n\n    const checkboxOnChange = async function onCheckboxChange () {\n      const input = this\n      getEnabledFeatures(await GM.getValue('enabledFeatures', false))\n      allFeatures[input.name].enabled = input.checked\n      await GM.setValue('enabledFeatures', JSON.stringify(allFeatures))\n      input.style.boxShadow = '2px 2px 5px #0a0f'\n      window.setTimeout(function resetBoxShadowTimeout () {\n        input.style.boxShadow = ''\n      }, 3000)\n      updateMoreVisibility()\n    }\n\n    const thresholdOnChange = async function onThresholdChange () {\n      const input = this\n      let value = input.value.trim()\n      const m = value.match(/^(\\d+)(s|%)$/)\n      if (m && parseInt(m[1]) >= 0 && (m[2] === 's' || parseInt(m[1]) <= 100)) {\n        value = m[1] + m[2]\n      } else if (value.match(/^\\d+$/) && parseInt(value.split('\\n')[0]) >= 0) {\n        value = value.split('\\n')[0] + 's'\n      } else {\n        window.alert('Format does not match!\\nChoose either a time in seconds e.g. 10s or a percentage e.g. 50%')\n        return\n      }\n\n      await GM.setValue('markasplayedThreshold', value)\n      input.value = value\n      input.style.boxShadow = '2px 2px 5px #0a0f'\n      window.setTimeout(function resetBoxShadowTimeout () {\n        input.style.boxShadow = ''\n      }, 3000)\n    }\n    const updateMoreVisibility = function () {\n      for (const feature in allFeatures) {\n        if (document.getElementById('feature_' + feature + '_more_on')) {\n          document.getElementById('feature_' + feature + '_more_on').style.display = allFeatures[feature].enabled ? 'block' : 'none'\n        }\n        if (document.getElementById('feature_' + feature + '_more_off')) {\n          document.getElementById('feature_' + feature + '_more_off').style.display = allFeatures[feature].enabled ? 'none' : 'block'\n        }\n      }\n    }\n\n    for (const feature in allFeatures) {\n      const div = main.appendChild(document.createElement('div'))\n      const checkbox = div.appendChild(document.createElement('input'))\n      checkbox.type = 'checkbox'\n      checkbox.id = 'feature_' + feature\n      checkbox.name = feature\n      checkbox.checked = allFeatures[feature].enabled\n      const label = div.appendChild(document.createElement('label'))\n      label.setAttribute('for', 'feature_' + feature)\n      label.innerHTML = allFeatures[feature].name\n      checkbox.addEventListener('change', checkboxOnChange)\n\n      if (feature === 'markasplayedAuto') {\n        main.appendChild(document.createTextNode(' '))\n        const inputThreshold = div.appendChild(document.createElement('input'))\n        inputThreshold.type = 'text'\n        inputThreshold.value = markasplayedThreshold\n        inputThreshold.size = 3\n        inputThreshold.title = 'For example: 10s or 50%'\n        inputThreshold.id = 'feature_' + feature + '_threshold'\n        div.appendChild(document.createTextNode(' '))\n        const label = div.appendChild(document.createElement('label'))\n        label.setAttribute('for', 'feature_' + feature + '_threshold')\n        label.innerHTML = 'seconds or percentage.'\n        inputThreshold.addEventListener('change', thresholdOnChange)\n      }\n\n      if (feature in moreSettings) {\n        if (typeof (moreSettings[feature]) === 'function') {\n          const moreSettinsContainer = main.appendChild(document.createElement('fieldset'))\n          moreSettings[feature](moreSettinsContainer).then(function (v) {\n            if (v) {\n              moreSettinsContainer.appendChild(document.createElement('legend')).appendChild(document.createTextNode(v))\n            }\n          })\n        } else {\n          if ('true' in moreSettings[feature]) {\n            const moreSettinsContainerOn = main.appendChild(document.createElement('fieldset'))\n            moreSettinsContainerOn.setAttribute('id', 'feature_' + feature + '_more_on')\n            moreSettinsContainerOn.style.display = allFeatures[feature].enabled ? 'block' : 'none'\n            moreSettings[feature].true(moreSettinsContainerOn).then(function (v) {\n              if (v) {\n                moreSettinsContainerOn.appendChild(document.createElement('legend')).appendChild(document.createTextNode(v))\n              }\n            })\n          }\n          if ('false' in moreSettings[feature]) {\n            const moreSettinsContainerOff = main.appendChild(document.createElement('fieldset'))\n            moreSettinsContainerOff.setAttribute('id', 'feature_' + feature + '_more_off')\n            moreSettinsContainerOff.style.display = allFeatures[feature].enabled ? 'none' : 'block'\n            moreSettings[feature].false(moreSettinsContainerOff).then(function (v) {\n              if (v) {\n                moreSettinsContainerOff.appendChild(document.createElement('legend')).appendChild(document.createTextNode(v))\n              }\n            })\n          }\n        }\n      }\n    }\n\n    // Hint\n    main.appendChild(document.createElement('br'))\n    const p = main.appendChild(document.createElement('p'))\n    p.appendChild(document.createTextNode('Changes may require a page reload (F5)'))\n\n    // Bottom buttons\n    main.appendChild(document.createElement('br'))\n    const buttons = main.appendChild(document.createElement('div'))\n\n    const closeButton = buttons.appendChild(document.createElement('button'))\n    closeButton.appendChild(document.createTextNode('Close'))\n    closeButton.style.color = 'black'\n    closeButton.addEventListener('click', function onCloseButtonClick () {\n      document.querySelector('.deluxemenu').remove()\n      // Un-blur background\n      if (document.getElementById('centerWrapper')) {\n        document.getElementById('centerWrapper').style.filter = ''\n      }\n    })\n\n    const clearCacheButton = buttons.appendChild(document.createElement('button'))\n    clearCacheButton.appendChild(document.createTextNode('Clear cache'))\n    clearCacheButton.style.color = 'black'\n    clearCacheButton.addEventListener('click', function onClearCacheButtonClick () {\n      Promise.all([\n        GM.setValue('genius_selectioncache', '{}'),\n        GM.setValue('genius_requestcache', '{}'),\n        GM.setValue('tralbumdata', '{}')\n      ]).then(function showClearedLabel () {\n        clearCacheButton.innerHTML = 'Cleared'\n      })\n    })\n    Promise.all([\n      GM.getValue('genius_selectioncache', '{}'),\n      GM.getValue('genius_requestcache', '{}')\n    ]).then(function (values) {\n      JSON.stringify(tralbumdata)\n      const bytesN = values[0].length - 2 + values[1].length - 2 + JSON.stringify(tralbumdata).length - 2\n      const bytes = metricPrefix(bytesN, 1, 1024) + 'Bytes'\n      clearCacheButton.replaceChild(document.createTextNode('Clear cache (' + bytes + ')'), clearCacheButton.firstChild)\n    })\n\n    let myalbumsLength = 0\n    for (const key in myalbums) {\n      if (myalbums[key].listened) {\n        myalbumsLength++\n      }\n    }\n    const exportButton = buttons.appendChild(document.createElement('button'))\n    exportButton.appendChild(document.createTextNode('Export played albums (' + myalbumsLength + ')'))\n    exportButton.style.color = 'black'\n    exportButton.addEventListener('click', function onExportButtonClick () {\n      document.querySelector('.deluxemenu').remove()\n      exportMenu()\n    })\n\n    main.appendChild(document.createElement('br'))\n    main.appendChild(document.createElement('br'))\n\n    const donateLink = main.appendChild(document.createElement('a'))\n    const donateButton = donateLink.appendChild(document.createElement('button'))\n    donateButton.appendChild(document.createTextNode('\\u2764\\uFE0F Donate & Support'))\n    donateButton.style.color = '#e81224'\n    donateLink.setAttribute('href', 'https://github.com/cvzi/Bandcamp-script-deluxe-edition#donate')\n    donateLink.setAttribute('target', '_blank')\n\n    main.appendChild(document.createElement('br'))\n    main.appendChild(document.createElement('br'))\n  })\n  window.setTimeout(function moveMenuIntoView () {\n    let moveLeft = 0\n    main.style.maxHeight = (document.documentElement.clientHeight - 40) + 'px'\n    main.style.maxWidth = (document.documentElement.clientWidth - 40) + 'px'\n    if (document.querySelector('#discographyplayer')) {\n      if (document.querySelector('#discographyplayer').clientHeight < 100) {\n        main.style.maxHeight = (document.documentElement.clientHeight - 150) + 'px'\n        main.style.maxWidth = (document.documentElement.clientWidth - 40) + 'px'\n      } else if (document.querySelector('#discographyplayer').clientHeight > 300) {\n        main.style.maxHeight = (document.documentElement.clientHeight - 40) + 'px'\n        main.style.maxWidth = (document.documentElement.clientWidth - 40 - document.querySelector('#discographyplayer').clientWidth) + 'px'\n        moveLeft = document.querySelector('#discographyplayer').clientWidth + 20\n      }\n    }\n    window.setTimeout(function () {\n      main.style.left = Math.max(20, 0.5 * (document.body.clientWidth - main.clientWidth) - moveLeft) + 'px'\n    }, 10)\n  }, 10)\n}\n\nfunction exportMenu (showClearButton) {\n  addStyle(`\n    .deluxeexportmenu table {\n    }\n\n    .deluxeexportmenu table tr>td {\n      color:black\n    }\n    .deluxeexportmenu table tr>td:nth-child(3) {\n      color:silver\n    }\n    .deluxeexportmenu textarea.animated{\n      box-shadow: 2px 2px 5px #5555;\n      transition: box-shadow 500ms;\n    }\n    .deluxeexportmenu .drophint {\n      position:absolute;\n      top:10%;\n      left:30%;\n      color:#0097ff;\n      font-size:3em;\n      display:none;\n    }\n  `)\n\n  // Blur background\n  if (document.getElementById('centerWrapper')) { document.getElementById('centerWrapper').style.filter = 'blur(4px)' }\n\n  const main = document.body.appendChild(document.createElement('div'))\n  main.className = 'deluxeexportmenu deluxemenu'\n  main.innerHTML = exportMenuHTML\n  const drophint = main.querySelector('.drophint')\n\n  window.setTimeout(function moveMenuIntoView () {\n    main.style.maxHeight = (document.documentElement.clientHeight - 40) + 'px'\n    main.style.maxWidth = (document.documentElement.clientWidth - 40) + 'px'\n    main.style.left = Math.max(20, 0.5 * (document.body.clientWidth - main.clientWidth)) + 'px'\n  }, 0)\n\n  GM.getValue('myalbums', '{}').then(function myalbumsLoaded (myalbumsStr) {\n    const myalbums = JSON.parse(myalbumsStr)\n    const listenedAlbums = []\n    for (const key in myalbums) {\n      if (myalbums[key].listened) {\n        listenedAlbums.push(myalbums[key])\n      }\n    }\n    main.querySelector('h2').appendChild(document.createTextNode(' (' + listenedAlbums.length + ' records)'))\n\n    let format = '%artist% - %title%'\n\n    const formatAlbum = function formatAlbumStr (format, myAlbum) {\n      const releaseDate = new Date(myAlbum.releaseDate)\n      const listenedDate = new Date(myAlbum.listened)\n      const fields = {\n        '%artist%': () => myAlbum.artist,\n        '%title%': () => myAlbum.title,\n        '%cover%': () => myAlbum.albumCover,\n        '%url%': () => myAlbum.url,\n        '%releaseDate%': () => releaseDate.toISOString(),\n        '%listenedDate%': () => listenedDate.toISOString(),\n        '%releaseUnix%': () => parseInt(releaseDate.getTime() / 1000),\n        '%listenedUnix%': () => parseInt(listenedDate.getTime() / 1000),\n        '%releaseTimestamp%': () => releaseDate.getTime(),\n        '%listenedTimestamp%': () => listenedDate.getTime(),\n        '%releaseY%': () => releaseDate.getFullYear().toString().substring(2),\n        '%releaseYYYY%': () => releaseDate.getFullYear(),\n        '%releaseM%': () => releaseDate.getMonth() + 1,\n        '%releaseMM%': () => padd(releaseDate.getMonth() + 1, 2, '0'),\n        '%releaseMon%': () => releaseDate.toLocaleString(undefined, { month: 'short' }),\n        '%releaseMonth%': () => releaseDate.toLocaleString(undefined, { month: 'long' }),\n        '%releaseD%': () => releaseDate.getDate(),\n        '%releaseDD%': () => padd(releaseDate.getDate(), 2, '0'),\n        '%releaseDay%': () => releaseDate.toLocaleString(undefined, { weekday: 'long' }),\n        '%listenedY%': () => listenedDate.getFullYear().toString().substring(2),\n        '%listenedYYYY%': () => listenedDate.getFullYear(),\n        '%listenedM%': () => listenedDate.getMonth() + 1,\n        '%listenedMM%': () => padd(listenedDate.getMonth() + 1, 2, '0'),\n        '%listenedMon%': () => listenedDate.toLocaleString(undefined, { month: 'short' }),\n        '%listenedMonth%': () => listenedDate.toLocaleString(undefined, { month: 'long' }),\n        '%listenedD%': () => listenedDate.getDate(),\n        '%listenedDD%': () => padd(listenedDate.getDate(), 2, '0'),\n        '%listenedDay%': () => listenedDate.toLocaleString(undefined, { weekday: 'long' }),\n        '%json%': () => JSON.stringify(myAlbum),\n        '%json5%': () => JSON5.stringify(myAlbum)\n      }\n\n      for (const field in fields) {\n        if (format.includes(field)) {\n          try {\n            format = format.replace(field, fields[field]())\n          } catch (e) {\n            console.log('Could not format replace \"' + field + '\": ' + e)\n          }\n        }\n      }\n      return format\n    }\n\n    const sortBy = function sortByCmp (sortKey) {\n      const cmps = {\n        playedAsc: function playedAsc (a, b) {\n          return -cmps.playedDesc(a, b)\n        },\n        playedDesc: function playedDesc (a, b) {\n          try {\n            return new Date(b.listened) - new Date(a.listened)\n          } catch (e) {\n            return 0\n          }\n        },\n        releasedAsc: function releasedAsc (a, b) {\n          return -cmps.releasedDesc(a, b)\n        },\n        releasedDesc: function releasedDesc (a, b) {\n          try {\n            return new Date(b.releaseDate) - new Date(a.releaseDate)\n          } catch (e) {\n            return 0\n          }\n        },\n        artist: function artist (a, b, fallbackToTitle) {\n          const d = a.artist.localeCompare(b.artist)\n          if (d === 0 && fallbackToTitle) {\n            return cmps.title(a, b, false)\n          } else {\n            return d\n          }\n        },\n        title: function title (a, b, fallbackToArtist) {\n          const d = a.title.localeCompare(b.title)\n          if (d === 0 && fallbackToArtist) {\n            return cmps.artist(a, b, false)\n          } else {\n            return d\n          }\n        }\n      }\n\n      listenedAlbums.sort(cmps[sortKey])\n    }\n\n    const generate = function generateStr () {\n      const textarea = document.getElementById('export_output')\n      window.setTimeout(function generateStrAnimation () {\n        textarea.classList.remove('animated')\n        textarea.style.boxShadow = '2px 2px 5px #00af'\n      }, 0)\n\n      let str\n      if (format === '%backup%') {\n        str = myalbumsStr\n      } else {\n        const sortSelect = document.getElementById('sort_select')\n        sortBy(sortSelect.options[sortSelect.selectedIndex].value)\n\n        str = []\n        for (let i = 0; i < listenedAlbums.length; i++) {\n          str.push(formatAlbum(format, listenedAlbums[i]))\n        }\n        str = str.join(navigator.platform.startsWith('Win') ? '\\r\\n' : '\\n')\n      }\n      window.setTimeout(function generateStrAnimationSuccess () {\n        textarea.value = str\n        textarea.classList.add('animated')\n        textarea.style.boxShadow = '2px 2px 5px #0a0f'\n      }, 50)\n\n      window.setTimeout(function generateStrResetAnimation () {\n        textarea.style.boxShadow = ''\n      }, 3000)\n      return str\n    }\n\n    const inputFormatOnChange = async function onInputFormatChange () {\n      const input = this\n      const formatExample = document.getElementById('format_example')\n      format = input.value\n\n      formatExample.value = listenedAlbums.length > 0 ? formatAlbum(format, listenedAlbums[0]) : ''\n      formatExample.style.boxShadow = '2px 2px 5px #0a0f'\n\n      window.setTimeout(function resetBoxShadow () {\n        formatExample.style.boxShadow = ''\n      }, 3000)\n    }\n\n    const importData = function importDate (data) {\n      GM.getValue('myalbums', '{}').then(function myalbumsLoaded (myalbumsStr) {\n        let myalbums = JSON.parse(myalbumsStr)\n        myalbums = Object.assign(myalbums, data)\n        return GM.setValue('myalbums', JSON.stringify(myalbums))\n      }).then(function myalbumsSaved () {\n        document.getElementById('exportmenu_close').click()\n        window.setTimeout(() => exportMenu(true), 50)\n      })\n    }\n    const handleFiles = async function handleFilesAsync (fileList) {\n      if (fileList.length === 0) {\n        console.log('fileList is empty')\n        return\n      }\n\n      let data\n      try {\n        data = await (new Response(fileList[0])).json()\n      } catch (e) {\n        window.alert('Could not load file:\\n' + e)\n        return\n      }\n\n      const n = Object.keys(data).length\n      if (window.confirm('Found ' + n + ' albums. Continue import and overwrite existing albums?')) {\n        importData(data)\n      }\n    }\n\n    const inputTable = main.appendChild(document.createElement('table'))\n    let tr\n    let td\n\n    tr = inputTable.appendChild(document.createElement('tr'))\n    td = tr.appendChild(document.createElement('td'))\n    const label = td.appendChild(document.createElement('label'))\n    label.setAttribute('for', 'export_format')\n    label.appendChild(document.createTextNode('Format:'))\n\n    td = tr.appendChild(document.createElement('td'))\n    const inputFormat = td.appendChild(document.createElement('input'))\n    inputFormat.type = 'text'\n    inputFormat.value = format\n    inputFormat.id = 'export_format'\n    inputFormat.style.width = '600px'\n    inputFormat.addEventListener('change', inputFormatOnChange)\n    inputFormat.addEventListener('keyup', inputFormatOnChange)\n\n    tr = inputTable.appendChild(document.createElement('tr'))\n\n    td = tr.appendChild(document.createElement('td'))\n    td.appendChild(document.createTextNode('Example:'))\n\n    td = tr.appendChild(document.createElement('td'))\n    const inputExample = td.appendChild(document.createElement('input'))\n    inputExample.type = 'text'\n    inputExample.value = listenedAlbums.length > 0 ? formatAlbum(format, listenedAlbums[0]) : ''\n    inputExample.readonly = true\n    inputExample.id = 'format_example'\n    inputExample.style.width = '600px'\n\n    td = tr.appendChild(document.createElement('td'))\n    td.appendChild(document.createTextNode('Sort by:'))\n\n    td = tr.appendChild(document.createElement('td'))\n    const sortSelect = td.appendChild(document.createElement('select'))\n    sortSelect.id = 'sort_select'\n    sortSelect.innerHTML = `\n      <option value=\"playedDesc\">Recent play first</option>\n      <option value=\"playedAsc\">Recent play last</option>\n      <option value=\"releasedDesc\">Recent release first</option>\n      <option value=\"releasedAsc\">Recent release last</option>\n      <option value=\"artist\">Artist A-Z</option>\n      <option value=\"title\">Title A-Z</option>\n    `\n\n    tr = inputTable.appendChild(document.createElement('tr'))\n    td = tr.appendChild(document.createElement('td'))\n    td.setAttribute('colspan', '2')\n    const generateButton = td.appendChild(document.createElement('button'))\n    generateButton.appendChild(document.createTextNode('Generate'))\n    generateButton.addEventListener('click', (ev) => generate())\n    const exportButton = td.appendChild(document.createElement('button'))\n    exportButton.appendChild(document.createTextNode('Export to file'))\n    exportButton.title = 'Download as a text file'\n    exportButton.addEventListener('click', function onExportFileButtonClick () {\n      const dateSuffix = (new Date()).toISOString().split('T')[0]\n      document.getElementById('export_download_link').download = 'bandcampPlayedAlbums_' + dateSuffix + '.txt'\n      document.getElementById('export_download_link').href = 'data:text/plain,' + encodeURIComponent(generate())\n      window.setTimeout(() => document.getElementById('export_download_link').click(), 50)\n    })\n    const backupButton = td.appendChild(document.createElement('button'))\n    backupButton.title = 'Backup to JSON file. Can be restored on another browser'\n    backupButton.appendChild(document.createTextNode('Backup'))\n    backupButton.addEventListener('click', function onBackupButtonClick () {\n      format = '%backup%'\n      document.getElementById('export_format').value = format\n      document.getElementById('format_example').value = 'JSON dictionary'\n      const dateSuffix = (new Date()).toISOString().split('T')[0]\n      document.getElementById('export_download_link').download = 'bandcampPlayedAlbums_' + dateSuffix + '.json'\n      document.getElementById('export_download_link').href = 'data:application/json,' + encodeURIComponent(generate())\n      document.getElementById('export_clear_button').style.display = ''\n      GM.setValue('myalbums_lastbackup', Object.keys(myalbums).length + '#####' + (new Date()).toJSON())\n      window.setTimeout(() => document.getElementById('export_download_link').click(), 50)\n    })\n    const restoreButton = td.appendChild(document.createElement('button'))\n    restoreButton.title = 'Restore from JSON file backup'\n    restoreButton.appendChild(document.createTextNode('Restore'))\n    restoreButton.addEventListener('click', function onBackupButtonClick () {\n      inputFile.click()\n    })\n\n    const clearButton = td.appendChild(document.createElement('button'))\n    clearButton.appendChild(document.createTextNode('Clear played albums'))\n    clearButton.id = 'export_clear_button'\n    if (showClearButton !== true) {\n      clearButton.style.display = 'none'\n    }\n    clearButton.addEventListener('click', function onClearButtonClick () {\n      if (window.confirm('Remove all played albums?\\n\\nThis cannot be undone.')) {\n        if (window.confirm('Are you sure? Delete all played albums?')) {\n          GM.setValue('myalbums', '{}').then(function myalbumsSaved () {\n            document.getElementById('exportmenu_close').click()\n            window.setTimeout(exportMenu, 50)\n          })\n        }\n      }\n    })\n\n    const downloadA = td.appendChild(document.createElement('a'))\n    downloadA.id = 'export_download_link'\n    downloadA.href = '#'\n    downloadA.download = 'bandcamp_played_albums.txt'\n    downloadA.target = '_blank'\n\n    const inputFile = td.appendChild(document.createElement('input'))\n    inputFile.type = 'file'\n    inputFile.id = 'input_file'\n    inputFile.accept = '.txt,plain/text,.json,application/json'\n    inputFile.style.display = 'none'\n    inputFile.addEventListener('change', function onFileChanged (ev) {\n      handleFiles(this.files)\n    }, false)\n    main.addEventListener('dragenter', function dragenter (ev) {\n      ev.stopPropagation()\n      ev.preventDefault()\n      main.style.backgroundColor = '#c6daf9'\n      drophint.style.left = (main.clientWidth / 2 - drophint.clientWidth / 2) + 'px'\n      drophint.style.display = 'block'\n    }, false)\n    main.addEventListener('dragleave', function dragleave (ev) {\n      main.style.backgroundColor = 'white'\n      drophint.style.display = 'none'\n    }, false)\n    main.addEventListener('dragover', function dragover (ev) {\n      ev.stopPropagation()\n      ev.preventDefault()\n      main.style.backgroundColor = '#c6daf9'\n      drophint.style.display = 'block'\n    }, false)\n    main.addEventListener('drop', function drop (ev) {\n      ev.stopPropagation()\n      ev.preventDefault()\n      main.style.backgroundColor = 'white'\n      drophint.style.display = 'none'\n      handleFiles(ev.dataTransfer.files)\n    }, false)\n\n    tr = inputTable.appendChild(document.createElement('tr'))\n    td = tr.appendChild(document.createElement('td'))\n    td.setAttribute('colspan', '3')\n    const textarea = td.appendChild(document.createElement('textarea'))\n    textarea.id = 'export_output'\n    textarea.style.width = Math.max(500, main.clientWidth - 50) + 'px'\n\n    // Bottom buttons\n    main.appendChild(document.createElement('br'))\n    main.appendChild(document.createElement('br'))\n    const buttons = main.appendChild(document.createElement('div'))\n\n    const closeButton = buttons.appendChild(document.createElement('button'))\n    closeButton.appendChild(document.createTextNode('Close'))\n    closeButton.id = 'exportmenu_close'\n    closeButton.style.color = 'black'\n    closeButton.addEventListener('click', function onCloseButtonClick () {\n      document.querySelector('.deluxeexportmenu').remove()\n      // Un-blur background\n      if (document.getElementById('centerWrapper')) {\n        document.getElementById('centerWrapper').style.filter = ''\n      }\n    })\n  })\n  window.setTimeout(function moveMenuIntoView () {\n    main.style.maxHeight = (document.documentElement.clientHeight - 40) + 'px'\n    main.style.maxWidth = (document.documentElement.clientWidth - 40) + 'px'\n    main.style.left = Math.max(20, 0.5 * (document.body.clientWidth - main.clientWidth)) + 'px'\n  }, 0)\n}\n\nfunction checkBackupStatus () {\n  GM.getValue('myalbums_lastbackup', '').then(function myalbumsLastBackupLoaded (value) {\n    if (!value || !value.includes('#####')) {\n      // Set current date (install date) as initial value\n      GM.setValue('myalbums_lastbackup', '0#####' + (new Date()).toJSON())\n      return\n    }\n    const parts = value.split('#####')\n    const n0 = parseInt(parts[0])\n    const lastBackup = new Date(parts[1])\n    if ((new Date()) - lastBackup > BACKUP_REMINDER_DAYS * 86400000) {\n      GM.getValue('myalbums', '{}').then(function myalbumsLoaded (str) {\n        const n1 = Object.keys(JSON.parse(str)).length\n        if (Math.abs(n0 - n1) > 10) {\n          showBackupHint(lastBackup, Math.abs(n0 - n1))\n        }\n      })\n    }\n  })\n}\n\nfunction showBackupHint (lastBackup, changedRecords) {\n  const since = timeSince(lastBackup)\n\n  addStyle(`\n    .backupreminder {\n      position:fixed;\n      height:auto;\n      overflow:auto;\n      top:110%;\n      left:40%;\n      z-index:200;\n      padding:5px;\n      transition: top 1s;\n      border:2px solid black;\n      border-radius:10px;\n      color:black;\n      background:white;\n    }\n  `)\n\n  // Blur background\n  if (document.getElementById('centerWrapper')) { document.getElementById('centerWrapper').style.filter = 'blur(4px)' }\n\n  const main = document.body.appendChild(document.createElement('div'))\n  main.className = 'backupreminder'\n  main.innerHTML = `<h2>${SCRIPT_NAME}</h2>\n  <h1>Backup reminder</h1>\n  <p>\n    Your last backup was ${since} ago. Since then, you played ${changedRecords} albums.\n  </p>\n  `\n\n  main.appendChild(document.createElement('br'))\n  const buttons = main.appendChild(document.createElement('div'))\n\n  const closeButton = buttons.appendChild(document.createElement('button'))\n  closeButton.appendChild(document.createTextNode('Close'))\n  closeButton.id = 'backupreminder_close'\n  closeButton.style.color = 'black'\n  closeButton.addEventListener('click', function onCloseButtonClick () {\n    document.querySelector('.backupreminder').remove()\n    // Un-blur background\n    if (document.getElementById('centerWrapper')) {\n      document.getElementById('centerWrapper').style.filter = ''\n    }\n  })\n\n  buttons.appendChild(document.createTextNode(' '))\n\n  const backupButton = buttons.appendChild(document.createElement('button'))\n  backupButton.appendChild(document.createTextNode('Start backup'))\n  backupButton.style.color = '#0687f5'\n  backupButton.addEventListener('click', function backupButtonClick () {\n    document.getElementById('backupreminder_close').click()\n    mainMenu(true)\n  })\n\n  buttons.appendChild(document.createTextNode(' '))\n\n  const ignoreButton = buttons.appendChild(document.createElement('button'))\n  ignoreButton.appendChild(document.createTextNode('Disable reminder'))\n  ignoreButton.style.color = 'black'\n  ignoreButton.addEventListener('click', async function ignoreButtonClick () {\n    getEnabledFeatures(await GM.getValue('enabledFeatures', false))\n    if (allFeatures.backupReminder.enabled) {\n      allFeatures.backupReminder.enabled = false\n    }\n    await GM.setValue('enabledFeatures', JSON.stringify(allFeatures))\n    document.getElementById('backupreminder_close').click()\n  })\n\n  window.setTimeout(function moveMenuIntoView () {\n    main.style.maxHeight = (document.documentElement.clientHeight - 40) + 'px'\n    main.style.maxWidth = (document.documentElement.clientWidth - 40) + 'px'\n    main.style.left = Math.max(20, 0.5 * (document.documentElement.clientWidth - main.clientWidth)) + 'px'\n    main.style.top = Math.max(20, 0.3 * document.documentElement.clientHeight) + 'px'\n  }, 0)\n}\n\nfunction downloadMp3FromLink (ev, a, addSpinner, removeSpinner, noGM) {\n  const url = a.href\n  if (GM.download && !noGM) {\n    // Use Tampermonkey GM.download function\n    console.log('Using GM.download function')\n    ev.preventDefault()\n    addSpinner(a)\n    let GMdownloadStatus = 0\n    GM.download({\n      url: url,\n      name: a.download || 'default.mp3',\n      onerror: function downloadMp3FromLinkOnError (e) {\n        console.log('GM.download onerror:', e)\n      },\n      ontimeout: function downloadMp3FromLinkOnTimeout () {\n        window.alert('Could not download via GM.download. Time out.')\n        document.location.href = url\n      },\n      onload: function downloadMp3FromLinkOnLoad () {\n        console.log('Successfully downloaded via GM.download')\n        GMdownloadStatus = 1\n        window.setTimeout(() => removeSpinner(a), 500)\n      }\n    }).then(function (o) {\n      console.log('GM.download() finished')\n      GMdownloadStatus = 1\n      window.setTimeout(() => removeSpinner(a), 500)\n    }).catch(function (e) {\n      GMdownloadStatus = 0\n      console.log('GM.download() failed', e)\n      window.setTimeout(function () {\n        if (GMdownloadStatus !== 1) {\n          if (url.startsWith('data')) {\n            console.log('GM.download failed with data url')\n            document.location.href = url\n          } else {\n            console.log('Trying again with GM.download disabled')\n            downloadMp3FromLink(ev, a, addSpinner, removeSpinner, true)\n          }\n        }\n      }, 1000)\n    })\n    return\n  }\n\n  if (!url.startsWith('http') || navigator.userAgent.indexOf('Chrome') !== -1) {\n    // Just open the link normally (no prevent default)\n    addSpinner(a)\n    window.setTimeout(() => removeSpinner(a), 1000)\n    return\n  }\n\n  // Use GM.xmlHttpRequest to download and offer data uri\n  ev.preventDefault()\n  console.log('Using GM.xmlHttpRequest to download and then offer data uri')\n  addSpinner(a)\n  GM.xmlHttpRequest({\n    method: 'GET',\n    overrideMimeType: 'text/plain; charset=x-user-defined',\n    url: url,\n    onload: function onMp3Load (response) {\n      console.log('Successfully received data via GM.xmlHttpRequest, starting download')\n      a.href = 'data:audio/mpeg;base64,' + base64encode(response.responseText)\n      window.setTimeout(() => a.click(), 10)\n    },\n    onerror: function onMp3LoadError (response) {\n      window.alert('Could not download via GM.xmlHttpRequest')\n      document.location.href = url\n    }\n  })\n}\n\nfunction addDownloadLinksToAlbumPage () {\n  addStyle(`\n  .download-col .downloaddisk:hover {\n    text-decoration:none\n  }\n  /* From http://www.designcouch.com/home/why/2013/05/23/dead-simple-pure-css-loading-spinner/ */\n  .downspinner {\n    height:16px;\n    width:16px;\n    margin:0px auto;\n    position:relative;\n    display:inline-block;\n    animation: spinnerrotation 3s infinite linear;\n    cursor:wait;\n  }\n  @keyframes spinnerrotation {\n    from {transform: rotate(0deg)}\n    to {transform: rotate(359deg)}\n  }`)\n\n  const addSpiner = function downloadLinksOnAlbumPageAddSpinner (el) {\n    el.style = ''\n    el.classList.add('downspinner')\n  }\n\n  const removeSpinner = function downloadLinksOnAlbumPageRemoveSpinner (el) {\n    el.classList.remove('downspinner')\n    el.style = 'background:#1cea1c; border-radius:5px; padding:1px; opacity:0.5'\n  }\n\n  const TralbumData = unsafeWindow.TralbumData\n  if (TralbumData && TralbumData.hasAudio && !TralbumData.freeDownloadPage && TralbumData.trackinfo) {\n    const hoverdiv = document.querySelectorAll('.download-col div')\n    if (hoverdiv.length > 0) {\n      // Album page\n      for (let i = 0; i < TralbumData.trackinfo.length; i++) {\n        if (!NOEMOJI && hoverdiv[i].querySelector('a[href*=\"?action=download\"]')) {\n          // Replace buy link with shopping cart emoji\n          hoverdiv[i].querySelector('a[href*=\"?action=download\"]').innerHTML = '&#x1f6d2;'\n          hoverdiv[i].querySelector('a[href*=\"?action=download\"]').title = 'buy track'\n        }\n        // Add download link\n        const t = TralbumData.trackinfo[i]\n        if (!t.file) {\n          continue\n        }\n        const prop = Object.keys(t.file)[0] // Just use the first file entry\n        const mp3 = t.file[prop].replace(/^\\/\\//, 'http://')\n        const a = document.createElement('a')\n        a.className = 'downloaddisk'\n        a.href = mp3\n        a.download = (t.track_num == null ? '' : ((t.track_num > 9 ? '' : '0') + t.track_num + '. ')) + fixFilename(TralbumData.artist + ' - ' + t.title) + '.mp3'\n        a.title = 'Download ' + prop\n        a.appendChild(document.createTextNode(NOEMOJI ? '\\u2193' : '\\uD83D\\uDCBE'))\n        a.addEventListener('click', function onDownloadLinkClick (ev) {\n          downloadMp3FromLink(ev, this, addSpiner, removeSpinner)\n        })\n        hoverdiv[i].appendChild(a)\n      }\n    } else if (document.querySelector('#trackInfo .download-link')) {\n      // Single track page\n      const t = TralbumData.trackinfo[0]\n      if (!t.file) {\n        return\n      }\n      const prop = Object.keys(t.file)[0]\n      const mp3 = t.file[prop].replace(/^\\/\\//, 'http://')\n      const a = document.createElement('a')\n      a.className = 'downloaddisk'\n      a.href = mp3\n      a.download = (t.track_num == null ? '' : ((t.track_num > 9 ? '' : '0') + t.track_num + '. ')) + fixFilename(TralbumData.artist + ' - ' + t.title) + '.mp3'\n      a.title = 'Download ' + prop\n      a.appendChild(document.createTextNode(NOEMOJI ? '\\u2193' : '\\uD83D\\uDCBE'))\n      a.addEventListener('click', function onDownloadLinkClick (ev) {\n        downloadMp3FromLink(ev, this, addSpiner, removeSpinner)\n      })\n      document.querySelector('#trackInfo .download-link').parentNode.appendChild(a)\n    }\n  }\n}\n\nfunction addLyricsToAlbumPage () {\n  // Load lyrics from html into TralbumData\n  const TralbumData = unsafeWindow.TralbumData\n  function findInTralbumData (url) {\n    for (let i = 0; i < TralbumData.trackinfo.length; i++) {\n      const t = TralbumData.trackinfo[i]\n      if (url.endsWith(t.title_link)) {\n        return t\n      }\n    }\n    return null\n  }\n  const tracks = Array.from(document.querySelectorAll('#track_table .track_row_view .title a')).map(a => findInTralbumData(a.href))\n  document.querySelectorAll('#track_table .track_row_view .title a').forEach(function (a) {\n    const tr = parentQuery(a, 'tr[rel]')\n    const trackNum = tr.getAttribute('rel').split('tracknum=')[1]\n    const lyricsRow = document.querySelector('#track_table tr#lyrics_row_' + trackNum)\n    const lyricsLink = tr.querySelector('.geniuslink')\n    if (tr.querySelector('.info_link').innerHTML.indexOf('lyrics') === -1) {\n      // Hide info link if there are no lyrics\n      tr.querySelector('.info_link a[href*=\"/track/\"]').innerHTML = ''\n    }\n    if (lyricsRow) {\n      const trackNum = parseInt(lyricsRow.id.split('lyrics_row_')[1])\n      for (let i = 0; i < tracks.length; i++) {\n        if (trackNum === tracks[i].track_num) {\n          tracks[i].lyrics = lyricsRow.querySelector('div').textContent\n        }\n      }\n    } else if (!lyricsLink) {\n      // Add genius link\n      const lyricsLink = tr.querySelector('.info_link').appendChild(document.createElement('a'))\n      lyricsLink.dataset.trackNum = trackNum\n      lyricsLink.title = 'load lyrics from genius.com'\n      lyricsLink.href = '#geniuslyrics-' + trackNum\n      lyricsLink.classList.add('geniuslink')\n      lyricsLink.appendChild(document.createTextNode('G'))\n      lyricsLink.style = 'color: black;background: rgb(255, 255, 100);border-radius: 50%;padding: 0px 3px;border: 1px solid black'\n      lyricsLink.addEventListener('click', function () {\n        loadGeniusLyrics(parseInt(this.dataset.trackNum))\n      })\n    }\n  })\n}\n\nlet genius = null\nlet geniusContainerTr = null\nlet geniusTrackNum = -1\nlet geniusArtistsArr = []\nlet geniusTitle = ''\nfunction geniusGetCleanLyricsContainer () {\n  geniusContainerTr.innerHTML = `\n                    <td colspan=\"5\">\n                      <div></div>\n                    </td>\n`\n\n  return geniusContainerTr.querySelector('div')\n}\nfunction geniusAddLyrics (force, beLessSpecific) {\n  genius.f.loadLyrics(force, beLessSpecific, geniusTitle, geniusArtistsArr, true)\n}\nfunction geniusHideLyrics () {\n  document.querySelectorAll('.loadingspinner').forEach((spinner) => spinner.remove())\n  document.querySelectorAll('#track_table tr.showlyrics').forEach(e => e.classList.remove('showlyrics'))\n}\nfunction geniusSetFrameDimensions (container, iframe) {\n  const width = iframe.style.width = '500px'\n  const height = iframe.style.height = '650px'\n\n  if (genius.option.themeKey === 'spotify') {\n    iframe.style.backgroundColor = 'black'\n  } else {\n    iframe.style.backgroundColor = ''\n  }\n\n  return [width, height]\n}\nfunction geniusAddCss () {\n  addStyle(geniusCSS)\n  addStyle(`\n  #myconfigwin39457845 {\n    background-color:${darkModeModeCurrent === true ? '#a2a2a2' : 'white'} !important;\n    color:${darkModeModeCurrent === true ? 'white' : 'black'} !important;\n  }\n  #myconfigwin39457845 div {\n    background-color:${darkModeModeCurrent === true ? '#3E3E3E' : '#EFEFEF'} !important\n  }\n  .lyricsnavbar {\n    background:${darkModeModeCurrent === true ? '#7d7c7c' : '#fafafa'} !important;\n  }\n  `)\n}\nfunction geniusCreateSpinner (spinnerHolder) {\n  geniusContainerTr.querySelector('div').insertBefore(spinnerHolder, geniusContainerTr.querySelector('div').firstChild)\n\n  const spinner = spinnerHolder.appendChild(document.createElement('div'))\n  spinner.classList.add('loadingspinner')\n\n  return spinner\n}\n\nfunction geniusShowSearchField (query) {\n  const b = geniusGetCleanLyricsContainer()\n\n  b.style.border = '1px solid black'\n  b.style.borderRadius = '3px'\n  b.style.padding = '5px'\n\n  b.appendChild(document.createTextNode('Search genius.com: '))\n  b.style.paddingRight = '15px'\n  const input = b.appendChild(document.createElement('input'))\n  input.className = 'SearchInputBox__input'\n  input.placeholder = 'Search genius.com...'\n  input.style = 'width: 300px;background-color: #F3F3F3;padding: 10px 30px 10px 10px;font-size: 14px; border: none;color: #333;margin: 6px 0;height: 17px;border-radius: 3px;'\n\n  const span = b.appendChild(document.createElement('span'))\n  span.style = 'cursor:pointer; margin-left: -25px;'\n  span.appendChild(document.createTextNode(' \\uD83D\\uDD0D'))\n\n  if (query) {\n    input.value = query\n  } else if (genius.current.artists) {\n    input.value = genius.current.artists\n  }\n  input.addEventListener('change', function onSearchLyricsButtonClick () {\n    if (input.value) {\n      genius.f.searchByQuery(input.value, b)\n    }\n  })\n  input.addEventListener('keyup', function onSearchLyricsKeyUp (ev) {\n    if (ev.keyCode === 13) {\n      ev.preventDefault()\n      if (input.value) {\n        genius.f.searchByQuery(input.value, b)\n      }\n    }\n  })\n  span.addEventListener('click', function onSearchLyricsKeyUp (ev) {\n    if (input.value) {\n      genius.f.searchByQuery(input.value, b)\n    }\n  })\n\n  input.focus()\n}\nfunction geniusListSongs (hits, container, query) {\n  if (!container) {\n    container = geniusGetCleanLyricsContainer()\n  }\n\n  // Back to search button\n  const backToSearchButton = document.createElement('a')\n  backToSearchButton.href = '#'\n  backToSearchButton.appendChild(document.createTextNode('Back to search'))\n  backToSearchButton.addEventListener('click', function backToSearchButtonClick (ev) {\n    ev.preventDefault()\n    if (query) {\n      geniusShowSearchField(query)\n    } else if (genius.current.artists) {\n      geniusShowSearchField(genius.current.artists + ' ' + genius.current.title)\n    } else {\n      geniusShowSearchField()\n    }\n  })\n\n  const separator = document.createElement('span')\n  separator.setAttribute('class', 'second-line-separator')\n  separator.setAttribute('style', 'padding:0px 3px')\n  separator.appendChild(document.createTextNode('•'))\n\n  // Hide button\n  const hideButton = document.createElement('a')\n  hideButton.href = '#'\n  hideButton.appendChild(document.createTextNode('Hide'))\n  hideButton.addEventListener('click', function hideButtonClick (ev) {\n    ev.preventDefault()\n    geniusHideLyrics()\n  })\n\n  // List search results\n  const trackhtml = '<div style=\"float:left;\"><div class=\"onhover\" style=\"margin-top:-0.25em;display:none\"><span style=\"color:black;font-size:2.0em\">🅖</span></div><div class=\"onout\"><span style=\"font-size:1.5em\">📄</span></div></div>' +\n  '<div style=\"float:left; margin-left:5px\">$artist • $title <br><span style=\"font-size:0.7em\">👁 $stats.pageviews $lyrics_state</span></div><div style=\"clear:left;\"></div>'\n  container.innerHTML = '<ol class=\"tracklist\" style=\"font-size:1.15em\"></ol>'\n\n  container.classList.add('searchresultlist')\n  if (darkModeModeCurrent === true) {\n    container.style.backgroundColor = '#262626'\n    container.style.position = 'relative'\n  }\n\n  container.insertBefore(hideButton, container.firstChild)\n  container.insertBefore(separator, container.firstChild)\n  container.insertBefore(backToSearchButton, container.firstChild)\n\n  const ol = container.querySelector('ol')\n  const searchresultsLengths = hits.length\n  const title = genius.current.title\n  const artists = genius.current.artists\n  const onclick = function onclick () {\n    genius.f.rememberLyricsSelection(title, artists, this.dataset.hit)\n    genius.f.showLyrics(JSON.parse(this.dataset.hit), searchresultsLengths)\n  }\n  const mouseover = function onmouseover () {\n    this.querySelector('.onhover').style.display = 'block'\n    this.querySelector('.onout').style.display = 'none'\n    this.style.backgroundColor = darkModeModeCurrent === true ? 'rgb(70, 70, 70)' : 'rgb(200, 200, 200)'\n  }\n  const mouseout = function onmouseout () {\n    this.querySelector('.onhover').style.display = 'none'\n    this.querySelector('.onout').style.display = 'block'\n    this.style.backgroundColor = darkModeModeCurrent === true ? '#262626' : 'rgb(255, 255, 255)'\n  }\n\n  hits.forEach(function forEachHit (hit) {\n    const li = document.createElement('li')\n    if (darkModeModeCurrent === true) {\n      li.style.backgroundColor = '#262626'\n    }\n    li.style.cursor = 'pointer'\n    li.style.transition = 'background-color 0.2s'\n    li.style.padding = '3px'\n    li.style.margin = '2px'\n    li.style.borderRadius = '3px'\n    li.innerHTML = trackhtml.replace(/\\$title/g, hit.result.title_with_featured).replace(/\\$artist/g, hit.result.primary_artist.name).replace(/\\$lyrics_state/g, hit.result.lyrics_state).replace(/\\$stats\\.pageviews/g, genius.f.metricPrefix(hit.result.stats.pageviews, 1))\n    li.dataset.hit = JSON.stringify(hit)\n\n    li.addEventListener('click', onclick)\n    li.addEventListener('mouseover', mouseover)\n    li.addEventListener('mouseout', mouseout)\n    ol.appendChild(li)\n  })\n}\nfunction geniusOnLyricsReady (song, container) {\n  container.parentNode.parentNode.dataset.loaded = 'loaded'\n}\nfunction geniusOnNoResults (songTitle, songArtistsArr) {\n  geniusContainerTr.dataset.loaded = 'loaded'\n  document.querySelectorAll('#track_table tr.showlyrics').forEach(e => e.classList.remove('showlyrics'))\n  document.querySelector(`#track_table tr[rel=\"tracknum=${geniusTrackNum}\"]`).classList.add('showlyrics')\n  geniusShowSearchField(songArtistsArr.join(' ') + ' ' + songTitle)\n}\nfunction initGenius () {\n  if (!genius) {\n    genius = geniusLyrics({\n      GM: {\n        xmlHttpRequest: GM.xmlHttpRequest,\n        getValue: (name, defaultValue) => GM.getValue('genius_' + name, defaultValue),\n        setValue: (name, value) => GM.setValue('genius_' + name, value)\n      },\n      scriptName: SCRIPT_NAME,\n      scriptIssuesURL: 'https://github.com/cvzi/Bandcamp-script-deluxe-edition/issues',\n      scriptIssuesTitle: 'Report problem: github.com/cvzi/Bandcamp-script-deluxe-edition/issues',\n      domain: document.location.origin + '/',\n      emptyURL: document.location.origin + LYRICS_EMPTY_PATH,\n      addCss: geniusAddCss,\n      listSongs: geniusListSongs,\n      showSearchField: geniusShowSearchField,\n      addLyrics: geniusAddLyrics,\n      hideLyrics: geniusHideLyrics,\n      getCleanLyricsContainer: geniusGetCleanLyricsContainer,\n      setFrameDimensions: geniusSetFrameDimensions,\n      createSpinner: geniusCreateSpinner,\n      onLyricsReady: geniusOnLyricsReady,\n      onNoResults: geniusOnNoResults\n    })\n  }\n}\n\nfunction loadGeniusLyrics (trackNum) {\n  // Toggle lyrics\n  geniusContainerTr = document.getElementById('lyrics_row_' + trackNum)\n  let tr\n  if (geniusContainerTr) {\n    tr = document.querySelector(`#track_table tr[rel=\"tracknum=${trackNum}\"]`)\n    if ('loaded' in geniusContainerTr.dataset && geniusContainerTr.dataset.loaded === 'loaded') {\n      if (tr.classList.contains('showlyrics')) {\n        // Hide lyrics if already loaded\n        document.querySelectorAll('#track_table tr.showlyrics').forEach(e => e.classList.remove('showlyrics'))\n      } else {\n        // Show lyrics again\n        document.querySelectorAll('#track_table tr.showlyrics').forEach(e => e.classList.remove('showlyrics'))\n        tr.classList.add('showlyrics')\n      }\n      return\n    } else if (geniusTrackNum === trackNum) {\n      // Lyrics currently loading\n      console.log('loadGeniusLyrics already loading trackNum=' + trackNum)\n      return\n    }\n  }\n\n  geniusTrackNum = trackNum\n  if (!geniusContainerTr) {\n    geniusContainerTr = document.createElement('tr')\n    geniusContainerTr.className = 'lyricsRow'\n    geniusContainerTr.setAttribute('id', 'lyrics_row_' + trackNum)\n    tr = document.querySelector(`#track_table tr[rel=\"tracknum=${trackNum}\"]`)\n    if (tr.nextElementSibling) {\n      tr.parentNode.insertBefore(geniusContainerTr, tr.nextElementSibling)\n    } else {\n      tr.parentNode.appendChild(geniusContainerTr)\n    }\n    document.querySelectorAll('#track_table tr.showlyrics').forEach(e => e.classList.remove('showlyrics'))\n    tr.classList.add('showlyrics')\n\n    const spinnerHolder = geniusContainerTr.appendChild(document.createElement('div'))\n    spinnerHolder.classList.add('loadingspinnerholder')\n    const spinner = spinnerHolder.appendChild(document.createElement('div'))\n    spinner.classList.add('loadingspinner')\n  }\n\n  initGenius()\n\n  const track = unsafeWindow.TralbumData.trackinfo.find((t) => t.track_num === trackNum)\n  geniusTitle = track.title\n  geniusArtistsArr = unsafeWindow.TralbumData.artist.split(/&|,|ft\\.?|feat\\.?/).map(s => s.trim())\n\n  geniusAddLyrics()\n}\n\nfunction openExplorer () {\n  let iframe = document.getElementById('explorer-iframe')\n  if (iframe && iframe.style.display === 'block') {\n    closeExplorer()\n    return\n  }\n  if (!iframe) {\n    iframe = document.body.appendChild(document.createElement('iframe'))\n    iframe.src = PLAYER_URL + ',iframe'\n    iframe.id = 'explorer-iframe'\n  }\n  iframe.style = 'display:block; position:fixed; top:2%; left:25%; width:50%; height:90%; z-index: 1101; background:#fffD;'\n  return iframe\n}\n\nfunction closeExplorer () {\n  if (document.getElementById('explorer-iframe')) {\n    document.getElementById('explorer-iframe').style.display = 'none'\n  }\n}\n\nlet explorer = null\nasync function showExplorer () {\n  if (explorer) {\n    explorer.style.display = 'block'\n    return explorer\n  }\n  document.title = 'Explorer'\n  document.body.innerHTML = ''\n  explorer = document.body.appendChild(document.createElement('div'))\n  explorer.setAttribute('id', 'expRoot')\n  addStyle(`\n#expRoot {\n  background:white;\n  color:black\n}\n#expRoot .albumListItem{\n  cursor:pointer;\n  background:#ddd;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n}\n#expRoot .albumListItemOdd{\n  background:#eee\n}\n#expRoot .albumListItem:hover{\n  background:greenyellow\n}\n\n  `)\n\n  new Explorer(document.getElementById('expRoot'), {\n    playAlbumFromUrl: playAlbumFromUrl\n  }).render()\n}\n\nfunction appendMainMenuButtonTo (ul) {\n  const li = ul.insertBefore(document.createElement('li'), ul.firstChild)\n  li.className = 'menubar-item hoverable'\n  li.title = 'userscript settings - ' + SCRIPT_NAME\n  const a = li.appendChild(document.createElement('a'))\n  a.className = 'settingssymbol'\n  a.style.fontSize = '24px'\n  a.style.transition = 'transform 2s ease-out'\n  if (NOEMOJI) {\n    const img = a.appendChild(document.createElement('img'))\n    img.style = 'display:inline; width:34px; vertical-align:middle;'\n    img.src = 'https://raw.githubusercontent.com/hfg-gmuend/openmoji/master/color/72x72/2699.png'\n  } else {\n    a.appendChild(document.createTextNode('\\u2699\\uFE0F'))\n  }\n  a.addEventListener('mouseover', function () {\n    this.style.transform = 'rotate(360deg)'\n  })\n  li.addEventListener('click', () => mainMenu())\n\n  if (allFeatures.keepLibrary.enabled) {\n    const liExplorer = ul.insertBefore(document.createElement('li'), ul.firstChild)\n    liExplorer.className = 'menubar-item hoverable'\n    liExplorer.title = 'library - ' + SCRIPT_NAME\n    const aExplorer = liExplorer.appendChild(document.createElement('a'))\n    aExplorer.className = 'settingssymbol'\n    aExplorer.href = PLAYER_URL\n    aExplorer.style.fontSize = '24px'\n    if (NOEMOJI) {\n      const img = aExplorer.appendChild(document.createElement('img'))\n      img.style = 'display:inline; width:34px; vertical-align:middle;'\n      img.src = 'https://raw.githubusercontent.com/hfg-gmuend/openmoji/master/color/72x72/1F5C3.png'\n    } else {\n      aExplorer.appendChild(document.createTextNode('\\uD83D\\uDDC3\\uFE0F'))\n    }\n    aExplorer.target = '_blank'\n    // TODO open library in frame\n    // liExplorer.addEventListener('click', function (ev) {\n    // ev.preventDefault()\n    //   openExplorer()\n    // })\n  }\n\n  const liSearch = ul.insertBefore(document.createElement('li'), ul.firstChild)\n  liSearch.className = 'menubar-item hoverable menubar-item-tag-search'\n  liSearch.title = 'tag search - ' + SCRIPT_NAME\n  const aExplorer = liSearch.appendChild(document.createElement('a'))\n  aExplorer.className = 'settingssymbol'\n  aExplorer.href = '#'\n  aExplorer.style.fontSize = '24px'\n  if (NOEMOJI) {\n    aExplorer.innerHTML = `\n    <svg width=\"22\" height=\"22\" viewBox=\"0 0 15 16\" class=\"svg-icon\" style=\"border: 2px solid #000000c4;border-radius: 30%;padding: 3px;\">\n        <use xlink:href=\"#menubar-search-input-icon\">\n    </svg>`\n  } else {\n    aExplorer.appendChild(document.createTextNode('\\uD83D\\uDD0D'))\n  }\n  aExplorer.setAttribute('id', 'bcsde_tagsearchbutton')\n  aExplorer.addEventListener('click', showTagSearchForm)\n}\n\nfunction appendMainMenuButtonLeftTo (leftOf) {\n  const rect = leftOf.getBoundingClientRect()\n  const ul = document.createElement('ul')\n  ul.className = 'bcsde_settingsbar'\n  appendMainMenuButtonTo(document.body.appendChild(ul))\n  addStyle(`\n  .bcsde_settingsbar {position:absolute; top:-15px; left:${rect.right}px; list-style-type: none; padding:0; margin:0; opacity:0.6; transition:top 300ms}\n  .bcsde_settingsbar:hover {top:${rect.top}px}\n  .bcsde_settingsbar a:hover {text-decoration:none}\n  .bcsde_settingsbar li {float:left; padding:0; margin:0}`)\n  window.addEventListener('resize', function () {\n    ul.style.left = leftOf.getBoundingClientRect().right + 'px'\n  })\n}\n\nfunction humour () {\n  if (document.getElementById('salesfeed')) {\n    const salesfeedHumour = {}\n    salesfeedHumour.all = [\n      `${SCRIPT_NAME} by cuzi, Dark theme by Simonus`,\n      `Provide feedback for ${SCRIPT_NAME} on openuser.js or github.com`,\n      `${SCRIPT_NAME} - “nobody pays for software anymore” 🙌🏽`\n    ]\n    salesfeedHumour.chosen = salesfeedHumour.all[0]\n    unsafeWindow.$('#pagedata').data('blob').salesfeed_humour = salesfeedHumour\n  }\n}\n\nfunction darkMode () {\n  // CSS taken from https://userstyles.org/styles/171538/bandcamp-in-dark by Simonus (Version from January 24, 2020)\n  // https://userstyles.org/api/v1/styles/css/171538\n\n  let propOpenWrapperBackgroundColor = '#2626268f'\n  try {\n    const brightnessStr = window.localStorage.getItem('bcsde_bgimage_brightness')\n    if (brightnessStr !== null && brightnessStr !== 'null') {\n      const brightness = parseFloat(brightnessStr)\n      const alpha = (brightness - 50) / 255\n      propOpenWrapperBackgroundColor = `rgba(0, 0, 0, ${alpha})`\n    }\n  } catch (e) {\n    console.log('Could not access window.localStorage: ' + e)\n  }\n\n  addStyle(`\n:root {\n  --pgBdColor: #262626;\n  --propOpenWrapperBackgroundColor: ${propOpenWrapperBackgroundColor}\n}`)\n  addStyle(darkmodeCSS)\n\n  window.setTimeout(humour, 3000)\n  darkModeInjected = true\n}\n\nasync function darkModeOnLoad () {\n  const yes = await darkModeMode()\n  if (!yes) {\n    return\n  }\n\n  // Load body's background image and detect if it is light or dark and adapt it's transparency\n  const backgroudImageCSS = window.getComputedStyle(document.body).backgroundImage\n  let imageURL = backgroudImageCSS.match(/[\"'](.*)[\"']/)\n  let shouldUpdate = false\n  let hasBackgroundImage = false\n  if (imageURL && imageURL[1]) {\n    imageURL = imageURL[1]\n    shouldUpdate = true\n    hasBackgroundImage = true\n    try {\n      const editTime = parseInt(window.localStorage.getItem('bcsde_bgimage_brightness_time'))\n      if (Date.now() - editTime < 604800000) {\n        shouldUpdate = false\n      }\n    } catch (e) {\n      console.log('Could not read from window.localStorage: ' + e)\n    }\n  }\n  if (shouldUpdate) {\n    const canvas = await loadCrossSiteImage(imageURL)\n    const ctx = canvas.getContext('2d')\n    const data = ctx.getImageData(0, 0, canvas.width, canvas.height).data\n    let sum = 0.0\n    let div = 0\n    const stepSize = canvas.width * canvas.height / 1000\n    const len = data.length - 4\n    for (let i = 0; i < len; i += 4 * parseInt(stepSize * Math.random())) {\n      const v = Math.max(Math.max(data[i], data[i + 1]), data[i + 2])\n      sum += v\n      div++\n    }\n    const brightness = sum / div\n    const alpha = (brightness - 50) / 255\n    document.querySelector('#propOpenWrapper').style.backgroundColor = `rgba(0, 0, 0, ${alpha})`\n    console.log(`Brightness updated: ${brightness}, alpha: ${alpha}`)\n    try {\n      window.localStorage.setItem('bcsde_bgimage_brightness', brightness)\n      window.localStorage.setItem('bcsde_bgimage_brightness_time', Date.now())\n    } catch (e) {\n      console.log('Could not write to window.localStorage: ' + e)\n    }\n  }\n\n  if (!hasBackgroundImage) {\n    // No background image, check background color\n    const color = window.getComputedStyle(document.body).backgroundColor\n    if (color) {\n      const m = color.match(/rgb\\s*\\(\\s*(\\d+)\\s*,\\s*(\\d+)\\s*,\\s*(\\d+)\\s*\\)/)\n      if (m) {\n        const [, r, g, b] = m\n        if (r < 70 && g < 70 && b < 70) {\n          addStyle(`\n            :root {\n              --propOpenWrapperBackgroundColor: rgb(${r}, ${g}, ${b})\n            }\n          `)\n        }\n      }\n    }\n  }\n  // pgBd background color\n  if (document.getElementById('custom-design-rules-style')) {\n    const customCss = document.getElementById('custom-design-rules-style').textContent\n    if (customCss.indexOf('#pgBd') !== -1) {\n      const pgBdStyle = customCss.split('#pgBd')[1].split('}')[0]\n      const m = pgBdStyle.match(/background(-color)?\\s*:\\s*(.+?)[;\\s]/m)\n      if (m && m.length > 2 && m[2]) {\n        const color = css2rgb(m[2])\n        if (color) {\n          const [r, g, b] = color\n          if (r < 70 && g < 70 && b < 70) {\n            addStyle(`\n              :root {\n                --pgBdColor: rgb(${r}, ${g}, ${b});\n              }\n            `)\n          }\n        }\n      }\n    }\n  }\n}\n\nasync function updateSuntimes () {\n  const value = await GM.getValue('darkmode', '1')\n  if (value.startsWith('3#')) {\n    const data = JSON.parse(value.substring(2))\n    const sunData = suntimes(new Date(), data.latitude, data.longitude)\n    const newValue = '3#' + JSON.stringify(Object.assign(data, sunData))\n    if (newValue !== value) {\n      await GM.setValue('darkmode', newValue)\n    }\n  }\n}\n\nfunction confirmDomain () {\n  return new Promise(function confirmDomainPromise (resolve) {\n    GM.getValue('domains', '{}').then(function (v) {\n      const domains = JSON.parse(v)\n      if (document.location.hostname in domains) {\n        const isBandcamp = domains[document.location.hostname]\n        return resolve(isBandcamp)\n      } else {\n        window.setTimeout(function () {\n          const isBandcamp = window.confirm(`${SCRIPT_NAME}\n\nThis page looks like a bandcamp page, but the URL ${document.location.hostname} is not a bandcamp URL.\n\nDo you want to run the userscript on this page?\n\nIf this is a malicious website, running the userscript may leak personal data (e.g. played albums) to the website`)\n          domains[document.location.hostname] = isBandcamp\n          GM.setValue('domains', JSON.stringify(domains)).then(() => resolve(isBandcamp))\n        }, 3000)\n      }\n    })\n  })\n}\n\nasync function setDomain (enabled) {\n  const domains = JSON.parse(await GM.getValue('domains', '{}'))\n  domains[document.location.hostname] = enabled\n  await GM.setValue('domains', JSON.stringify(domains))\n}\n\nlet darkModeModeCurrent = null\nasync function darkModeMode () {\n  if (darkModeModeCurrent != null) {\n    return darkModeModeCurrent\n  }\n  const value = await GM.getValue('darkmode', '1')\n  darkModeModeCurrent = false\n  if (value.startsWith('1')) {\n    darkModeModeCurrent = true\n  } else if (value.startsWith('2#')) {\n    darkModeModeCurrent = nowInTimeRange(value.substring(2))\n  } else if (value.startsWith('3#')) {\n    const data = JSON.parse(value.substring(2))\n    window.setTimeout(updateSuntimes, Math.random() * 10000)\n    darkModeModeCurrent = nowInBetween(new Date(data.sunset), new Date(data.sunrise))\n  }\n  return darkModeModeCurrent\n}\n\nfunction start () {\n  // Load settings and enable darkmode\n  return new Promise(function startFct (resolve) {\n    GM.getValue('enabledFeatures', false).then((value) => getEnabledFeatures(value)).then(function () {\n      if (BANDCAMP && allFeatures.darkMode.enabled) {\n        darkModeMode().then(function (yes) {\n          if (yes) {\n            darkMode()\n          }\n          resolve()\n        })\n      } else {\n        resolve()\n      }\n    })\n  })\n}\n\nfunction onLoaded () {\n  if (!enabledFeaturesLoaded) {\n    GM.getValue('enabledFeatures', false).then((value) => getEnabledFeatures(value)).then(function () {\n      onLoaded()\n    })\n    return\n  }\n  if (!BANDCAMP && document.querySelector('#legal.horizNav li.view-switcher.desktop a,head>meta[name=generator][content=Bandcamp]')) {\n    // Page is a bandcamp page but does not have a bandcamp domain\n    confirmDomain().then(function (isBandcamp) {\n      BANDCAMP = isBandcamp\n      if (isBandcamp) {\n        onLoaded()\n        GM.registerMenuCommand(SCRIPT_NAME + ' - disable on this page', () => setDomain(false).then(() => document.location.reload()))\n      } else {\n        GM.registerMenuCommand(SCRIPT_NAME + ' - enable on this page', () => setDomain(true).then(() => document.location.reload()))\n      }\n    })\n    return\n  } else if (!BANDCAMP && !CAMPEXPLORER) {\n    // Not a bandcamp page -> quit\n    return\n  }\n\n  const IS_PLAYER_URL = document.location.href.startsWith(PLAYER_URL)\n  const IS_PLAYER_FRAME = IS_PLAYER_URL && document.location.search.indexOf('iframe')\n\n  if (allFeatures.darkMode.enabled) {\n    // Darkmode in start() is only run on bandcamp domains\n    if (!darkModeInjected) {\n      darkModeMode().then(function (yes) {\n        if (yes) {\n          darkMode()\n        }\n      })\n    }\n    window.setTimeout(darkModeOnLoad, 0)\n  }\n\n  storeTralbumDataPermanentlySwitch = allFeatures.keepLibrary.enabled\n\n  const maintenanceContent = document.querySelector('.content')\n  if (maintenanceContent && maintenanceContent.textContent.indexOf('are offline') !== -1) {\n    console.log('Maintenance detected')\n  } else {\n    if (NOEMOJI) {\n      addStyle('@font-face{font-family:Symbola;src:local(\"Symbola Regular\"),local(\"Symbola\"),url(https://cdnjs.cloudflare.com/ajax/libs/mathquill/0.10.1/font/Symbola.woff2) format(\"woff2\"),url(https://cdnjs.cloudflare.com/ajax/libs/mathquill/0.10.1/font/Symbola.woff) format(\"woff\"),url(https://cdnjs.cloudflare.com/ajax/libs/mathquill/0.10.1/font/Symbola.ttf) format(\"truetype\"),url(https://cdnjs.cloudflare.com/ajax/libs/mathquill/0.10.1/font/Symbola.otf) format(\"opentype\"),url(https://cdnjs.cloudflare.com/ajax/libs/mathquill/0.10.1/font/Symbola.svg#Symbola) format(\"svg\")}' +\n        '.sharepanelchecksymbol,.bdp_check_onlinkhover_symbol,.bdp_check_onchecked_symbol,.volumeSymbol,.downloaddisk,.downloadlink,#user-nav .settingssymbol,.listened-symbol,.mark-listened-symbol,.minimizebutton{font-family:Symbola,Quivira,\"Segoe UI Symbol\",\"Segoe UI Emoji\",Arial,sans-serif}' +\n        '.downloaddisk,.downloadlink{font-weight: bolder}')\n    }\n\n    GM.getValue('notification_timeout', NOTIFICATION_TIMEOUT).then(function (ms) {\n      NOTIFICATION_TIMEOUT = parseInt(ms)\n    })\n\n    if (allFeatures.releaseReminder.enabled && !IS_PLAYER_FRAME) {\n      showPastReleases()\n    }\n\n    if (document.querySelector('#indexpage .indexpage_list_cell a[href*=\"/album/\"] img')) {\n      // Index pages are almost like discography page. To make them compatible, let's add the class names from the discography page\n      document.querySelector('#indexpage').classList.add('music-grid')\n      document.querySelectorAll('#indexpage .indexpage_list_cell').forEach(cell => cell.classList.add('music-grid-item'))\n      addStyle('#indexpage .ipCellImage { position:relative }')\n    }\n\n    if (document.querySelector('.search .result-items .searchresult img')) {\n      // Search result pages. To make them compatible, let's add the class names from the discography page\n      document.querySelector('.search .result-items').classList.add('music-grid')\n      document.querySelectorAll(\".search .result-items .searchresult[data-search*='\\\"type\\\":\\\"a\\\"'],.search .result-items .searchresult[data-search*='\\\"type\\\":\\\"t\\\"']\").forEach(cell => cell.classList.add('music-grid-item'))\n    }\n\n    if (allFeatures.discographyplayer.enabled && document.querySelector('.music-grid .music-grid-item a[href*=\"/album/\"] img,.music-grid .music-grid-item a[href*=\"/track/\"] img')) {\n      // Discography page\n      makeAlbumCoversGreat()\n    }\n\n    if (document.querySelector('.inline_player')) {\n      // Album page with player\n      if (allFeatures.thetimehascome.enabled) {\n        removeTheTimeHasComeToOpenThyHeartWallet()\n      }\n      if (allFeatures.albumPageVolumeBar.enabled) {\n        window.setTimeout(addVolumeBarToAlbumPage, 3000)\n      }\n      if (allFeatures.albumPageDownloadLinks.enabled) {\n        window.setTimeout(addDownloadLinksToAlbumPage, 500)\n      }\n      if (allFeatures.albumPageLyrics.enabled) {\n        window.setTimeout(addLyricsToAlbumPage, 500)\n      }\n    }\n\n    if (document.querySelector('.share-panel-wrapper-desktop')) {\n      // Album page with Share,Embed,Wishlist links\n\n      if (allFeatures.markasplayedEverywhere.enabled) {\n        addListenedButtonToCollectControls()\n      }\n\n      if (document.location.hash === '#collect-wishlist') {\n        clickAddToWishlist()\n      }\n\n      if (unsafeWindow.TralbumData && unsafeWindow.TralbumData.current && unsafeWindow.TralbumData.current.release_date) {\n        addReleaseDateButton()\n      }\n    }\n\n    GM.registerMenuCommand(SCRIPT_NAME + ' - Settings', mainMenu)\n    if (document.getElementById('user-nav')) {\n      appendMainMenuButtonTo(document.getElementById('user-nav'))\n    } else if (document.getElementById('customHeaderWrapper')) {\n      appendMainMenuButtonLeftTo(document.getElementById('customHeaderWrapper'))\n    } else if (document.querySelector('#corphome-autocomplete-form ul.hd-nav.corp-nav')) {\n      // Homepage and not logged in\n      appendMainMenuButtonTo(document.querySelector('#corphome-autocomplete-form ul.hd-nav.corp-nav'))\n    }\n    if (document.querySelector('.hd-banner-2018')) {\n      // Move the \"we are hiring\" banner (not loggin in)\n      document.querySelector('.hd-banner-2018').style.left = '-500px'\n    }\n    if (document.querySelector('.li-banner-2018')) {\n      // Remove the \"we are hiring\" banner (logged in)\n      document.querySelector('.li-banner-2018').remove()\n    }\n\n    if (document.getElementById('carousel-player') || document.querySelector('.play-carousel')) {\n      window.setTimeout(makeCarouselPlayerGreatAgain, 5000)\n    }\n\n    if (document.querySelector('ol#grid-tabs li') && document.querySelector('.fan-bio-pic-upload-container')) {\n      const listenedTabLink = makeListenedListTabLink()\n      if (document.location.hash === '#listened-tab') {\n        window.setTimeout(function resetGridTabs () {\n          document.querySelector('#grid-tabs .active').classList.remove('active')\n          document.querySelector('#grids .grid.active').classList.remove('active')\n          listenedTabLink.classList.add('active')\n          listenedTabLink.click()\n        }, 500)\n      }\n    }\n\n    if (allFeatures.albumPageVolumeBar.enabled) {\n      restoreVolume()\n    }\n\n    if (allFeatures.markasplayedEverywhere.enabled) {\n      makeAlbumLinksGreat()\n    }\n\n    if (allFeatures.backupReminder.enabled && !IS_PLAYER_FRAME) {\n      checkBackupStatus()\n    }\n\n    if (CAMPEXPLORER) {\n      let lastTagsText = document.querySelector('.tags') ? document.querySelector('.tags').textContent : ''\n      window.setInterval(function () {\n        const tagsText = document.querySelector('.tags') ? document.querySelector('.tags').textContent : ''\n        if (lastTagsText !== tagsText) {\n          lastTagsText = tagsText\n          if (allFeatures.discographyplayer.enabled) {\n            makeAlbumCoversGreat()\n          }\n          if (allFeatures.markasplayedEverywhere.enabled) {\n            makeAlbumLinksGreat()\n          }\n        }\n      }, 3000)\n\n      // Add a little space at the bottom of the page to accommodate the discographyplayer at the bottom\n      document.body.style.paddingBottom = '200px'\n      // Move the sidebar to the left\n      document.querySelectorAll('.sidebar').forEach(function (div) {\n        div.style.alignSelf = 'flex-start'\n        div.querySelectorAll('.shortcuts').forEach(function (shortcuts) {\n          shortcuts.style.borderRadius = '0 1em 1em 0'\n        })\n      })\n    }\n\n    if (IS_PLAYER_URL) {\n      showExplorer()\n    } else if (document.location.pathname === LYRICS_EMPTY_PATH) {\n      initGenius()\n    }\n\n    GM.getValue('musicPlayerState', '{}').then(function restoreState (s) {\n      if (s !== '{}') {\n        GM.setValue('musicPlayerState', '{}')\n        musicPlayerRestoreState(JSON.parse(s))\n      }\n    })\n\n    if (document.querySelector('.inline_player') && unsafeWindow.TralbumData && unsafeWindow.TralbumData.current && unsafeWindow.TralbumData.trackinfo) {\n      const TralbumData = correctTralbumData(JSON.parse(JSON.stringify(unsafeWindow.TralbumData)), document.body.innerHTML)\n      storeTralbumDataPermanently(TralbumData)\n    }\n  }\n}\n\nstart().then(function () {\n  if (document.readyState === 'loading') {\n    document.addEventListener('DOMContentLoaded', onLoaded)\n  } else {\n    onLoaded()\n  }\n})\n"],"names":["GM","registerMenuCommand","GM_registerMenuCommand","console","warn","_extends","Object","assign","target","i","arguments","length","source","key","prototype","hasOwnProperty","call","apply","_setPrototypeOf","o","p","setPrototypeOf","__proto__","_inheritsLoose","subClass","superClass","create","constructor","_assertThisInitialized","self","ReferenceError","safeIsNaN","Number","isNaN","ponyfill","value","isEqual","first","second","areInputsEqual","newInputs","lastInputs","memoizeOne","resultFn","lastThis","lastArgs","lastResult","calledOnce","memoized","newArgs","_i","hasNativePerformanceNow","now","performance","Date","start","callback","id","requestAnimationFrame","Explorer","root","hooks","runHooks","name","args","Array","isArray","Promise","all","map","f","AlbumListItem","React","Component","props","ev","targetStyle","style","cursor","document","body","url","state","TralbumData","window","setTimeout","then","data","library","keys","index","render","handleAlbumClick","artist","current","title","AlbumList","isLoading","error","getKey","Error","componentDidMount","setState","getValue","s","JSON","parse","catch","message","ReactDOM","BACKUP_REMINDER_DAYS","TRALBUM_CACHE_HOURS","NOTIFICATION_TIMEOUT","CHROME","navigator","userAgent","indexOf","CAMPEXPLORER","location","hostname","BANDCAMPDOMAIN","endsWith","BANDCAMP","NOEMOJI","match","DEFAULTSKIPTIME","SCRIPT_NAME","LYRICS_EMPTY_PATH","PLAYER_URL","darkModeInjected","storeTralbumDataPermanentlySwitch","allFeatures","discographyplayer","default","albumPageVolumeBar","albumPageAutoRepeatAll","albumPageLyrics","markasplayed","markasplayedEverywhere","thetimehascome","albumPageDownloadLinks","discographyplayerDownloadLink","discographyplayerSidebar","discographyplayerPersist","backupReminder","nextSongNotifications","releaseReminder","keepLibrary","darkMode","moreSettings","true","populateDarkModeSettings","container","darkModeValue","onChange","input","parentQuery","classList","add","getElementById","innerHTML","remove","checked","from","to","mFrom","mTo","myPosition","sunData","getGPSLocation","suntimes","latitude","longitude","e","stringify","sunrise","toLocaleTimeString","sunset","setValue","radioAlways","appendChild","createElement","setAttribute","startsWith","addEventListener","labelAlways","createTextNode","radioConstTime","substring","split","labelConstTime","labelConstTimeFrom","inputConstTimeFrom","labelConstTimeTo","inputConstTimeTo","radioAuto","labelAuto","preAutoStatus","checkScreenSize","matchMedia","matches","span","opacity","fullfill","false","removeContainerAboutScreenSize","populateNotificationSettings","seconds","parseFloat","trim","parseInt","boxShadow","resetBoxShadowTimeout","labelTimeout","inputTimeout","labelPostTimeout","player","audio","currentDuration","timeline","playhead","bufferbar","onPlayHead","spriteRepeatShuffle","humanDuration","duration","hours","minutes","addLogVolume","mediaElement","defineProperty","get","Math","log","E","volume","set","percentage","exp","randomIndex","max","floor","random","padd","n","width","filler","toString","metricPrefix","decimals","k","String","dm","sizes","pow","toFixed","fixFilename","forbidden","forEach","char","replace","x","resolve","stylesToInsert","addStyle","css","push","head","documentElement","append","type","shift","css2rgb","colorStr","div","color","m","getComputedStyle","base64encode","base64","l","byte0","charCodeAt","byte1","byte2","t","decodeHTMLentities","DOMParser","parseFromString","textContent","timeSince","date","interval","nowInTimeRange","range","fromHours","fromMinutes","toHours","toMinutes","setHours","setMinutes","setDate","getDate","nowInBetween","time","getHours","getMinutes","end","loadCrossSiteImage","downloadCrossSiteImage","reject","canvas","ctx","getContext","img0","onImgLoad","height","xmlHttpRequest","method","overrideMimeType","onload","resp","dataurl","responseText","img1","drawImage","src","onerror","response","status","removeViaQuerySelector","parent","selector","el","querySelector","firstChildWithText","childNodes","node","nodeType","Node","TEXT_NODE","nodeValue","r","q","parents","parentElement","lst","querySelectorAll","lat","lng","PI","dayOfYear","round","setMonth","sunDist","radius","epsilon","thetha","sin","z","rp","sqrt","t0","acos","cos","sunriseMin","getTimezoneOffset","sunsetMin","fromISO6709","convert","iso","negative","mm","dd","geolocation","getCurrentPosition","onSuccess","position","timestamp","toLocaleString","coords","onError","err","tz","Intl","DateTimeFormat","resolvedOptions","timeZone","line","pop","_dateOptions","year","month","day","_dateOptionsWithoutYear","_dateOptionsNumericWithoutYear","dateFormater","getFullYear","toLocaleDateString","undefined","dateFormaterRelease","dateFormaterNumeric","enabledFeaturesLoaded","getEnabledFeatures","enabledFeaturesValue","feature","enabled","enabledFeatures","findUserProfileUrl","href","ivRestoreVolume","getStoredVolume","callbackIfVolumeExists","str","storedVolumeLoaded","restoreVolume","getStoredVolumeCallback","restoreVolumeInterval","restoreInterval","audios","paused","media","logVolume","clearInterval","muteWrapper","mouseDownEvent","MouseEvent","view","unsafeWindow","bubbles","cancelable","dispatchEvent","setInterval","clearRestoreInterval","findPreviousAlbumCover","currentUrl","currentKey","albumKey","as","last","found","playAlbumFromCover","findNextAlbumCover","isNext","shufflePlayed","musicPlayerNextSong","next","contains","allLoadedSongs","file","dataset","nextElementSibling","musicPlayerPlaySong","albumUrl","notloaded","cachedTralbumData","onCachedTralbumDataLoaded","addAlbumToPlaylist","playAlbumFromUrl","pause","currentTime","musicPlayerOnTimeUpdate","alert","ivSlideInNextSong","startTime","bufferbaranimationWidth","bufferbaranimationClass","currentlyPlaying","nextInRow","albumCover","album","musicPlayerFavicon","collectWishlist","display","isPurchased","wishlist","inWishlist","collectListened","myalbumsLoaded","myalbums","listened","since","notification","host","text","image","highlight","silent","timeout","onclick","musicPlayerNext","mediaSession","metadata","MediaMetadata","artwork","setActionHandler","musicPlayerPrev","_","play","event","skipTime","seekOffset","musicPlayerUpdatePositionState","min","musicPlayerClose","fastSeek","seekTime","downloadLink","download","trackNumber","coverLinkPattern","albumPath","img","parentNode","indicator","preventDefault","musicPlayerPlay","marginTop","clientHeight","clearTimeout","slideInSongInterval","clone","cloneNode","className","marginLeft","clientWidth","scrollIntoView","block","musicPlayerCookieChannelSendStop","musicPlayerStop","musicPlayerShowBusy","prev","previousElementSibling","musicPlayerPrevAlbum","musicPlayerPrevAlbumTimeout","click","musicPlayerNextAlbum","musicPlayerNextAlbumTimeout","reachedPlaying","lis","musicPlayerToggleShuffle","toggle","confirm","addAllAlbumsAsHeadings","delay","queueLoadingIndicator","updateLoadingIndicator","musicPlayerOnTimelineClick","musicPlayerMovePlayHead","timelineWidth","offsetWidth","clickPercent","clientX","getBoundingClientRect","left","playpause","playPercent","playbackState","musicPlayerUpdateBufferBar","buffered","newMargLeft","musicPlayerOnPlayheadMouseDown","removeEventListener","musicPlayerOnPlayheadMouseUp","musicPlayerOnVolumeClick","volSlider","sliderWidth","percent","musicPlayerOnVolumeWheel","direction","deltaY","musicPlayerOnMuteClick","lastvolume","musicPlayerOnVolumeChanged","icons","muteIcon","speakerIconMuteSrc","lowIcon","speakerIconLowSrc","middleIcon","speakerIconMiddleSrc","highIcon","speakerIconHighSrc","volIconWrapper","musicPlayerOnEnded","musicPlayerOnPlaylistClick","contextMenuRoot","li","ctrlKey","musicPlayerContextMenuCtrl","shiftKey","musicPlayerContextMenuLastSelectedLi","musicPlayerContextMenuShift","removeSelectedFromPlaylist","walk","remainingTrackN","musicPlayerOnPlaylistHeadingClick","a","dir","musicPlayerContextMenu","oldMenu","pageX","top","pageY","menuEntries","menuEntry","subMenu","clickEvent","musicPlayerOnPlaylistContextMenu","musicPlayerOnPlaylistHeadingContextMenu","link","rel","musicPlayerCollectWishlistClick","open","musicPlayerCollectListenedClick","musicPlayerCollectListenedResetTimeout","albumData","myAlbumsGetAlbum","myAlbumsNewFromUrl","toJSON","myAlbumsUpdateAlbum","makeAlbumLinksGreat","setPositionState","playbackRate","musicPlayerCookieChannel","onStopEventCb","onMessage","origin","protocol","discographyplayerCookiechannelPlaylist","script","postMessage","musicPlayerSaveState","startPlaybackIndex","playlistEntries","startPlaybackTime","getTime","htmlPlaylist","startPlayback","shuffleActive","musicPlayerRestoreState","musicPlayerCreate","addPlaylistEntryOnClick","addPlaylistHeadingEntryOnClick","musicPlayerToggleMinimize","hide","bottom","img1px","listenedListUrl","checkSymbol","discographyplayerCSS","discographyplayerSidebarCSS","setVolumeCallback","onCanPlayThrough","passive","onDownloadLinkClick","addSpinner","removeSpinner","downloadMp3FromLink","onPageUnLoad","addHeadingToPlaylist","albumLoaded","content","addToPlaylist","art_id","streamable","trackinfo","track","track_num","tralbum_collect_info","is_collected","is_purchased","unloadedAs","isAlreadyInPlaylist","getTralbumDataDelay","getTralbumData","cb","retry","getTralbumDataPromise","getTralbumDataOnLoad","msg","JSON5","correctTralbumData","debug","getTralbumDataOnError","TralbumDataObj","html","toLowerCase","tags","require_email_0","audit","download_pref","set_price","killed","auto_repriced","minimum_price_nonzero","minimum_price","purchase_url","new_desc_format","private","is_set_price","require_email","upc","packages","last_subscription_item","has_discounts","is_bonus","play_cap_data","client_id_sig","items_purchased","is_private_stream","is_band_member","licensed_version_ids","package_associated_license_id","is_draft","album_preorder","unreleased_track","encoding_error","video_mobile_url","encoding_pending","video_poster_url","video_source_type","video_source_id","video_caption","video_featured","video_id","attr","pathname","storeTralbumData","expires","cache","prop","storeTralbumDataPermanently","j","tagName","onGetTralbumDataLoaded","onGetTralbumDataError","fallback","releaseDate","release_date","makeAlbumCoversGreat","campExplorerCSS","artPlay","imgs","getElementsByClassName","doc","excluded","onClickSetListened","onClickSetListenedAsync","parentA","showSavingLabel","hideSavingLabel","onClickRemoveListened","onClickRemoveListenedAsync","mouseOverLink","onMouseOverLink","bdpCheckOnlinkhoverContainer","mouseOutLink","onMouseOutLink","iv","mouseOutLinkTimeout","mouseMoveLink","onMouseLoveLink","mouseOverDivCheck","onMouseOverDivCheck","bdpCheckOnlinkhoverSymbol","innerText","mouseOutDivCheck","onMouseOutDivCheck","divCheck","divChecked","spanChecked","lastKey","dateStr","firstText","firstChild","insertBefore","removeTheTimeHasComeToOpenThyHeartWallet","theTimeHasComeToOpenThyHeartWallet","makeCarouselPlayerGreatAgain","closePlayerOnCarouselIv","closePlayerOnCarouselInterval","getClientRects","innerHeight","addListenedButtonToCarouselPlayerLast","addListenedButtonToCarouselPlayer","listenedButtonOnCarouselPlayer","lastMediaHubMeta","onNotificationClick","updateChromePositionState","addChromeMediaHubToCarouselPlayer","chromeMediaHubToCarouselPlayer","playButton","addListenedButtonToCarouselPlayerInterval","addListenedButtonToCollectControls","lastLi","button","icon","textShadow","paddingRight","viewLink","backgroundColor","fontWeight","makeListenedListTabLink","grid","inner","tab","count","showListenedListTab","gridActive","tabLink","tabLinkActive","collectionItems","collectionGrid","addVolumeBarToAlbumPage","playbutton","volumeButton","volumeSymbol","progbar","volumeBar","thumb","progbarFill","volumeLabel","dragging","dragPos","width100","rot0","rot100","blue0","blue100","green0","green100","audioAlbumPage","volumeBarPos","displayVolume","updateDisplayVolume","level","transform","thumbMouseDown","offsetX","thumbMouseUp","stopPropagation","muted","documentMouseUp","documentMouseMove","onWheel","onMouseWheel","onVolumeButtonClick","playnextcontrols","repeatButton","repeatButtonIcon","repeat","backgroundPositionY","posY","shuffleButton","shuffleButtonIcon","findLastSongIndex","allDiv","nextDiv","albumPageAudioOnEnded","lastSongIndex","lastMediaHubTitle","albumPageUpdateMediaHubListener","albumPageUpdateMediaHub","cover","onCoverLoaded","clickAddToWishlist","wishButton","close","addReleaseDateButton","days","ceil","daysStr","toISOString","toggleReleaseReminder","releaseReminderData","removeReleaseReminder","maximizePastReleases","showPastReleases","forceShow","hideDate","releases","pastReleasesCounter","past","sort","b","pastreleasesCSS","maxHeight","maxWidth","table","firstRow","upcoming","controls","refresh","release","entry","removeButton","substr","backgroundRepeat","backgroundSize","backgroundImage","showTagSearchForm","menuA","darkModeModeCurrent","tagsHolder","tag","tagSearchLabel","openTagSearch","tagSearchInputChange","suggestions","listItem","tagNormName","ivTagSearchInput","useTagSuggestion","showTagSuggestions","getTagSuggestions","ok","offsetLeft","matching_tags","result","tag_norm_name","tag_name","focus","query","getTagSuggestionsPromise","search_term","getTagSuggestionsOnLoad","getTagSuggestionsOnError","Set","join","mainMenu","startBackup","exportMenu","filter","main","moveMenuIntoView","allPromisesLoaded","values","tralbumdata","markasplayedThreshold","checkboxOnChange","onCheckboxChange","updateMoreVisibility","thresholdOnChange","onThresholdChange","checkbox","label","inputThreshold","size","moreSettinsContainer","v","moreSettinsContainerOn","moreSettinsContainerOff","buttons","closeButton","onCloseButtonClick","clearCacheButton","onClearCacheButtonClick","showClearedLabel","bytesN","bytes","replaceChild","myalbumsLength","exportButton","onExportButtonClick","donateLink","donateButton","moveLeft","showClearButton","exportMenuHTML","drophint","myalbumsStr","listenedAlbums","format","formatAlbum","formatAlbumStr","myAlbum","listenedDate","fields","getMonth","weekday","field","includes","sortBy","sortByCmp","sortKey","cmps","playedAsc","playedDesc","releasedAsc","releasedDesc","fallbackToTitle","d","localeCompare","fallbackToArtist","generate","generateStr","textarea","generateStrAnimation","sortSelect","options","selectedIndex","platform","generateStrAnimationSuccess","generateStrResetAnimation","inputFormatOnChange","onInputFormatChange","formatExample","resetBoxShadow","importData","importDate","myalbumsSaved","handleFiles","handleFilesAsync","fileList","Response","json","inputTable","tr","td","inputFormat","inputExample","readonly","generateButton","onExportFileButtonClick","dateSuffix","encodeURIComponent","backupButton","onBackupButtonClick","restoreButton","inputFile","clearButton","onClearButtonClick","downloadA","accept","onFileChanged","files","dragenter","dragleave","dragover","drop","dataTransfer","checkBackupStatus","myalbumsLastBackupLoaded","parts","n0","lastBackup","n1","abs","showBackupHint","changedRecords","backupButtonClick","ignoreButton","ignoreButtonClick","noGM","GMdownloadStatus","downloadMp3FromLinkOnError","ontimeout","downloadMp3FromLinkOnTimeout","downloadMp3FromLinkOnLoad","onMp3Load","onMp3LoadError","addDownloadLinksToAlbumPage","addSpiner","downloadLinksOnAlbumPageAddSpinner","downloadLinksOnAlbumPageRemoveSpinner","hasAudio","freeDownloadPage","hoverdiv","mp3","addLyricsToAlbumPage","findInTralbumData","title_link","tracks","trackNum","getAttribute","lyricsRow","lyricsLink","lyrics","loadGeniusLyrics","genius","geniusContainerTr","geniusTrackNum","geniusArtistsArr","geniusTitle","geniusGetCleanLyricsContainer","geniusAddLyrics","force","beLessSpecific","loadLyrics","geniusHideLyrics","spinner","geniusSetFrameDimensions","iframe","option","themeKey","geniusAddCss","geniusCSS","geniusCreateSpinner","spinnerHolder","geniusShowSearchField","border","borderRadius","padding","placeholder","artists","onSearchLyricsButtonClick","searchByQuery","onSearchLyricsKeyUp","keyCode","geniusListSongs","hits","backToSearchButton","backToSearchButtonClick","separator","hideButton","hideButtonClick","trackhtml","ol","searchresultsLengths","rememberLyricsSelection","hit","showLyrics","mouseover","onmouseover","mouseout","onmouseout","forEachHit","transition","margin","title_with_featured","primary_artist","lyrics_state","stats","pageviews","geniusOnLyricsReady","song","loaded","geniusOnNoResults","songTitle","songArtistsArr","initGenius","geniusLyrics","defaultValue","scriptName","scriptIssuesURL","scriptIssuesTitle","domain","emptyURL","addCss","listSongs","showSearchField","addLyrics","hideLyrics","getCleanLyricsContainer","setFrameDimensions","createSpinner","onLyricsReady","onNoResults","find","explorer","showExplorer","appendMainMenuButtonTo","ul","fontSize","liExplorer","aExplorer","liSearch","appendMainMenuButtonLeftTo","leftOf","rect","right","humour","salesfeedHumour","chosen","$","salesfeed_humour","propOpenWrapperBackgroundColor","brightnessStr","localStorage","getItem","brightness","alpha","darkmodeCSS","darkModeOnLoad","yes","darkModeMode","backgroudImageCSS","imageURL","shouldUpdate","hasBackgroundImage","editTime","getImageData","sum","stepSize","len","setItem","g","customCss","pgBdStyle","updateSuntimes","newValue","confirmDomain","confirmDomainPromise","domains","isBandcamp","setDomain","startFct","onLoaded","reload","IS_PLAYER_URL","IS_PLAYER_FRAME","search","maintenanceContent","ms","cell","hash","listenedTabLink","resetGridTabs","lastTagsText","tagsText","paddingBottom","alignSelf","shortcuts","restoreState","readyState"],"mappings":"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CA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,6DAA6Dxa,mBAAoB;AACjF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,0CAA0Cya,eAAgB;AAC1D;AACA;AACA;AACA,wCAAwCC,WAAY;AACpD;AACA;AACA;AACA,6CAA6CA,WAAY;AACzD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAnIE;EAqIAjY,EAAAA,QAAQ,CAACkY,oBAAD,CAAR;;EAEA,MAAIvgB,WAAW,CAACW,wBAAZ,CAAqCwQ,OAAzC,EAAkD;EAChD;EACA9I,IAAAA,QAAQ,CAACmY,2BAAD,CAAR;EACD;;EAEDlb,EAAAA,KAAK,GAAGD,MAAM,CAACsH,aAAP,CAAqB,OAArB,CAAR;EACA1G,EAAAA,YAAY,CAACX,KAAD,CAAZ;EACAkM,EAAAA,eAAe,CAAC,SAASiP,iBAAT,CAA4Bja,MAA5B,EAAoC;EAAElB,IAAAA,KAAK,CAAC6M,SAAN,GAAkB3L,MAAlB;EAA0B,GAAjE,CAAf;EACAf,EAAAA,QAAQ,GAAGJ,MAAM,CAACsH,aAAP,CAAqB,WAArB,CAAX;EACAjH,EAAAA,SAAS,GAAGL,MAAM,CAACsH,aAAP,CAAqB,YAArB,CAAZ;EACAnH,EAAAA,QAAQ,GAAGH,MAAM,CAACsH,aAAP,CAAqB,WAArB,CAAX;EAEAtH,EAAAA,MAAM,CAACsH,aAAP,CAAqB,iBAArB,EAAwCtJ,gBAAxC,CAAyD,OAAzD,EAAkE4c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"}